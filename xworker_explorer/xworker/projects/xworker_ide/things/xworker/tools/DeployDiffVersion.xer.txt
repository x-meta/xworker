^1451445030022
@
sname
DeployDiffVersion
slabel
DeployDiffVersion
sdescriptors
xworker.lang.MetaDescriptor3
smany
true
seditCols
2
sinitialization
false
smodifier
public
sinheritDescription
false
sdescription
<p>发布差分版本，每个版本实际上是按照日期发布的。</p>
snotXmlAttribute
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions
sname
actions
sdescriptors
xworker.lang.MetaDescriptor3/@actions
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run
sname
run
schangeSelf
false
sinterpretationType
Self
sattributeTemplate
false
schildsAttributeTemplate
false
svarScope
Local
sisSynchronized
false
sthrowException
true
suseOtherAction
false
screateLocalVarScope
false
ssaveReturn
false
sdisableGlobalContext
false
sdescriptors
xworker.lang.actions.Actions/@ActionGroup
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions
sname
actions
sdescriptors
xworker.lang.actions.Begin/@actions
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@init
sname
init
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Local
sdisableGlobalContext
false
Scode
#$@text#$@
import java.text.SimpleDateFormat;

def diffInfo = world.getThing("xworker.tools.DeployDiffInfo");
def date = diffInfo.getString("lastVersion");

def sf = new SimpleDateFormat("yyyyMMddHHmmss");
def currentDate = sf.format(new Date());
actionContext.getScope().put("date", date);
actionContext.getScope().put("version", date + "-" + currentDate);
actionContext.getScope().put("currentDate", currentDate);
actionContext.getScope().put("targetDir", "d:/dist/xworker_deploy/" + currentDate + "/");
actionContext.getScope().put("targetDirFile", new File("d:/dist/xworker_deploy/" + currentDate + "/"));
actionContext.getScope().put("targetZip", "d:/dist/xworker_deploy/" + currentDate + ".zip");
actionContext.getScope().put("srcDir", world.getPath());

def user = world.getThing("_local.manong.User");
actionContext.getScope().put("userName", user.userName);
actionContext.getScope().put("password", user.password);
#$@text#$@
sinterpretationType
Action
screateLocalVarScope
false
ssaveReturn
false
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@copyNewFile
sname
copyNewFile
ssrcPath
var:srcDir
stagPath
var:targetDir
stype
1
sbackground
false
sexcludeRegex
.*xworker\\asserts.*|.*xworker\\projects\\_local.*|.*xworker\\actionClasses.*|.*xworker\\updateindex.*|.*xworker\\actionSources.*|.*xworker\\work.*|.*xworker\\database.*|.*xworker\\webroot\\updates.*|.*xworker\\webroot\\_share.*|.*DeployDiffInfo.*|.*projects\\_share.*|.*projects\\_zyx.*|.*lib\\notshare.*|.*projects\\xwok.*|.*xworker\\scripts.*|.*xworker\\webroot\\images\\20.*
sdatePattern
yyyyMMddHHmmss
sdate
var:date
sinterpretationType
Self
sattributeTemplate
false
schildsAttributeTemplate
false
svarScope
Local
sisSynchronized
false
sthrowException
true
suseOtherAction
false
screateLocalVarScope
false
ssaveReturn
false
sdisableGlobalContext
false
sdebugLog
false
sdescriptors
xworker.io.util.NewFileCopyer
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@If
sname
If
scondition
targetDirFile.listFiles().length > 0
sinterpretationType
Self
sattributeTemplate
false
schildsAttributeTemplate
false
svarScope
Local
sisSynchronized
false
sthrowException
true
suseOtherAction
false
screateLocalVarScope
false
ssaveReturn
false
sdisableGlobalContext
false
sdescriptors
xworker.lang.actions.Actions/@If
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@If/@ChildAction
sname
ChildAction
sdescriptors
xworker.lang.actions.If/@ChildAction
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@If/@ChildAction/@zipCompress
sname
zipCompress
ssourceFile
var:targetDir
stargetZipFile
var:targetZip
sincludeRootDir
false
sinterpretationType
Self
sattributeTemplate
false
schildsAttributeTemplate
false
svarScope
Local
sisSynchronized
false
sthrowException
true
suseOtherAction
false
screateLocalVarScope
false
ssaveReturn
false
sdisableGlobalContext
false
sdescriptors
xworker.java.util.ZipCompress
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@If/@ChildAction/@HttpPost
sname
HttpPost
shttpclient
_local.xworker.config.XWorkerHttpClient
suri
http://www.xworker.org/do?sc=xworker.app.update.Upload
sproxy
false
sinterpretationType
Self
sattributeTemplate
false
schildsAttributeTemplate
false
svarScope
Local
sisSynchronized
false
sthrowException
true
suseOtherAction
false
screateLocalVarScope
false
ssaveReturn
false
sdisableGlobalContext
false
sdescriptors
xworker.httpclient.HttpPost
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@If/@ChildAction/@HttpPost/@entity
sname
entity
sdescriptors
xworker.httpclient.HttpPost/@entity
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@If/@ChildAction/@HttpPost/@entity/@MultipartEntity
sname
MultipartEntity
sdescriptors
xworker.httpclient.httpEntity.Entitys/@MultipartEntity
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@If/@ChildAction/@HttpPost/@entity/@MultipartEntity/@file
sname
file
sfile
var:targetZip
sdescriptors
xworker.httpclient.httpEntity.MultipartEntity/@FormBodyPart/@ContentBody/@FileBody
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@If/@ChildAction/@HttpPost/@entity/@MultipartEntity/@userName
sname
userName
stext
var:userName
sdescriptors
xworker.httpclient.httpEntity.MultipartEntity/@StringBody
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@If/@ChildAction/@HttpPost/@entity/@MultipartEntity/@password
sname
password
stext
var:password
sdescriptors
xworker.httpclient.httpEntity.MultipartEntity/@StringBody
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@If/@ChildAction/@HttpPost/@entity/@MultipartEntity/@version
sname
version
stext
var:version
sdescriptors
xworker.httpclient.httpEntity.MultipartEntity/@StringBody
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@If/@ChildAction/@finish
sname
finish
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Local
sdisableGlobalContext
false
Scode
#$@text#$@
//成功，保存最后版本号
def diffInfo = world.getThing("xworker.tools.DeployDiffInfo");
diffInfo.put("lastVersion", currentDate);
diffInfo.save();
#$@text#$@
sinterpretationType
Action
screateLocalVarScope
false
ssaveReturn
false
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@lastVersion
sname
lastVersion
sshowLabel
true
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
snotXmlAttribute
false
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
