^1399529405551
@
sname
NewThingDescPage
slabel
NewThingDescPage
sid
NewThingDescPage
sdescriptors
xworker.swt.widgets.Display
@/@shell
sname
shell
stext
Select Desc
sNO_TRIM
false
sCLOSE
true
sTITLE
true
sMIN
true
sMAX
true
sBORDER
false
sRESIZE
false
sON_TOP
false
sTOOL
false
sNO_FOCUS
false
swidth
-1
sheight
-1
scenterScreen
true
spack
false
smaximized
false
sfullScreen
false
sH_SCROLL
false
sV_SCROLL
false
sNO_BACKGROUND
false
sNO_MERGE_PAINTS
false
sNO_REDRAW_RESIZE
false
sNO_RADIO_GROUP
false
sEMBEDDED
false
sDOUBLE_BUFFERED
false
scapture
false
senabled
true
sredraw
true
svisible
true
sid
shell
sdescriptors
xworker.swt.widgets.Display/@Shell
@/@shell/@shellFillLayout
sname
shellFillLayout
stype
SWT.HORIZONTAL
sid
shellFillLayout
slabel
shellFillLayout
sdescriptors
xworker.swt.Layouts/@FillLayout
@/@shell/@thingDescComposite
sname
thingDescComposite
sBORDER
false
sH_SCROLL
false
sV_SCROLL
false
sNO_BACKGROUND
false
sNO_FOCUS
false
sNO_MERGE_PAINTS
false
sNO_REDRAW_RESIZE
false
sNO_RADIO_GROUP
false
sEMBEDDED
false
sDOUBLE_BUFFERED
false
slabel
thingDescComposite
scapture
false
senabled
true
sredraw
true
svisible
true
sid
thingDescComposite
sdescriptors
xworker.swt.Widgets/@Composite,xworker.swt.widgets.Display/@Shell
@/@shell/@thingDescComposite/@blankLabel
sname
blankLabel
stext
""
stype
HORIZONTAL
sshadow
SHADOW_OUT
sBORDER
false
salignment
LEFT
scapture
false
senabled
true
sredraw
true
svisible
true
sid
blankLabel
slabel
blankLabel
sdescriptors
xworker.swt.Widgets/@Label
@/@shell/@thingDescComposite/@deslabel
sname
deslabel
stext
res:res.w_exp:descriptorNameLabel描述名：
stype
HORIZONTAL
sshadow
SHADOW_OUT
sBORDER
false
salignment
LEFT
scapture
false
senabled
true
sredraw
true
svisible
true
sid
deslabel
slabel
deslabel
sdescriptors
xworker.swt.Widgets/@Label
@/@shell/@thingDescComposite/@descriptorText
sname
descriptorText
sstyle
SINGLE
sH_SCROLL
false
sV_SCROLL
false
sWRAP
false
sREAD_ONLY
false
sPASSWORD
false
sSEARCH
false
sCANCEL
false
sBORDER
true
salign
LEFT
sid
descriptorText
slabel
descriptorText
sdescriptors
xworker.swt.Widgets/@Text
@/@shell/@thingDescComposite/@descriptorText/@descriptorTextGridData
sname
descriptorTextGridData
sstyle
FILL_HORIZONTAL
shorizontalIndent
0
swidth
300
sheight
-1
shorizontalAlignment
BEGINNING
sverticalAlignment
CENTER
shorizontalSpan
1
sverticalSpan
1
sgrabExcessHorizontalSpace
false
sgrabExcessVerticalSpace
false
sid
descriptorTextGridData
slabel
descriptorTextGridData
sdescriptors
xworker.swt.Commons/@GridData
@/@shell/@thingDescComposite/@selectButton
sname
selectButton
stext
"*"
stype
SWT.PUSH
sflat
false
sborder
false
senabled
true
sid
selectButton
slabel
selectButton
sdescriptors
xworker.swt.Widgets/@Button
@/@shell/@thingDescComposite/@selectButton/@listeners
sname
listeners
sid
listeners
slabel
listeners
sdescriptors
xworker.swt.events.Listeners/@listeners
@/@shell/@thingDescComposite/@selectButton/@listeners/@selectionButtonSelection
sname
selectionButtonSelection
stype
Selection
sid
selectionButtonSelection
slabel
selectionButtonSelection
sdescriptors
xworker.swt.events.Listeners/@listeners/@Listener
@/@shell/@thingDescComposite/@selectButton/@listeners/@selectionButtonSelection/@GroovyAction
sname
GroovyAction
slabel
GroovyAction
sisSynchronized
false
sthrowException
false
suseOtherAction
false
svarScope
Global
sdisableGlobalContext
false
Scode
#$@text#$@
import org.xmeta.ActionContext;

import xworker.ui.swt.SwtDialog;

def dialogObject = world.getThing("xworker.ide.worldexplorer.swt.tools.ThingSelector/@shell");
def treeItem = event.widget.getParent().getData();

ActionContext context = new ActionContext();
context.put("treeItem", treeItem);
context.put("parent", descriptorText.getShell());

def newShell = dialogObject.doAction("create", context);
SwtDialog dialog = new SwtDialog(descriptorText.getShell(), newShell, context);

def result = dialog.open();
if(result != null){
    descriptorText.setText(result);
}
#$@text#$@
sid
GroovyAction
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
@/@shell/@thingDescComposite/@historyLabel
sname
historyLabel
stext
res:res.w_exp:oldUsedDescriptorLsit以往所使用的描述者列表：
stype
HORIZONTAL
sshadow
SHADOW_OUT
sBORDER
false
salignment
LEFT
scapture
false
senabled
true
sredraw
true
svisible
true
sid
historyLabel
slabel
historyLabel
sdescriptors
xworker.swt.Widgets/@Label
@/@shell/@thingDescComposite/@historyLabel/@historyLabelGridData
sname
historyLabelGridData
sstyle
FILL_HORIZONTAL
shorizontalIndent
0
swidth
-1
sheight
-1
shorizontalAlignment
BEGINNING
sverticalAlignment
CENTER
shorizontalSpan
3
sverticalSpan
1
sgrabExcessHorizontalSpace
false
sgrabExcessVerticalSpace
false
sid
historyLabelGridData
slabel
historyLabelGridData
sdescriptors
xworker.swt.Commons/@GridData
@/@shell/@thingDescComposite/@historyComposite
sname
historyComposite
sBORDER
true
sH_SCROLL
false
sV_SCROLL
false
sNO_BACKGROUND
false
sNO_FOCUS
false
sNO_MERGE_PAINTS
false
sNO_REDRAW_RESIZE
false
sNO_RADIO_GROUP
false
sEMBEDDED
false
sDOUBLE_BUFFERED
false
slabel
historyComposite
scapture
false
senabled
true
sredraw
true
svisible
true
sid
historyComposite
sdescriptors
xworker.swt.Widgets/@Composite
@/@shell/@thingDescComposite/@historyComposite/@historyCompositeGridData
sname
historyCompositeGridData
sstyle
FILL_BOTH
shorizontalIndent
0
swidth
-1
sheight
200
shorizontalAlignment
BEGINNING
sverticalAlignment
CENTER
shorizontalSpan
3
sverticalSpan
1
sgrabExcessHorizontalSpace
false
sgrabExcessVerticalSpace
false
sid
historyCompositeGridData
slabel
historyCompositeGridData
sdescriptors
xworker.swt.Commons/@GridData
@/@shell/@thingDescComposite/@historyComposite/@historyCompositeFillLayout
sname
historyCompositeFillLayout
stype
SWT.HORIZONTAL
sid
historyCompositeFillLayout
slabel
historyCompositeFillLayout
sdescriptors
xworker.swt.Layouts/@FillLayout
@/@shell/@thingDescComposite/@historyComposite/@historySashForm
sname
historySashForm
sstyle
HORIZONTAL
sSMOOTH
false
sweights
65,35
slabel
historySashForm
sid
historySashForm
sdescriptors
xworker.swt.Widgets/@SashForm
@/@shell/@thingDescComposite/@historyComposite/@historySashForm/@historyTable
sname
historyTable
sselectStyle
SINGLE
sV_SCROLL
true
sH_SCROLL
true
sCHECK
false
sFULL_SELECTION
true
sHIDE_SELECTION
false
sBORDER
false
slineVisible
true
smultipleColumns
true
sheaderVisible
true
ssortIndicator
true
smoveableColumns
true
sheadImages
false
ssubImages
false
sVIRTUAL
false
scolumnNames
["name", "lastVisit", "visitCount"] as String[]
sid
historyTable
slabel
historyTable
sdescriptors
xworker.swt.Widgets/@DataTable
@/@shell/@thingDescComposite/@historyComposite/@historySashForm/@historyTable/@nameItem
sname
nameItem
stext
res:res.w_exp:name名称
swidth
190
sid
nameItem
slabel
nameItem
sdescriptors
xworker.swt.xworker.DataTable/@TableColumn
@/@shell/@thingDescComposite/@historyComposite/@historySashForm/@historyTable/@nameItem/@listeners
sname
listeners
sid
listeners
slabel
listeners
sdescriptors
xworker.swt.events.Listeners/@listeners
@/@shell/@thingDescComposite/@historyComposite/@historySashForm/@historyTable/@nameItem/@listeners/@nameItemSelection
sname
nameItemSelection
stype
Selection
sid
nameItemSelection
slabel
nameItemSelection
sdescriptors
xworker.swt.events.Listeners/@listeners/@Listener
@/@shell/@thingDescComposite/@historyComposite/@historySashForm/@historyTable/@nameItem/@listeners/@nameItemSelection/@GroovyAction
sname
GroovyAction
slabel
GroovyAction
sisSynchronized
false
sthrowException
false
suseOtherAction
false
Scode
#$@text#$@
import org.eclipse.swt.SWT;

def sortColumn = historyTable.getSortColumn();
def currentColumn = event.widget;
int dir = historyTable.getSortDirection();
if (sortColumn == currentColumn) {
	dir = dir == SWT.UP ? SWT.DOWN : SWT.UP;
} else {
	historyTable.setSortColumn(currentColumn);
	switch(currentColumn){
	    case nameItem:
	    case lastVisitItem:
	    case visitCountItem:
	        dir = SWT.DOWN;
	        break;
	    default:
	        dir = SWT.UP;
	        break;
	}
}

historyTable.setSortDirection(dir);
def alist = historyTable.getData();
if(currentColumn == nameItem){
    if(dir == SWT.DOWN){
        alist = alist.sort{l,r -> return r.name <=> l.name};
    }else{
        alist = alist.sort{l,r -> return l.name <=> r.name};
    }
}
if(currentColumn == lastVisitItem){
    if(dir == SWT.DOWN){
        alist = alist.sort{l,r -> return r.lastVisit <=> l.lastVisit};
    }else{
        alist = alist.sort{l,r -> return l.lastVisit <=> r.lastVisit};
    }
}
if(currentColumn == visitCountItem){
    if(dir == SWT.DOWN){
        alist = alist.sort{l,r -> return r.visitCount <=> l.visitCount};
    }else{
        alist = alist.sort{l,r -> return l.visitCount <=> r.visitCount};
    }
}
historyTable.removeAll();
for(m in alist){
    historyTable.updateRow(null, -1, m);
}
#$@text#$@
sid
GroovyAction
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
@/@shell/@thingDescComposite/@historyComposite/@historySashForm/@historyTable/@lastVisitItem
sname
lastVisitItem
stext
res:res.w_exp:lastVisitTime最后访问
swidth
100
sid
lastVisitItem
slabel
lastVisitItem
sdescriptors
xworker.swt.xworker.DataTable/@TableColumn
@/@shell/@thingDescComposite/@historyComposite/@historySashForm/@historyTable/@lastVisitItem/@listeners
sname
listeners
sid
listeners
slabel
listeners
sdescriptors
xworker.swt.events.Listeners/@listeners
@/@shell/@thingDescComposite/@historyComposite/@historySashForm/@historyTable/@lastVisitItem/@listeners/@lastVisitItemSelection
sname
lastVisitItemSelection
stype
Selection
sref
nameItemSelection
sid
lastVisitItemSelection
slabel
lastVisitItemSelection
sdescriptors
xworker.swt.events.Listeners/@listeners/@Listener
@/@shell/@thingDescComposite/@historyComposite/@historySashForm/@historyTable/@visitCountItem
sname
visitCountItem
stext
res:res.w_exp:visitCount访问次数
swidth
80
sid
visitCountItem
slabel
visitCountItem
sdescriptors
xworker.swt.xworker.DataTable/@TableColumn
@/@shell/@thingDescComposite/@historyComposite/@historySashForm/@historyTable/@visitCountItem/@listeners
sname
listeners
sid
listeners
slabel
listeners
sdescriptors
xworker.swt.events.Listeners/@listeners
@/@shell/@thingDescComposite/@historyComposite/@historySashForm/@historyTable/@visitCountItem/@listeners/@visitCountItemSelection
sname
visitCountItemSelection
stype
Selection
sref
nameItemSelection
sid
visitCountItemSelection
slabel
visitCountItemSelection
sdescriptors
xworker.swt.events.Listeners/@listeners/@Listener
@/@shell/@thingDescComposite/@historyComposite/@historySashForm/@historyTable/@listeners
sname
listeners
sid
listeners
slabel
listeners
sdescriptors
xworker.swt.events.Listeners/@listeners
@/@shell/@thingDescComposite/@historyComposite/@historySashForm/@historyTable/@listeners/@historyTableSelection
sname
historyTableSelection
stype
Selection
sid
historyTableSelection
slabel
historyTableSelection
sdescriptors
xworker.swt.events.Listeners/@listeners/@Listener
@/@shell/@thingDescComposite/@historyComposite/@historySashForm/@historyTable/@listeners/@historyTableSelection/@GroovyAction
sname
GroovyAction
slabel
GroovyAction
sisSynchronized
false
sthrowException
false
suseOtherAction
false
svarScope
Global
Scode
#$@text#$@
def itemData = historyTable.getSelection()[0].getData();

def path = itemData.path;
def pathObj = world.getThing(path);

if(path != null){
    descriptorText.setText(path);
    //def cfg = world.getThing("xworker.ide.config.globalConfig/@html");
    //String html = cfg.getString("head") + pathObj.getString("description") + cfg.getString("bottom"); 
    
    def globalConfig = world.getThing("xworker.ide.config..GlobalConfig");
    def webUrl = globalConfig.getString("webUrl");
    historyBorwser.setUrl(webUrl + "do?sc=xworker.ide.worldexplorer.swt.http.ThingDoc/@desc&thing=" + path);
    /*String html = pathObj.getString("description");
    if(html == null){
        html = "";
    }
    historyBorwser.setText(html);*/
}else{
    descriptorText.setText("");
    historyBorwser.setText("");
}
#$@text#$@
sid
GroovyAction
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
@/@shell/@thingDescComposite/@historyComposite/@historySashForm/@historyBorwser
sname
historyBorwser
sMOZILLA
false
sid
historyBorwser
slabel
historyBorwser
sdescriptors
xworker.swt.Widgets/@Browser
@/@shell/@thingDescComposite/@Models
sname
Models
sid
Models
slabel
Models
sdescriptors
xworker.swt.Widgets/@Models
@/@shell/@thingDescComposite/@Models/@model
sname
model
sdataType
Map
svalidate
true
sfocus
false
sfocusColor
"#E8FAFF"
LvalidateOnBlur
false
LallowDecimals
false
LallowNegative
false
sid
model
slabel
model
sdescriptors
xworker.swt.model.Models/@Model
@/@shell/@thingDescComposite/@Models/@model/@descriptors
sname
descriptors
sswtControl
descriptorText
spropertyName
descriptors
svalidate
true
sfocus
false
sfocusColor
"#E8FAFF"
LvalidateOnBlur
false
LallowDecimals
false
LallowNegative
false
sid
descriptors
slabel
descriptors
sdescriptors
xworker.swt.model.Model/@Model
@/@shell/@thingDescComposite/@InitCode
sname
InitCode
slabel
InitCode
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Local
sdisableGlobalContext
false
Scode
#$@text#$@
def memory = world.getThing("_local.xworker.worldExplorer.CreateThingMemory");
def ms = memory.childs;

def alist = [];
for(m in ms){
    alist.add(m);
}

alist = alist.sort{ l,r -> return r.lastVisit <=> l.lastVisit};
historyTable.setData(alist);
for(m in alist){    
    historyTable.updateRow(null, -1, m);
}
#$@text#$@
sid
InitCode
sdescriptors
xworker.swt.Widgets/@Code
@/@shell/@thingDescComposite1
sname
thingDescComposite1
sBORDER
false
sH_SCROLL
false
sV_SCROLL
false
sNO_BACKGROUND
false
sNO_FOCUS
false
sNO_MERGE_PAINTS
false
sNO_REDRAW_RESIZE
false
sNO_RADIO_GROUP
false
sEMBEDDED
false
sDOUBLE_BUFFERED
false
slabel
thingDescComposite1
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sid
shell
sdescriptors
xworker.swt.Widgets/@Composite
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@shell/@thingDescComposite1/@blankLabel1
sname
blankLabel
stype
HORIZONTAL
sshadow
SHADOW_OUT
sBORDER
false
salignment
LEFT
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sdescriptors
xworker.swt.Widgets/@Label
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@shell/@thingDescComposite1/@blankLabel
sname
categoryLabel
stext
目录：
stype
HORIZONTAL
sshadow
SHADOW_OUT
sBORDER
false
salignment
LEFT
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sid
categoryLabel
slabel
categoryLabel
sdescriptors
xworker.swt.Widgets/@Label
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@shell/@thingDescComposite1/@categoryText
sname
categoryText
sstyle
SINGLE
sH_SCROLL
false
sV_SCROLL
false
sWRAP
false
sREAD_ONLY
false
sPASSWORD
false
sSEARCH
false
sCANCEL
false
sBORDER
true
salign
LEFT
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sdescriptors
xworker.swt.Widgets/@Text
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@shell/@thingDescComposite1/@categoryText/@categoryTextGridData
sname
categoryTextGridData
sstyle
FILL_HORIZONTAL
shorizontalIndent
0
swidth
-1
sheight
-1
shorizontalAlignment
BEGINNING
sverticalAlignment
CENTER
shorizontalSpan
1
sverticalSpan
1
sgrabExcessHorizontalSpace
false
sgrabExcessVerticalSpace
false
sxw_cl_global
false
sdescriptors
xworker.swt.layout.LayoutDatas/@GridData
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@shell/@thingDescComposite1/@selectButton1
sname
selectCategoryButton
stext
"选择目录"
stype
SWT.PUSH
sflat
false
sborder
false
sselected
false
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sid
selectButton
slabel
selectButton
sdescriptors
xworker.swt.Widgets/@Button
@/@shell/@thingDescComposite1/@selectButton1/@listeners
sname
listeners
sid
listeners
slabel
listeners
sdescriptors
xworker.swt.events.Listeners/@listeners
@/@shell/@thingDescComposite1/@selectButton1/@listeners/@selectionButtonSelection
sname
selectionButtonSelection
stype
Selection
sid
selectionButtonSelection
slabel
selectionButtonSelection
sdescriptors
xworker.swt.events.Listeners/@listeners/@Listener
@/@shell/@thingDescComposite1/@selectButton1/@listeners/@selectionButtonSelection/@GroovyAction
sname
GroovyAction
slabel
GroovyAction
sisSynchronized
false
sthrowException
false
suseOtherAction
false
svarScope
Local
sdisableGlobalContext
false
Scode
#$@text#$@
import org.xmeta.ActionContext;

import xworker.swt.util.SwtDialog;

def dialogObject = world.getThing("xworker.ide.worldexplorer.swt.tools.ThingSelector/@shell");
def treeItem = event.widget.getParent().getData();

ActionContext context = new ActionContext();
context.put("treeItem", treeItem);
context.put("parent", selectButton.getShell());
context.put("text", descriptorText);

def newShell = dialogObject.doAction("create", context);
SwtDialog dialog = new SwtDialog(selectButton.getShell(), newShell, context);

def result = dialog.open();
if(result != null){
    descriptorText.setText(result);
}
#$@text#$@
sinitBreakPoint
false
ssuccessBreakPoint
false
sexceptionBreakPoint
false
seditBreakPoint
false
sinterpretationType
Action
screateLocalVarScope
false
ssaveReturn
false
sid
GroovyAction
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
@/@shell/@thingDescComposite1/@resources
sname
resources
sdescriptors
xworker.swt.Widgets/@Resource
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@shell/@thingDescComposite1/@resources/@folderImage
sname
folderImage
stype
Image
simageFile
icons/folder.png
sdescriptors
xworker.swt.util.Resource/@Image
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@shell/@thingDescComposite1/@deslabel
sname
deslabel
stext
res:res.w_exp:descriptorNameLabel:描述名：
stype
HORIZONTAL
sshadow
SHADOW_OUT
sBORDER
false
salignment
LEFT
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sid
deslabel
slabel
deslabel
sdescriptors
xworker.swt.Widgets/@Label
@/@shell/@thingDescComposite1/@descriptorText
sname
descriptorText
sstyle
SINGLE
sH_SCROLL
false
sV_SCROLL
false
sWRAP
false
sREAD_ONLY
false
sPASSWORD
false
sSEARCH
false
sCANCEL
false
sBORDER
true
salign
LEFT
sid
descriptorText
slabel
descriptorText
sdescriptors
xworker.swt.Widgets/@Text
@/@shell/@thingDescComposite1/@descriptorText/@descriptorTextGridData
sname
descriptorTextGridData
sstyle
FILL_HORIZONTAL
shorizontalIndent
0
swidth
300
sheight
-1
shorizontalAlignment
BEGINNING
sverticalAlignment
CENTER
shorizontalSpan
1
sverticalSpan
1
sgrabExcessHorizontalSpace
false
sgrabExcessVerticalSpace
false
sxw_cl_global
false
sid
descriptorTextGridData
slabel
descriptorTextGridData
sdescriptors
xworker.swt.Commons/@GridData
@/@shell/@thingDescComposite1/@selectButton
sname
selectButton
stext
"选择描述者"
stype
SWT.PUSH
sflat
false
sborder
false
sselected
false
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sid
selectButton
slabel
selectButton
sdescriptors
xworker.swt.Widgets/@Button
@/@shell/@thingDescComposite1/@selectButton/@listeners
sname
listeners
sid
listeners
slabel
listeners
sdescriptors
xworker.swt.events.Listeners/@listeners
@/@shell/@thingDescComposite1/@selectButton/@listeners/@selectionButtonSelection
sname
selectionButtonSelection
stype
Selection
sid
selectionButtonSelection
slabel
selectionButtonSelection
sdescriptors
xworker.swt.events.Listeners/@listeners/@Listener
@/@shell/@thingDescComposite1/@selectButton/@listeners/@selectionButtonSelection/@GroovyAction
sname
GroovyAction
slabel
GroovyAction
sisSynchronized
false
sthrowException
false
suseOtherAction
false
svarScope
Local
sdisableGlobalContext
false
Scode
#$@text#$@
import org.xmeta.ActionContext;

import xworker.swt.util.SwtDialog;

def dialogObject = world.getThing("xworker.ide.worldexplorer.swt.tools.ThingSelector/@shell");
def treeItem = event.widget.getParent().getData();

ActionContext context = new ActionContext();
context.put("treeItem", treeItem);
context.put("parent", selectButton.getShell());
context.put("text", descriptorText);

def newShell = dialogObject.doAction("create", context);
SwtDialog dialog = new SwtDialog(selectButton.getShell(), newShell, context);

def result = dialog.open();
if(result != null){
    descriptorText.setText(result);
}
#$@text#$@
sinitBreakPoint
false
ssuccessBreakPoint
false
sexceptionBreakPoint
false
seditBreakPoint
false
sinterpretationType
Action
screateLocalVarScope
false
ssaveReturn
false
sid
GroovyAction
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
@/@shell/@thingDescComposite1/@typeLabel
sname
typeLabel
stext
CodecType
stype
HORIZONTAL
sshadow
SHADOW_OUT
sBORDER
false
salignment
LEFT
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sid
typeLabel
slabel
typeLabel
sdescriptors
xworker.swt.Widgets/@Label
@/@shell/@thingDescComposite1/@codecTypeCombo
sname
codecTypeCombo
stype
DROP_DOWN
sREAD_ONLY
false
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sid
codecTypeCombo
slabel
codecTypeCombo
sdescriptors
xworker.swt.Widgets/@Combo
@/@shell/@thingDescComposite1/@codecTypeCombo/@codecTypeComboGridData
sname
codecTypeComboGridData
shorizontalIndent
0
swidth
-1
sheight
-1
shorizontalAlignment
BEGINNING
sverticalAlignment
CENTER
shorizontalSpan
2
sverticalSpan
1
sgrabExcessHorizontalSpace
false
sgrabExcessVerticalSpace
false
sxw_cl_global
false
sid
codecTypeComboGridData
slabel
codecTypeComboGridData
sdescriptors
xworker.swt.layout.LayoutDatas/@GridData
@/@shell/@thingDescComposite1/@historyComposite
sname
historyThingsComposite
sBORDER
false
sH_SCROLL
false
sV_SCROLL
false
sNO_BACKGROUND
false
sNO_FOCUS
false
sNO_MERGE_PAINTS
false
sNO_REDRAW_RESIZE
false
sNO_RADIO_GROUP
false
sEMBEDDED
false
sDOUBLE_BUFFERED
false
slabel
historyThingsComposite
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sid
historyComposite
sdescriptors
xworker.swt.Widgets/@Composite
@/@shell/@thingDescComposite1/@historyComposite/@historyCompositeGridData
sname
historyCompositeGridData
sstyle
FILL_BOTH
shorizontalIndent
0
swidth
-1
sheight
350
shorizontalAlignment
BEGINNING
sverticalAlignment
CENTER
shorizontalSpan
3
sverticalSpan
1
sgrabExcessHorizontalSpace
false
sgrabExcessVerticalSpace
false
sxw_cl_global
false
sid
historyCompositeGridData
slabel
historyCompositeGridData
sdescriptors
xworker.swt.Commons/@GridData
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie
sname
thingsCompostie
sBORDER
false
sH_SCROLL
false
sV_SCROLL
false
sNO_BACKGROUND
false
sNO_FOCUS
false
sNO_MERGE_PAINTS
false
sNO_REDRAW_RESIZE
false
sNO_RADIO_GROUP
false
sEMBEDDED
false
sDOUBLE_BUFFERED
false
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sid
thingsCompostie
sdescriptors
xworker.swt.Widgets/@Composite
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@thingsCompositeGridLayout
sname
thingsCompositeGridLayout
snumColumns
1
smakeColumnsEqualWidth
false
smarginWidth
0
smarginHeight
5
smarginLeft
0
smarginTop
0
smarginRight
0
smarginBottom
0
shorizontalSpacing
5
sverticalSpacing
5
sid
thingsCompositeGridLayout
slabel
thingsCompositeGridLayout
sdescriptors
xworker.swt.Layouts/@GridLayout
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historyLabel
sname
historyLabel
stext
label:xworker.ide.worldexplorer.swt.i18n.I18nResource/@newThingDialog/@historyLabel
stype
HORIZONTAL
sshadow
SHADOW_OUT
sBORDER
false
salignment
LEFT
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sid
historyLabel
slabel
historyLabel
sdescriptors
xworker.swt.Widgets/@Label
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historyLabel/@historyLabelGridData
sname
historyLabelGridData
sstyle
FILL_HORIZONTAL
shorizontalIndent
0
swidth
-1
sheight
-1
shorizontalAlignment
BEGINNING
sverticalAlignment
CENTER
shorizontalSpan
1
sverticalSpan
1
sgrabExcessHorizontalSpace
false
sgrabExcessVerticalSpace
false
sxw_cl_global
false
sid
historyLabelGridData
slabel
historyLabelGridData
sdescriptors
xworker.swt.Commons/@GridData
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm
sname
historySashForm
sstyle
HORIZONTAL
sSMOOTH
false
sweights
40,60
sBORDER
false
sH_SCROLL
false
sV_SCROLL
false
sNO_BACKGROUND
false
sNO_FOCUS
false
sNO_MERGE_PAINTS
false
sNO_REDRAW_RESIZE
false
sNO_RADIO_GROUP
false
sEMBEDDED
false
sDOUBLE_BUFFERED
false
slabel
historySashForm
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sid
historySashForm
sdescriptors
xworker.swt.Widgets/@SashForm
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@categoryTree
sname
categoryTree
sselectStyle
SINGLE
sV_SCROLL
true
sH_SCROLL
true
sCHECK
false
sFULL_SELECTION
false
sHIDE_SELECTION
true
sBORDER
true
slineVisible
false
smultipleColumns
false
sheaderVisible
false
ssortIndicator
true
smoveableColumns
true
sheadImages
false
ssubImages
false
scheckSelection
false
sxw_cl_global
false
sid
categoryTree
slabel
categoryTree
sdescriptors
xworker.swt.Widgets/@Tree
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@categoryTree/@listeners
sname
listeners
sid
listeners
slabel
listeners
sdescriptors
xworker.swt.events.Listeners/@listeners
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@categoryTree/@listeners/@categoryTreeSelection
sname
categoryTreeSelection
stype
Selection
sid
categoryTreeSelection
slabel
categoryTreeSelection
sdescriptors
xworker.swt.events.Listeners/@listeners/@Listener
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@categoryTree/@listeners/@categoryTreeSelection/@GroovyAction
sname
GroovyAction
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Global
sdisableGlobalContext
false
Scode
#$@text#$@
def item = categoryTree.getSelection()[0];

if(item.getData() == null){
    //历史记录
    actions.doAction("initHistory", actionContext);
}else{
    //历史记录
    actions.doAction("initCategoryThing", actionContext);
}
#$@text#$@
sid
GroovyAction
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@descriptorSashForm
sname
descriptorSashForm
sstyle
VERTICAL
sSMOOTH
false
sweights
55,45
sBORDER
false
sH_SCROLL
false
sV_SCROLL
false
sNO_BACKGROUND
false
sNO_FOCUS
false
sNO_MERGE_PAINTS
false
sNO_REDRAW_RESIZE
false
sNO_RADIO_GROUP
false
sEMBEDDED
false
sDOUBLE_BUFFERED
false
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sid
descriptorSashForm
sdescriptors
xworker.swt.Widgets/@SashForm
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@descriptorSashForm/@historyTable
sname
historyTable
sselectStyle
SINGLE
sV_SCROLL
true
sH_SCROLL
true
sCHECK
false
sFULL_SELECTION
true
sHIDE_SELECTION
false
sBORDER
true
slineVisible
true
smultipleColumns
true
sheaderVisible
true
ssortIndicator
true
smoveableColumns
true
sheadImages
false
ssubImages
false
sVIRTUAL
false
scolumnNames
["name", "lastVisit", "visitCount"] as String[]
sid
historyTable
slabel
historyTable
sdescriptors
xworker.swt.Widgets/@DataTable
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@descriptorSashForm/@historyTable/@nameItem
sname
nameItem
stext
res:res.w_exp:name:名称
swidth
400
sid
nameItem
slabel
nameItem
sdescriptors
xworker.swt.xworker.DataTable/@TableColumn
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@descriptorSashForm/@historyTable/@nameItem/@listeners
sname
listeners
sid
listeners
slabel
listeners
sdescriptors
xworker.swt.events.Listeners/@listeners
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@descriptorSashForm/@historyTable/@nameItem/@listeners/@nameItemSelection
sname
nameItemSelection
stype
Selection
sid
nameItemSelection
slabel
nameItemSelection
sdescriptors
xworker.swt.events.Listeners/@listeners/@Listener
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@descriptorSashForm/@historyTable/@nameItem/@listeners/@nameItemSelection/@GroovyAction
sname
GroovyAction
slabel
GroovyAction
sisSynchronized
false
sthrowException
false
suseOtherAction
false
svarScope
Global
sdisableGlobalContext
false
Scode
#$@text#$@
import org.eclipse.swt.SWT;

def sortColumn = historyTable.getSortColumn();
def currentColumn = event.widget;
int dir = historyTable.getSortDirection();
if (sortColumn == currentColumn) {
	dir = dir == SWT.UP ? SWT.DOWN : SWT.UP;
} else {
	historyTable.setSortColumn(currentColumn);
	switch(currentColumn){
	    case nameItem:
	    case lastVisitItem:
	    case visitCountItem:
	        dir = SWT.DOWN;
	        break;
	    default:
	        dir = SWT.UP;
	        break;
	}
}

historyTable.setSortDirection(dir);
def alist = historyTable.getData();
if(currentColumn == nameItem){
    if(dir == SWT.DOWN){
        alist = alist.sort{l,r -> return r.name <=> l.name};
    }else{
        alist = alist.sort{l,r -> return l.name <=> r.name};
    }
}
/*
if(currentColumn == lastVisitItem){
    if(dir == SWT.DOWN){
        alist = alist.sort{l,r -> return r.lastVisit <=> l.lastVisit};
    }else{
        alist = alist.sort{l,r -> return l.lastVisit <=> r.lastVisit};
    }
}
if(currentColumn == visitCountItem){
    if(dir == SWT.DOWN){
        alist = alist.sort{l,r -> return r.visitCount <=> l.visitCount};
    }else{
        alist = alist.sort{l,r -> return l.visitCount <=> r.visitCount};
    }
}
*/
historyTable.removeAll();
for(m in alist){
    historyTable.updateRow(null, -1, m);
}
#$@text#$@
sid
GroovyAction
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@descriptorSashForm/@historyTable/@listeners
sname
listeners
sid
listeners
slabel
listeners
sdescriptors
xworker.swt.events.Listeners/@listeners
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@descriptorSashForm/@historyTable/@listeners/@historyTableSelection
sname
historyTableSelection
stype
Selection
sid
historyTableSelection
slabel
historyTableSelection
sdescriptors
xworker.swt.events.Listeners/@listeners/@Listener
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@descriptorSashForm/@historyTable/@listeners/@historyTableSelection/@GroovyAction
sname
GroovyAction
slabel
GroovyAction
sisSynchronized
false
sthrowException
false
suseOtherAction
false
svarScope
Global
sdisableGlobalContext
false
Scode
#$@text#$@
def itemData = historyTable.getSelection()[0].getData();

def path = itemData.path;
def docPath = path;
def pathObj = world.getThing(path);

if(itemData.thingType == "template" && itemData.thingPath != null){
    //okButton.setText(world.getThing("xworker.ide.worldexplorer.swt.i18n.I18nResource/@newThingDialog/@useTemplateButton").metadata.label);
    //okButton.setData("action", "useTemplate");    
    docPath = itemData.thingPath;
}else{
    //默认创建事物
    //okButton.setText(world.getThing("xworker.ide.worldexplorer.swt.i18n.I18nResource/@buttons/@okButton").metadata.label);
    //okButton.setData("action", "createThing");
   // cancelButton.setText(world.getThing("xworker.ide.worldexplorer.swt.i18n.I18nResource/@buttons/@cancelButton").metadata.label);
    //cancelButton.setData("action", "dispose");
}

if(path != null){
    descriptorText.setText(path);
    //def cfg = world.getThing("xworker.ide.config.globalConfig/@html");
    //String html = cfg.getString("head") + pathObj.getString("description") + cfg.getString("bottom"); 
    
    def globalConfig = world.getThing("_local.xworker.config.GlobalConfig");
    def webUrl = globalConfig.getString("webUrl");
    historyBorwser.setUrl(webUrl + "do?sc=xworker.ide.worldexplorer.swt.http.ThingDoc/@desc&thing=" + docPath);
    /*String html = pathObj.getString("description");
    if(html == null){
        html = "";
    }
    historyBorwser.setText(html);*/
}else{
    descriptorText.setText("");
    historyBorwser.setText("");
}
#$@text#$@
sinitBreakPoint
false
ssuccessBreakPoint
false
sexceptionBreakPoint
false
seditBreakPoint
false
sinterpretationType
Action
screateLocalVarScope
false
ssaveReturn
false
sid
GroovyAction
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@descriptorSashForm/@browserComposite
sname
browserComposite
sBORDER
true
sH_SCROLL
false
sV_SCROLL
false
sNO_BACKGROUND
false
sNO_FOCUS
false
sNO_MERGE_PAINTS
false
sNO_REDRAW_RESIZE
false
sNO_RADIO_GROUP
false
sEMBEDDED
false
sDOUBLE_BUFFERED
false
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sid
browserComposite
sdescriptors
xworker.swt.Widgets/@Composite
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@descriptorSashForm/@browserComposite/@historyBorwser
sname
historyBorwser
sMOZILLA
false
sid
historyBorwser
slabel
historyBorwser
sdescriptors
xworker.swt.Widgets/@Browser
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@descriptorSashForm/@browserComposite/@historyBorwser/@historyBrowserUtil
sname
historyBrowserUtil
sid
historyBrowserUtil
sdescriptors
xworker.swt.browser.Browser/@UtilBrowser
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@descriptorSashForm/@browserComposite/@browserCompositeFillLayout
sname
browserCompositeFillLayout
stype
SWT.HORIZONTAL
sxw_cl_global
false
sid
browserCompositeFillLayout
slabel
browserCompositeFillLayout
sdescriptors
xworker.swt.Layouts/@FillLayout
@/@shell/@thingDescComposite1/@historyComposite/@thingsCompostie/@historySashForm/@historySashFormgridData
sname
historySashFormgridData
sstyle
FILL_BOTH
shorizontalIndent
0
swidth
-1
sheight
-1
shorizontalAlignment
BEGINNING
sverticalAlignment
CENTER
shorizontalSpan
1
sverticalSpan
1
sgrabExcessHorizontalSpace
false
sgrabExcessVerticalSpace
false
sxw_cl_global
false
sid
historySashFormgridData
slabel
historySashFormgridData
sdescriptors
xworker.swt.layout.LayoutDatas/@GridData
@/@shell/@thingDescComposite1/@historyComposite/@templateComposite
sname
templateComposite
sBORDER
false
sH_SCROLL
false
sV_SCROLL
false
sNO_BACKGROUND
false
sNO_FOCUS
false
sNO_MERGE_PAINTS
false
sNO_REDRAW_RESIZE
false
sNO_RADIO_GROUP
false
sEMBEDDED
false
sDOUBLE_BUFFERED
false
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sid
templateComposite
sdescriptors
xworker.swt.Widgets/@Composite
@/@shell/@thingDescComposite1/@historyComposite/@templateComposite/@thingsCompositeGridLayout
sname
thingsCompositeGridLayout
snumColumns
1
smakeColumnsEqualWidth
false
smarginWidth
0
smarginHeight
5
smarginLeft
0
smarginTop
0
smarginRight
0
smarginBottom
0
shorizontalSpacing
5
sverticalSpacing
5
sid
thingsCompositeGridLayout
slabel
thingsCompositeGridLayout
sdescriptors
xworker.swt.Layouts/@GridLayout
@/@shell/@thingDescComposite1/@historyComposite/@templateComposite/@historyLabel
sname
historyLabel
stext
编辑模板数据：
stype
HORIZONTAL
sshadow
SHADOW_OUT
sBORDER
false
salignment
LEFT
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sid
historyLabel
slabel
historyLabel
sdescriptors
xworker.swt.Widgets/@Label
@/@shell/@thingDescComposite1/@historyComposite/@templateComposite/@historyLabel/@historyLabelGridData
sname
historyLabelGridData
sstyle
FILL_HORIZONTAL
shorizontalIndent
0
swidth
-1
sheight
-1
shorizontalAlignment
BEGINNING
sverticalAlignment
CENTER
shorizontalSpan
1
sverticalSpan
1
sgrabExcessHorizontalSpace
false
sgrabExcessVerticalSpace
false
sxw_cl_global
false
sid
historyLabelGridData
slabel
historyLabelGridData
sdescriptors
xworker.swt.Commons/@GridData
@/@shell/@thingDescComposite1/@historyComposite/@templateComposite/@templateComp
sname
templateComp
sBORDER
false
sH_SCROLL
false
sV_SCROLL
false
sNO_BACKGROUND
false
sNO_FOCUS
false
sNO_MERGE_PAINTS
false
sNO_REDRAW_RESIZE
false
sNO_RADIO_GROUP
false
sEMBEDDED
false
sDOUBLE_BUFFERED
false
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sid
templateComp
sdescriptors
xworker.swt.Widgets/@Composite
@/@shell/@thingDescComposite1/@historyComposite/@templateComposite/@templateComp/@tempalteCompGridData
sname
tempalteCompGridData
sstyle
FILL_BOTH
shorizontalIndent
0
swidth
-1
sheight
-1
shorizontalAlignment
BEGINNING
sverticalAlignment
CENTER
shorizontalSpan
1
sverticalSpan
1
sgrabExcessHorizontalSpace
false
sgrabExcessVerticalSpace
false
sxw_cl_global
false
sid
tempalteCompGridData
slabel
tempalteCompGridData
sdescriptors
xworker.swt.layout.LayoutDatas/@GridData
@/@shell/@thingDescComposite1/@historyComposite/@historyCompositeStackLayotu
sname
historyCompositeStackLayotu
stopControl
templateComposite
sid
historyCompositeStackLayotu
slabel
historyCompositeStackLayotu
sdescriptors
xworker.swt.Layouts/@StackLayout
@/@shell/@thingDescComposite1/@Models
sname
Models
sid
Models
slabel
Models
sdescriptors
xworker.swt.Widgets/@Models
@/@shell/@thingDescComposite1/@Models/@model
sname
model
sdataType
Map
svalidate
true
sfocus
false
sfocusColor
"#E8FAFF"
LvalidateOnBlur
false
LallowDecimals
false
LallowNegative
false
sid
model
slabel
model
sdescriptors
xworker.swt.model.Models/@Model
@/@shell/@thingDescComposite1/@Models/@model/@name
sname
name
sswtControl
dataObjectNameText
spropertyName
name
svalidate
true
sfocus
false
sfocusColor
"#E8FAFF"
LvalidateOnBlur
false
LallowDecimals
false
LallowNegative
false
sid
name
slabel
name
sdescriptors
xworker.swt.model.Model/@Model
@/@shell/@thingDescComposite1/@Models/@model/@descriptors
sname
descriptors
sswtControl
descriptorText
spropertyName
descriptors
svalidate
true
sfocus
false
sfocusColor
"#E8FAFF"
LvalidateOnBlur
false
LallowDecimals
false
LallowNegative
false
sid
descriptors
slabel
descriptors
sdescriptors
xworker.swt.model.Model/@Model
@/@shell/@thingDescComposite1/@Models/@model/@path
sname
path
sswtControl
pathText
svalidate
true
sfocus
false
sfocusColor
"#E8FAFF"
LvalidateOnBlur
false
LallowDecimals
false
LallowNegative
false
sid
path
slabel
path
sdescriptors
xworker.swt.model.Model/@Model
@/@shell/@thingDescComposite1/@Models/@model/@codecType
sname
codecType
sswtControl
codecTypeCombo
svalidate
true
sfocus
false
sfocusColor
"#E8FAFF"
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sid
codecType
slabel
codecType
sdescriptors
xworker.swt.model.Model/@Model
@/@shell/@thingDescComposite1/@actions
sname
actions
sid
actions
slabel
actions
sdescriptors
xworker.swt.Widgets/@actions
@/@shell/@thingDescComposite1/@actions/@initHistory
sname
initHistory
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Global
sdisableGlobalContext
false
Scode
#$@text#$@
import org.xmeta.Thing;

historyTable.removeAll();

def memory = world.getThing("_local.xworker.worldExplorer.CreateThingMemory");
if(memory == null){
    memory = new Thing("xworker.ide.worldexplorer.swt.memory.CreateThingMemory/@struct");
    memory.saveAs("_local", "_local.xworker.worldExplorer.CreateThingMemory");

    memory = world.getThing("_local.xworker.worldExplorer.CreateThingMemory");
}
def ms = memory.childs;

def alist = [];
for(m in ms){
    alist.add(m);
}

alist = alist.sort{ l,r -> return r.lastVisit <=> l.lastVisit};
historyTable.setData(alist);
for(m in alist){    
    historyTable.updateRow(null, -1, m);
}
#$@text#$@
sinitBreakPoint
false
ssuccessBreakPoint
false
sexceptionBreakPoint
false
seditBreakPoint
false
sinterpretationType
Action
screateLocalVarScope
false
ssaveReturn
false
sid
initHistory
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
@/@shell/@thingDescComposite1/@actions/@initCategoryThing
sname
initCategoryThing
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Global
sdisableGlobalContext
false
Scode
#$@text#$@
historyTable.removeAll();

def item = categoryTree.getSelection()[0];

def globalConfig = world.getThing("_local.xworker.config.GlobalConfig");
def webUrl = globalConfig.getString("webUrl");
historyBorwser.setUrl(webUrl + "do?sc=xworker.ide.worldexplorer.swt.http.ThingDoc/@desc&thing=" + item.getData().metadata.path);
    
def alist = [];
for(child in item.getData().getAllChilds()){
    if(child.thingName == "Thing"){
        def t = [:];
        t.name = child.metadata.label;
        t.path = child.getString("descriptor");
        t.lastVisit = "";
        t.visitCount = "";
        t.thingType = child.thingType;
        t.thingPath = child.thingPath;
        alist.add(t);
    }
}

historyTable.setData(alist);
for(m in alist){    
    historyTable.updateRow(null, -1, m);
}
#$@text#$@
sid
initCategoryThing
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
@/@shell/@thingDescComposite1/@actions/@userTemplate
sname
useTemplate
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Global
sdisableGlobalContext
false
Scode
#$@text#$@
import org.xmeta.Thing;
import org.eclipse.swt.widgets.Control;

//编辑模板数据
def itemData = historyTable.getSelection()[0].getData();
def templateThing = world.getThing(itemData.thingPath);
def descriptor = templateThing.get("InputThing@0");
templateThingData = new Thing(descriptor.metadata.path);
editorActions.doAction("setThing", actionContext, ["thing":templateThingData]);

okButton.setText("确定");
okButton.setData("action", "applyTemplate");
cancelButton.setText("取消模板");
cancelButton.setData("action", "cancelUseTemplate");
    
//显示模板
historyCompositeStackLayotu.topControl =templateComposite;
historyThingsComposite.layout();
#$@text#$@
sid
userTemplate
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
@/@shell/@thingDescComposite1/@actions/@cancelUseTemplate
sname
cancelUseTemplate
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Global
sdisableGlobalContext
false
Scode
#$@text#$@
//显示模板
historyCompositeStackLayotu.topControl = thingsCompostie;
historyThingsComposite.layout();

okButton.setText("确定");
okButton.setData("action", "createThing");
cancelButton.setText("取消");
cancelButton.setData("action", "dispose");
#$@text#$@
sid
cancelUseTemplate
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
@/@shell/@thingDescComposite1/@actions/@applyTemplate
sname
applyTemplate
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Global
sdisableGlobalContext
false
Scode
#$@text#$@
import org.xmeta.Thing;
import org.xmeta.Category;
import org.xmeta.ThingManager;
import org.xmeta.Project;

import org.eclipse.swt.SWT;
import org.eclipse.swt.widgets.MessageBox;
import org.eclipse.swt.widgets.TreeItem;

import org.xmeta.util.UtilString;

//校验数据输入
if(!model.doAction("validate", actionContext)) return;

def category = world.get(pathText.getText());
if(category != null && (category instanceof Category || category instanceof ThingManager)){
     if(category instanceof ThingManager){
         category = category.getCategory("");
     }
}else{
    MessageBox box = new MessageBox(shell, SWT.OK | SWT.ICON_ERROR);
    box.setText(UtilString.getString("res:res.w_exp:commonBoxTitle|操作信息", actionContext));
    box.setMessage(UtilString.getString("请选择正确的路径！", actionContext));
    box.open();
    return;
}

def values = model.doAction("getValue", actionContext);
//判断数据对象是否存在
if(category.getThing(values.name) != null){
    MessageBox box = new MessageBox(shell, SWT.OK | SWT.ICON_ERROR);
    box.setText(UtilString.getString("res:res.w_exp:commonBoxTitle|操作信息", actionContext));
    box.setMessage(UtilString.getString("res:res.w_exp:alertThingExists事物已经已经存在！", actionContext));
    box.open();
    return;
}else{
    //创建新的对象    
    Thing object = new Thing(values.name, values.name, values.descriptors, false);
    object.metadata.setCategory(category);
    object.metadata.initPath();
    category.getThingManager().save(object);
    
    Thing thing = world.getThing(object.metadata.path);
    if(actionContext.get("treeItem") != null){
        //如果是从事物浏览器创建的，会带一个treeItem过来
        treeItem.getData().refresh();
    }
        
    def itemData = historyTable.getSelection()[0].getData();
    def templateThing = world.getThing(itemData.thingPath);
    def data = editorActions.doAction("getThing");
    def proccessedThing = templateThing.doAction("process", actionContext, ["data":data]);
    if(proccessedThing != null){
        thing.paste(proccessedThing);
        thing.save();
    }
    
    //explorerActions.doAction("openPackageViewer", ["index":treeItem.getData(), "refresh":true]);
    //开打事物
    explorerActions.doAction("openThing", ["thing":thing]);
    
    //保存对描述的历史记录
    def descPath = values.descriptors;
    def descObj = world.getThing(descPath);
    if(descObj == null) return;
    
    def memory = world.getThing("_local.xworker.worldExplorer.CreateThingMemory/@memorys");
    def have = false;
    for(dataObj in memory.childs){
        if(dataObj.path == descPath){
            dataObj.name = descObj.metadata.name;
            dataObj.lastVisit = new Date();
            dataObj.visitCount ++;
            dataObj.save();
            have = true;
        }
    }
    
    if(!have){
        def vd = new Thing(descObj.metadata.name, descObj.metadata.name, "_local.xworker.worldExplorer.CreateThingMemory/@struct", false);        
        vd.path = descPath;
        vd.lastVisit = new Date();
        vd.visitCount = 1;
        memory.addChild(vd);
        memory.save();
    }

    shell.dispose();
}
#$@text#$@
sid
applyTemplate
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
@/@shell/@thingDescComposite1/@actions/@createThing
sname
createThing
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Global
sdisableGlobalContext
false
Scode
#$@text#$@
import org.xmeta.Thing;
import org.xmeta.Category;
import org.xmeta.ThingManager;
import org.xmeta.cache.ThingCache;

import org.eclipse.swt.SWT;
import org.eclipse.swt.widgets.MessageBox;
import org.eclipse.swt.widgets.TreeItem;

import org.xmeta.util.UtilString;

//校验数据输入
if(!model.doAction("validate", actionContext)) return;

def index = treeItem.getData();
def category = null;

if(index.type == "thingManager"){
    category = index.getIndexObject().getCategory(null);;
}else{
    category = index.getIndexObject();
}

def values = model.doAction("getValue", actionContext);
//判断数据对象是否存在
if(category.getThing(values.name) != null){
    MessageBox box = new MessageBox(shell, SWT.OK | SWT.ICON_ERROR);
    box.setText(UtilString.getString("res:res.w_exp:commonBoxTitle:操作信息", actionContext));
    box.setMessage(UtilString.getString("res:res.w_exp:alertThingExists:事物已经已经存在！", actionContext));
    box.open();
    return;
}else if(values.name == null || values.name.trim() == "" || values.name.indexOf(".") != -1 || values.name.indexOf(":") != -1){
    MessageBox box = new MessageBox(shell, SWT.OK | SWT.ICON_ERROR);
    box.setText(UtilString.getString("res:res.w_exp:commonBoxTitle|操作信息", actionContext));
    box.setMessage(UtilString.getString("请输入正确的事物名！事物名不能为空和包含符号'.'和':'。", actionContext));
    box.open();
    return;
}else{
    //创建新的对象    
    Thing object = new Thing(values.name, values.name, values.descriptors, false);
    object.metadata.setCategory(category);
    object.metadata.initPath();
    object.metadata.setCoderType(values.codecType);
    category.getThingManager().save(object);
    
    //放入缓存
    ThingCache.put(object.metadata.path, object);
            
    if(actionContext.get("treeItem") != null){
        //如果是从事物浏览器创建的，会带一个treeItem过来
        treeItem.getData().refresh();
    }
        
    //explorerActions.doAction("openPackageViewer", ["index":treeItem.getData(), "refresh":true]);
    //开打事物
    Thing thing = object;//world.getThing(object.metadata.path);
    explorerActions.doAction("openThing", ["thing":thing]);
    
    //保存对描述的历史记录
    def descPath = values.descriptors;
    def descObj = world.getThing(descPath);
    if(descObj == null) return;
    
    def memory = world.getThing("_local.xworker.worldExplorer.CreateThingMemory");
    if(memory == null){
         memory = new Thing();
         memory.saveAs("_local", "_local.xworker.worldExplorer.CreateThingMemory");
    }
    def have = false;
    for(dataObj in memory.childs){
        if(dataObj.path == descPath){
            dataObj.name = descObj.metadata.name;
            dataObj.lastVisit = new Date();
            dataObj.visitCount ++;
            dataObj.save();
            have = true;
        }
    }
    
    if(!have){
        def vd = new Thing(descObj.metadata.name, descObj.metadata.name, "xworker.ide.worldexplorer.swt.memory.CreateThingMemory/@struct", false);        
        vd.path = descPath;
        vd.lastVisit = new Date();
        vd.visitCount = 1;
        memory.addChild(vd);
        memory.save();
    }

    shell.dispose();
}
#$@text#$@
sinitBreakPoint
false
ssuccessBreakPoint
false
sexceptionBreakPoint
false
seditBreakPoint
false
sinterpretationType
Action
screateLocalVarScope
false
ssaveReturn
false
sid
createThing
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
@/@shell/@thingDescComposite1/@actions/@dispose
sname
dispose
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Global
sdisableGlobalContext
false
scode
shell.dispose();
sid
dispose
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
@/@shell/@thingDescComposite1/@InitCode
sname
InitCode
slabel
InitCode
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Global
sdisableGlobalContext
false
Scode
#$@text#$@
import org.eclipse.swt.SWT;
import org.eclipse.swt.widgets.TreeItem;

//目录
if(actionContext.get("categoryPath") != null){
    pathText.setText(categoryPath);
}

//历史记录
actions.doAction("initHistory", actionContext);

//目录树
def item = new TreeItem(categoryTree, SWT.NONE);
item.setText(world.getThing("xworker.ide.worldexplorer.swt.i18n.I18nResource/@newThingDialog/@historyRecord").metadata.label);
item.setImage(folderImage);
       
def coreThings = world.getThing("xworker.ide.config.Things");
initThings(categoryTree, coreThings);

for(thingManager in world.getThingManagers()){
    def rootCategory = thingManager.getCategory(null);
    for(lv1Category in rootCategory.getCategorys()){
        for(lv2Category in lv1Category.getCategorys()){
            String project = lv1Category.getSimpleName() + "." + lv2Category.getSimpleName();
            def things = world.getThing(project + ".config.Things");
            if(things != null){
                 if(project == "xworker.ide"){                    
                 }else{
                     initThings(categoryTree, things);
                 }
            }
        }
    }
}

for(thingCoder in world.getThingCoders()){
    codecTypeCombo.add(thingCoder.getType());
}
codecTypeCombo.select(0);
/*
for(project in world.getProjects()){
    for(thingManager in project.getThingManagers()){
        def things = world.getThing(project.getName() + ":" + thingManager.getName() + ":config.Things");
        if(things != null){
             if(project.name == "xworker" && thingManager.name == "core"){                    
             }else{
                 initThings(categoryTree, things);
             }
        }
    }
}
*/

//为解决模板bug，事物定义是先显示模板，正常启动后切换到事物选择
historyCompositeStackLayotu.topControl = thingsCompostie;
historyThingsComposite.layout();

def initThings(treeItem, things){
    for(child in things.getAllChilds()){
        if(child.thingName == "Category"){
            def item = new TreeItem(treeItem, SWT.NONE);
            item.setText(child.metadata.label);
            item.setData(child);
            item.setImage(folderImage);
            
            initThings(item, child);
        }
    }
    
    if(treeItem instanceof TreeItem){
        //treeItem.setExpanded(true);
    }
}
#$@text#$@
sinitBreakPoint
false
ssuccessBreakPoint
false
sexceptionBreakPoint
false
seditBreakPoint
false
sinterpretationType
Action
screateLocalVarScope
false
ssaveReturn
false
sid
InitCode
sdescriptors
xworker.swt.Widgets/@Code
