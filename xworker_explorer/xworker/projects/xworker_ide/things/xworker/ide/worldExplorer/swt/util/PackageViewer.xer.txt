^1484808727384
@
sname
PackageViewer
slabel
PackageViewer
sdescriptors
xworker.swt.widgets.Display
  @/@shell
  sname
  shell
  stext
  "包浏览"
  sNO_TRIM
  false
  sCLOSE
  true
  sTITLE
  true
  sMIN
  true
  sMAX
  true
  sBORDER
  false
  sRESIZE
  true
  sON_TOP
  false
  sTOOL
  false
  sNO_FOCUS
  false
  swidth
  640
  sheight
  480
  scenterScreen
  true
  spack
  false
  smaximized
  false
  sdescriptors
  xworker.swt.widgets.Display/@Shell
  sid
  shell
    @/@shell/@shellFillLayout
    sname
    shellFillLayout
    stype
    SWT.HORIZONTAL
    slabel
    shellFillLayout
    sdescriptors
    xworker.swt.Layouts/@FillLayout
    sid
    shellFillLayout
    @/@shell/@packageCompoiste
    sname
    packageCompoiste
    sBORDER
    false
    sH_SCROLL
    false
    sV_SCROLL
    false
    sNO_BACKGROUND
    false
    sNO_FOCUS
    false
    sNO_MERGE_PAINTS
    false
    sNO_REDRAW_RESIZE
    false
    sNO_RADIO_GROUP
    false
    sEMBEDDED
    false
    sDOUBLE_BUFFERED
    false
    scapture
    false
    senabled
    true
    sredraw
    true
    svisible
    true
    sdescriptors
    xworker.swt.Widgets/@Composite
    sinheritDescription
    false
    sth_createIndex
    false
    sth_registMyChilds
    false
    sth_registDisabled
    false
    sicon
    icons/folder_page.png
    sth_mark
    false
    sid
    packageCompoiste
      @/@shell/@packageCompoiste/@packageCompositeGridLayout
      sname
      packageCompositeGridLayout
      smakeColumnsEqualWidth
      false
      smarginWidth
      5
      smarginHeight
      5
      smarginLeft
      0
      smarginTop
      0
      smarginRight
      0
      smarginBottom
      0
      shorizontalSpacing
      5
      sverticalSpacing
      5
      slabel
      packageCompositeGridLayout
      sdescriptors
      xworker.swt.Layouts/@GridLayout
      sid
      packageCompositeGridLayout
      @/@shell/@packageCompoiste/@resources
      sname
      resources
      slabel
      resources
      sdescriptors
      xworker.swt.Widgets/@Resource
      sid
      resources
        @/@shell/@packageCompoiste/@resources/@titleBackColor
        sname
        titleBackColor
        srgb
        #9CAEBD
        sdescriptors
        xworker.swt.util.Resource/@Color
        sid
        titleBackColor
        @/@shell/@packageCompoiste/@resources/@titleFrontColor
        sname
        titleFrontColor
        srgb
        #FFFFFF
        sdescriptors
        xworker.swt.util.Resource/@Color
        sid
        titleFrontColor
        @/@shell/@packageCompoiste/@resources/@titleFont
        sname
        titleFont
        sdescriptors
        xworker.swt.util.Resource/@Font
        sid
        titleFont
        @/@shell/@packageCompoiste/@resources/@projectImage
        sname
        projectImage
        stype
        Image
        simageFile
        /xworker/ide/images/project.gif
        sdescriptors
        xworker.swt.util.Resource/@Image
        sid
        projectImage
        @/@shell/@packageCompoiste/@resources/@project1
        sname
        project1Image
        stype
        Image
        simageFile
        /xworker/ide/images/project1.gif
        sdescriptors
        xworker.swt.util.Resource/@Image
        sid
        project1
        @/@shell/@packageCompoiste/@resources/@factoryImage
        sname
        factoryImage
        stype
        Image
        simageFile
        /xworker/ide/images/factory.gif
        sdescriptors
        xworker.swt.util.Resource/@Image
        sid
        factoryImage
        @/@shell/@packageCompoiste/@resources/@packageIamge
        sname
        packageImage
        stype
        Image
        simageFile
        /xworker/ide/images/package.gif
        sdescriptors
        xworker.swt.util.Resource/@Image
        sid
        packageIamge
        @/@shell/@packageCompoiste/@resources/@dataObjectImage
        sname
        dataObjectImage
        stype
        Image
        simageFile
        /xworker/ide/images/dataObject.gif
        sdescriptors
        xworker.swt.util.Resource/@Image
        sid
        dataObjectImage
        @/@shell/@packageCompoiste/@resources/@parentImage
        sname
        parentImage
        stype
        Image
        simageFile
        /xworker/ide/images/parent.gif
        sdescriptors
        xworker.swt.util.Resource/@Image
        sid
        parentImage
        @/@shell/@packageCompoiste/@resources/@normalImage
        sname
        normalFileImage
        stype
        Image
        simageFile
        /xworker/ide/images/normalFile.gif
        sdescriptors
        xworker.swt.util.Resource/@Image
        sid
        normalImage
        @/@shell/@packageCompoiste/@resources/@project11
        sname
        worksetImage
        slabel
        worksetImage
        stype
        Image
        simageFile
        /xworker/ide/images/project1.gif
        sdescriptors
        xworker.swt.util.Resource/@Image
        sid
        project11
      @/@shell/@packageCompoiste/@titleComposite
      sname
      titleComposite
      sBORDER
      false
      sH_SCROLL
      false
      sV_SCROLL
      false
      sNO_BACKGROUND
      false
      sNO_FOCUS
      false
      sNO_MERGE_PAINTS
      false
      sNO_REDRAW_RESIZE
      false
      sNO_RADIO_GROUP
      false
      sEMBEDDED
      false
      sDOUBLE_BUFFERED
      false
      sdescriptors
      xworker.swt.Widgets/@Composite
      sid
      titleComposite
        @/@shell/@packageCompoiste/@titleComposite/@titleCompositeGridData
        sname
        titleCompositeGridData
        sstyle
        FILL_HORIZONTAL
        shorizontalIndent
        0
        swidth
        -1
        sheight
        -1
        shorizontalAlignment
        BEGINNING
        sverticalAlignment
        CENTER
        shorizontalSpan
        1
        sverticalSpan
        1
        sgrabExcessHorizontalSpace
        false
        sgrabExcessVerticalSpace
        false
        slabel
        titleCompositeGridData
        sdescriptors
        xworker.swt.Commons/@GridData
        sid
        titleCompositeGridData
        @/@shell/@packageCompoiste/@titleComposite/@titleCompoisteGridData
        sname
        titleCompoisteGridLayout
        smakeColumnsEqualWidth
        false
        smarginWidth
        5
        smarginHeight
        5
        smarginLeft
        0
        smarginTop
        0
        smarginRight
        0
        smarginBottom
        0
        shorizontalSpacing
        5
        sverticalSpacing
        5
        slabel
        titleCompoisteGridLayout
        sdescriptors
        xworker.swt.Layouts/@GridLayout
        sid
        titleCompoisteGridData
        @/@shell/@packageCompoiste/@titleComposite/@background
        scolor
        titleBackColor
        sname
        background
        slabel
        background
        sdescriptors
        xworker.swt.Commons/@background
        sid
        background
        @/@shell/@packageCompoiste/@titleComposite/@titleLbel
        sname
        titleLabel
        sBORDER
        false
        stype
        HORIZONTAL
        sshadow
        SHADOW_OUT
        salignment
        LEFT
        stext
        "目录浏览-"
        slabel
        titleLabel
        sdescriptors
        xworker.swt.Widgets/@Label
        sid
        titleLbel
          @/@shell/@packageCompoiste/@titleComposite/@titleLbel/@titleLabelGridData
          sname
          titleLabelGridData
          sstyle
          FILL_HORIZONTAL
          shorizontalIndent
          0
          swidth
          -1
          sheight
          -1
          shorizontalAlignment
          BEGINNING
          sverticalAlignment
          CENTER
          shorizontalSpan
          1
          sverticalSpan
          1
          sgrabExcessHorizontalSpace
          false
          sgrabExcessVerticalSpace
          false
          slabel
          titleLabelGridData
          sdescriptors
          xworker.swt.Commons/@GridData
          sid
          titleLabelGridData
          @/@shell/@packageCompoiste/@titleComposite/@titleLbel/@font
          sfont
          titleFont
          sname
          font
          slabel
          font
          sdescriptors
          xworker.swt.Commons/@font
          sid
          font
          @/@shell/@packageCompoiste/@titleComposite/@titleLbel/@background
          scolor
          titleBackColor
          sname
          background
          slabel
          background
          sdescriptors
          xworker.swt.Commons/@background
          sid
          background
          @/@shell/@packageCompoiste/@titleComposite/@titleLbel/@foreground
          scolor
          titleFrontColor
          sname
          foreground
          slabel
          foreground
          sdescriptors
          xworker.swt.Commons/@foreground
          sid
          foreground
      @/@shell/@packageCompoiste/@menuBarCompoiste
      sname
      menuBarCompoiste
      sBORDER
      false
      sH_SCROLL
      false
      sV_SCROLL
      false
      sNO_BACKGROUND
      false
      sNO_FOCUS
      false
      sNO_MERGE_PAINTS
      false
      sNO_REDRAW_RESIZE
      false
      sNO_RADIO_GROUP
      false
      sEMBEDDED
      false
      sDOUBLE_BUFFERED
      false
      scapture
      false
      senabled
      true
      sredraw
      true
      svisible
      true
      sdescriptors
      xworker.swt.Widgets/@Composite
      sinheritDescription
      false
      sth_createIndex
      false
      sth_registMyChilds
      false
      sth_mark
      false
      sid
      menuBarCompoiste
        @/@shell/@packageCompoiste/@menuBarCompoiste/@menuBarComposite
        sname
        menuBarCompositeGridData
        sstyle
        FILL_HORIZONTAL
        shorizontalIndent
        0
        swidth
        -1
        sheight
        -1
        shorizontalAlignment
        BEGINNING
        sverticalAlignment
        CENTER
        shorizontalSpan
        1
        sverticalSpan
        1
        sgrabExcessHorizontalSpace
        false
        sgrabExcessVerticalSpace
        false
        sxw_cl_global
        false
        slabel
        menuBarCompositeGridData
        sdescriptors
        xworker.swt.Commons/@GridData
        sid
        menuBarComposite
        @/@shell/@packageCompoiste/@menuBarCompoiste/@menuBarcompositeFillLayout
        sname
        menuBarcompositeFillLayout
        stype
        SWT.VERTICAL
        sxw_cl_global
        false
        slabel
        menuBarcompositeFillLayout
        sdescriptors
        xworker.swt.Layouts/@FillLayout
        sid
        menuBarcompositeFillLayout
        @/@shell/@packageCompoiste/@menuBarCompoiste/@mainCoolbar
        sname
        mainCoolbar
        stype
        HORIZONTAL
        sBORDER
        false
        sFLAT
        true
        sH_SCROLL
        false
        sV_SCROLL
        false
        sNO_BACKGROUND
        false
        sNO_FOCUS
        false
        sNO_MERGE_PAINTS
        false
        sNO_REDRAW_RESIZE
        false
        sNO_RADIO_GROUP
        false
        sEMBEDDED
        false
        sDOUBLE_BUFFERED
        false
        scapture
        false
        senabled
        true
        sredraw
        true
        svisible
        true
        sdescriptors
        xworker.swt.Widgets/@CoolBar
        sinheritDescription
        false
        sth_createIndex
        false
        sth_registMyChilds
        false
        sth_mark
        false
        sid
        mainCoolbar
          @/@shell/@packageCompoiste/@menuBarCompoiste/@mainCoolbar/@menuCoolItem
          sname
          menuCoolItem
          sDROP_DOWN
          false
          sxw_cl_global
          false
          sdescriptors
          xworker.swt.widgets.CoolBar/@CoolItem
          sinheritDescription
          false
          sth_createIndex
          false
          sth_registMyChilds
          false
          sth_mark
          false
          sid
          menuCoolItem
            @/@shell/@packageCompoiste/@menuBarCompoiste/@mainCoolbar/@menuCoolItem/@menuToolbar
            sname
            menuToolbar
            stype
            HORIZONTAL
            sFLAT
            true
            sWRAP
            false
            sBORDER
            false
            sSHADOW_OUT
            false
            sRIGHT
            false
            slabel
            menuToolbar
            sdescriptors
            xworker.swt.Widgets/@ToolBar
            sid
            menuToolbar
              @/@shell/@packageCompoiste/@menuBarCompoiste/@mainCoolbar/@menuCoolItem/@menuToolbar/@fileMenu
              sname
              fileMenuItem
              stype
              PUSH
              stext
              文件
              senabled
              true
              slabel
              fileMenuItem
              sdescriptors
              xworker.swt.widgets.ToolBar/@ToolItem
              sid
              fileMenu
                @/@shell/@packageCompoiste/@menuBarCompoiste/@mainCoolbar/@menuCoolItem/@menuToolbar/@fileMenu/@listeners
                sname
                listeners
                slabel
                listeners
                sdescriptors
                xworker.swt.events.Listeners/@listeners
                sid
                listeners
                  @/@shell/@packageCompoiste/@menuBarCompoiste/@mainCoolbar/@menuCoolItem/@menuToolbar/@fileMenu/@listeners/@fileMenuSelection
                  sname
                  fileMenuSelection
                  stype
                  Selection
                  slabel
                  fileMenuSelection
                  sdescriptors
                  xworker.swt.events.Listeners/@listeners/@Listener
                  sid
                  fileMenuSelection
                    @/@shell/@packageCompoiste/@menuBarCompoiste/@mainCoolbar/@menuCoolItem/@menuToolbar/@fileMenu/@listeners/@fileMenuSelection/@GroovyAction
                    sname
                    GroovyAction
                    sisSynchronized
                    false
                    sthrowException
                    true
                    suseOtherAction
                    false
                    svarScope
                    Global
                    sdisableGlobalContext
                    false
                    Scode
#$@text#$@
import org.eclipse.swt.SWT;
import org.eclipse.swt.graphics.Point;
import org.eclipse.swt.graphics.Rectangle;


def action = world.getAction("xworker.ide.worldExplorer.swt.SimpleExplorer/@shell1/@mainComposite/@topSash/@mainSash/@leftSash/@leftCTablFolder/@projectTreeTab/@projectTree/@listeners/@projectTreeMenudetect/@ProjectTreeMenuDetect");
action.run(actionContext);

def rect = fileMenuItem.getBounds();
def pt = new Point(rect.x, rect.y + rect.height);
pt = fileMenuItem.getParent().toDisplay(pt);
projectTreeMenu.setLocation(pt.x, pt.y);
projectTreeMenu.update();
projectTreeMenu.setVisible(true);
#$@text#$@
                    sinterpretationType
                    Action
                    screateLocalVarScope
                    false
                    ssaveReturn
                    false
                    sdescriptors
                    xworker.lang.actions.Actions/@GroovyAction
                    sid
                    GroovyAction
                @/@shell/@packageCompoiste/@menuBarCompoiste/@mainCoolbar/@menuCoolItem/@menuToolbar/@fileMenu/@projectTreeMenu
                sname
                projectTreeMenu
                sstyle
                POP_UP
                sNO_RADIO_GROUP
                false
                salign
                LEFT_TO_RIGHT
                slabel
                projectTreeMenu
                sdescriptors
                xworker.swt.Commons/@Menu
                sid
                projectTreeMenu
        @/@shell/@packageCompoiste/@menuBarCompoiste/@buttonCOolbar
        sname
        buttonCOolbar
        stype
        HORIZONTAL
        sBORDER
        false
        sFLAT
        true
        sH_SCROLL
        false
        sV_SCROLL
        false
        sNO_BACKGROUND
        false
        sNO_FOCUS
        false
        sNO_MERGE_PAINTS
        false
        sNO_REDRAW_RESIZE
        false
        sNO_RADIO_GROUP
        false
        sEMBEDDED
        false
        sDOUBLE_BUFFERED
        false
        scapture
        false
        senabled
        true
        sredraw
        true
        svisible
        true
        sdescriptors
        xworker.swt.Widgets/@CoolBar
        sinheritDescription
        false
        sth_createIndex
        false
        sth_registMyChilds
        false
        sth_mark
        false
        sid
        buttonCOolbar
          @/@shell/@packageCompoiste/@menuBarCompoiste/@buttonCOolbar/@buttonCoolITem
          sname
          buttonCoolITem
          sDROP_DOWN
          false
          sxw_cl_global
          false
          stype
          HORIZONTAL
          sFLAT
          false
          sWRAP
          false
          sBORDER
          false
          sSHADOW_OUT
          false
          sRIGHT
          false
          sdescriptors
          xworker.swt.widgets.CoolBar/@CoolItem,xworker.swt.widgets.CoolBar/@CoolItem/@ToolBar
          sinheritDescription
          false
          sth_createIndex
          false
          sth_registMyChilds
          false
          sth_mark
          false
          sid
          buttonCoolITem
            @/@shell/@packageCompoiste/@menuBarCompoiste/@buttonCOolbar/@buttonCoolITem/@buttonToolbAr
            sname
            buttonToolBar
            stype
            HORIZONTAL
            sFLAT
            true
            sWRAP
            false
            sBORDER
            false
            sSHADOW_OUT
            false
            sRIGHT
            false
            sdescriptors
            xworker.swt.widgets.CoolBar/@CoolItem/@ToolBar
            sinheritDescription
            false
            sth_createIndex
            false
            sth_registMyChilds
            false
            sth_mark
            false
            sid
            buttonToolbAr
              @/@shell/@packageCompoiste/@menuBarCompoiste/@buttonCOolbar/@buttonCoolITem/@buttonToolbAr/@ttt
              sname
              ttt
              stype
              PUSH
              stext
              tttt
              senabled
              true
              sxw_cl_global
              false
              sdescriptors
              xworker.swt.widgets.ToolBar/@ToolItem
              sinheritDescription
              false
              sth_createIndex
              false
              sth_registMyChilds
              false
              sth_mark
              false
              sid
              ttt
      @/@shell/@packageCompoiste/@packageTable
      sname
      dataTable
      sselectStyle
      SINGLE
      sV_SCROLL
      true
      sH_SCROLL
      true
      sCHECK
      false
      sFULL_SELECTION
      true
      sHIDE_SELECTION
      false
      sBORDER
      true
      slineVisible
      false
      smultipleColumns
      true
      sheaderVisible
      true
      ssortIndicator
      false
      smoveableColumns
      false
      sheadImages
      false
      ssubImages
      false
      sVIRTUAL
      false
      slabel
      dataTable
      sdescriptors
      xworker.swt.Widgets/@DataTable
      sid
      packageTable
        @/@shell/@packageCompoiste/@packageTable/@packageTableGridData
        sname
        packageTableGridData
        sstyle
        FILL_BOTH
        shorizontalIndent
        0
        swidth
        -1
        sheight
        -1
        shorizontalAlignment
        BEGINNING
        sverticalAlignment
        CENTER
        shorizontalSpan
        1
        sverticalSpan
        1
        sgrabExcessHorizontalSpace
        false
        sgrabExcessVerticalSpace
        false
        slabel
        packageTableGridData
        sdescriptors
        xworker.swt.Commons/@GridData
        sid
        packageTableGridData
        @/@shell/@packageCompoiste/@packageTable/@name
        sname
        name
        stext
        res:res.w_exp:name:名称
        swidth
        200
        slabel
        name
        sdescriptors
        xworker.swt.xworker.DataTable/@TableColumn
        sid
        name
        @/@shell/@packageCompoiste/@packageTable/@label
        sname
        label
        stext
        res:res.w_exp:label:标签
        swidth
        150
        slabel
        label
        sdescriptors
        xworker.swt.xworker.DataTable/@TableColumn
        sid
        label
        @/@shell/@packageCompoiste/@packageTable/@strutureName
        sname
        strutureName
        stext
        res:res.w_exp:descriptor:描述者
        swidth
        200
        slabel
        strutureName
        sdescriptors
        xworker.swt.xworker.DataTable/@TableColumn
        sid
        strutureName
        @/@shell/@packageCompoiste/@packageTable/@lastUpdateDate
        sname
        lastUpdateDate
        stext
        res:res.w_exp:lastUpdateDate:最后修改日期
        swidth
        100
        slabel
        lastUpdateDate
        sdescriptors
        xworker.swt.xworker.DataTable/@TableColumn
        sid
        lastUpdateDate
        @/@shell/@packageCompoiste/@packageTable/@listeners
        sname
        listeners
        slabel
        listeners
        sdescriptors
        xworker.swt.events.Listeners/@listeners
        sid
        listeners
          @/@shell/@packageCompoiste/@packageTable/@listeners/@dataTableDefaultSelection
          sname
          dataTableDefaultSelection
          stype
          DefaultSelection
          slabel
          dataTableDefaultSelection
          sdescriptors
          xworker.swt.events.Listeners/@listeners/@Listener
          sid
          dataTableDefaultSelection
            @/@shell/@packageCompoiste/@packageTable/@listeners/@dataTableDefaultSelection/@GroovyAction
            sname
            GroovyAction
            sisSynchronized
            false
            sthrowException
            false
            suseOtherAction
            false
            svarScope
            Global
            sdisableGlobalContext
            false
            Scode
#$@text#$@
import org.eclipse.swt.program.Program;
import org.eclipse.swt.widgets.TreeItem;

import xworker.util.XWorkerUtils;

def item = dataTable.getSelection()[0];
def data = item.getData();

if(dataTable.getSelectionIndex() == 0 && data.type == "parent"){
    index = data.parent.parent;
    actions.doAction("refreshTable");
    
    if(actionContext.get("treeItem") != null){
        def tree = treeItem.getParent();
        treeItem = treeItem.getParentItem();
        if(treeItem != null){
            tree.setSelection(treeItem);
        }else{
            tree.setSelection([] as TreeItem[]);
        }
    }
}else if(data.type == "normalFile"){
    def f = data.file;
    def name = f.getName();
    def textNames = ["ftl","java","groovy","c", "cpp", "h","log", "properties", "conf", "txt", "scala"];
    def isText = false;
    for(text in textNames){
        if(name.endsWith(text)){
            isText = true;
            break;
        }
    }
    if(isText){
        explorerActions.doAction("openTextFile", actionContext, ["file": f]);
    }else{
        Program.launch(f.getAbsolutePath());
    }
}else if(data.type != "thing"){   
    index = data; 
    //log.info("isthing");
    actions.doAction("refreshTable");
    
    //设置窗体的树选择
    if(actionContext.get("explorerActions") != null){
        explorerActions.doAction("expandProjectTreeItem");
        def items;
        if(treeItem == null){
            items = tree.getItems();
        }else{
            items = treeItem.getItems();
        }
        
        def selectedItem = null;
        for(itemt in items){
            def idata = itemt.getData();
            //log.info(idata.type + " " + data.type);
            if(idata.type == data.type && idata.name == data.name){
                selectedItem = itemt;
                break;
            }
        }
            
        if(selectedItem != null){               
            tree.setSelection(selectedItem);
            explorerActions.doAction("expandProjectTreeItem");
            selectedItem.setExpanded(true);
            treeItem = selectedItem;
        }
        
        def index = tree.getSelection()[0].getData();
        def indexType = index.getType();
        def helpThing = null;
        if(indexType == "world"){
            helpThing = world.getThing("xworker.ide.worldExplorer.swt.help.ProjectHelps/@World");
        }else if(indexType == "workingSet"){
            helpThing = world.getThing("xworker.ide.worldExplorer.swt.help.ProjectHelps/@WorkingSet");
        }else if(indexType == "thingManager"){
            helpThing = world.getThing("xworker.ide.worldExplorer.swt.help.ProjectHelps/@ThingManager");
        }else if(indexType == "category"){
            helpThing = world.getThing("xworker.ide.worldExplorer.swt.help.ProjectHelps/@Category");
        }
        if(helpThing != null){
            def url = XWorkerUtils.getThingDescUrl(helpThing);
            packageViewerHelpBrowser.setUrl(url);
        }
    }
}else{    
    //打开数据对象
    //println data.path;
    def thing = world.getThing(data.path);
    explorerActions.doAction("openThing", ["thing":thing]);
}
#$@text#$@
            sinterpretationType
            Action
            screateLocalVarScope
            false
            ssaveReturn
            false
            sdescriptors
            xworker.lang.actions.Actions/@GroovyAction
            sid
            GroovyAction
          @/@shell/@packageCompoiste/@packageTable/@listeners/@Listener
          sname
          Listener
          stype
          Selection
          sdescriptors
          xworker.swt.events.Listeners/@listeners/@Listener
          sinheritDescription
          false
          sth_createIndex
          false
          sth_registMyChilds
          false
          sth_mark
          false
          sid
          Listener
            @/@shell/@packageCompoiste/@packageTable/@listeners/@Listener/@dataTableSelection
            sname
            dataTableSelection
            sisSynchronized
            false
            sthrowException
            true
            suseOtherAction
            false
            svarScope
            Local
            sdisableGlobalContext
            false
            Scode
#$@text#$@
import xworker.util.XWorkerUtils;

def item = dataTable.getSelection()[0];
def data = item.getData();

def index = data;

actions.doAction("refreshToolbarHelp", actionContext, ["index": index]);

//选中项目导航的相应节点
if(actionContext.get("treeItem") != null){
    for(childItem in treeItem.getItems()){
        if(childItem.getData() == data){
            treeItem.getParent().setSelection(childItem);
            actionContext.getScope(0).put("treeItem", childItem);
            break;
        }
    }
}
return;
def indexType = index.type;

def helpThing = null;
if(indexType == "world"){
    helpThing = world.getThing("xworker.ide.worldExplorer.swt.help.ProjectHelps/@World");
}else if(indexType == "workingSet"){
    helpThing = world.getThing("xworker.ide.worldExplorer.swt.help.ProjectHelps/@WorkingSet");
}else if(indexType == "thingManager"){
    helpThing = world.getThing("xworker.ide.worldExplorer.swt.help.ProjectHelps/@ThingManager");
}else if(indexType == "category"){
    helpThing = world.getThing("xworker.ide.worldExplorer.swt.help.ProjectHelps/@Category");
}else if(indexType == "parent"){
    helpThing = world.getThing("xworker.ide.worldExplorer.swt.help.ProjectHelps/@Parent");
}else if(indexType == "thing"){
    helpThing = world.getThing("xworker.ide.worldExplorer.swt.help.ProjectHelps/@Thing");
}

if(helpThing != null){
    def url = XWorkerUtils.getThingDescUrl(helpThing);
    packageViewerHelpBrowser.setUrl(url);
}else{
    packageViewerHelpBrowser.setText("未知的类型：" + indexType);
}
#$@text#$@
            sinterpretationType
            Action
            screateLocalVarScope
            false
            ssaveReturn
            false
            sdescriptors
            xworker.lang.actions.Actions/@GroovyAction
            sinheritDescription
            false
            sth_createIndex
            false
            sth_registMyChilds
            false
            sth_mark
            false
            sid
            dataTableSelection
          @/@shell/@packageCompoiste/@packageTable/@listeners/@dataTableMenuDetect
          sname
          dataTableMenuDetect
          stype
          MenuDetect
          sdescriptors
          xworker.swt.events.Listeners/@listeners/@Listener
          sinheritDescription
          false
          sth_createIndex
          false
          sth_registMyChilds
          false
          sth_mark
          false
          sid
          dataTableMenuDetect
            @/@shell/@packageCompoiste/@packageTable/@listeners/@dataTableMenuDetect/@GroovyAction
            sname
            GroovyAction
            sisSynchronized
            false
            sthrowException
            true
            suseOtherAction
            false
            svarScope
            Local
            sdisableGlobalContext
            false
            Scode
#$@text#$@
def item = dataTable.getSelection()[0];
def data = item.getData();

if(dataTable.getSelectionIndex() == 0 && data.type == "parent"){
    event.doit = false;
}
#$@text#$@
            sinterpretationType
            Action
            screateLocalVarScope
            false
            ssaveReturn
            false
            sdescriptors
            xworker.lang.actions.Actions/@GroovyAction
            sinheritDescription
            false
            sth_createIndex
            false
            sth_registMyChilds
            false
            sth_mark
            false
            sid
            GroovyAction
        @/@shell/@packageCompoiste/@packageTable/@projectTreeDragSource
        sname
        dataTableDragSource
        sDROP_NONE
        false
        sDROP_COPY
        true
        sDROP_MOVE
        true
        sDROP_LINK
        true
        sdescriptors
        xworker.swt.widgets.Control/@DragSource
        sid
        projectTreeDragSource
          @/@shell/@packageCompoiste/@packageTable/@projectTreeDragSource/@prjTxtTransfer
          sname
          tableTransfer
          stype
          Text
          sdescriptors
          xworker.swt.dnd.DragSource/@Transfer
          sid
          prjTxtTransfer
          @/@shell/@packageCompoiste/@packageTable/@projectTreeDragSource/@prjTreeDragStrat
          sname
          tableDragStrat
          stype
          DragStart
          sdescriptors
          xworker.swt.dnd.DragSource/@Listener
          sid
          prjTreeDragStrat
            @/@shell/@packageCompoiste/@packageTable/@projectTreeDragSource/@prjTreeDragStrat/@run
            sname
            run
            sisSynchronized
            false
            sthrowException
            true
            suseOtherAction
            false
            svarScope
            Global
            sdisableGlobalContext
            false
            Scode
#$@text#$@
import org.xmeta.Index;

def item = dataTable.getSelection()[0];
def data = item.getData();

if(dataTable.getSelectionIndex() == 0 && data.type == "parent"){
    event.doit = false;
}else{
    event.doit = true;
}
#$@text#$@
            sdescriptors
            xworker.lang.actions.Actions/@GroovyAction
            sid
            run
          @/@shell/@packageCompoiste/@packageTable/@projectTreeDragSource/@prjTreeSetData
          sname
          tableSetData
          stype
          DragSetData
          sdescriptors
          xworker.swt.dnd.DragSource/@Listener
          sid
          prjTreeSetData
            @/@shell/@packageCompoiste/@packageTable/@projectTreeDragSource/@prjTreeSetData/@run
            sname
            run
            sisSynchronized
            false
            sthrowException
            true
            suseOtherAction
            false
            svarScope
            Global
            sdisableGlobalContext
            false
            Scode
#$@text#$@
import org.xmeta.Category;

def item = dataTable.getSelection()[0];
def data = item.getData();
if(data.indexObject instanceof Category){
    event.data = data.indexObject.getThingManager().getName() + ":" + data.getPath();
}else{
    event.data = data.indexObject.thingManager.getName() + ":" + data.getPath();
}
#$@text#$@
            sdescriptors
            xworker.lang.actions.Actions/@GroovyAction
            sid
            run
        @/@shell/@packageCompoiste/@packageTable/@dataTableMenu
        sname
        dataTableMenu
        sstyle
        POP_UP
        sNO_RADIO_GROUP
        false
        salign
        LEFT_TO_RIGHT
        svisible
        true
        senabled
        true
        sdescriptors
        xworker.swt.Commons/@Menu
        sinheritDescription
        false
        sth_createIndex
        false
        sth_registMyChilds
        false
        sth_mark
        false
        sid
        dataTableMenu
          @/@shell/@packageCompoiste/@packageTable/@dataTableMenu/@renameMenuItem
          sname
          renameMenuItem
          stext
          重命名
          sstyle
          PUSH
          sselected
          false
          senabled
          true
          sdescriptors
          xworker.swt.widgets.Menu/@MenuItem
          sinheritDescription
          false
          sth_createIndex
          false
          sth_registMyChilds
          false
          sth_mark
          false
          sid
          renameMenuItem
            @/@shell/@packageCompoiste/@packageTable/@dataTableMenu/@renameMenuItem/@listeners
            sname
            listeners
            sdescriptors
            xworker.swt.events.Listeners/@listeners
            sinheritDescription
            false
            sth_createIndex
            false
            sth_registMyChilds
            false
            sth_mark
            false
            sid
            listeners
              @/@shell/@packageCompoiste/@packageTable/@dataTableMenu/@renameMenuItem/@listeners/@Listener
              sname
              Listener
              stype
              Selection
              sdescriptors
              xworker.swt.events.Listeners/@listeners/@Listener
              sinheritDescription
              false
              sth_createIndex
              false
              sth_registMyChilds
              false
              sth_mark
              false
              sid
              Listener
                @/@shell/@packageCompoiste/@packageTable/@dataTableMenu/@renameMenuItem/@listeners/@Listener/@GroovyAction
                sname
                GroovyAction
                sisSynchronized
                false
                sthrowException
                true
                suseOtherAction
                false
                svarScope
                Local
                sdisableGlobalContext
                false
                Scode
#$@text#$@
import org.eclipse.swt.program.Program;
import org.eclipse.swt.widgets.TreeItem;
import org.eclipse.swt.widgets.MessageBox;

import xworker.util.XWorkerUtils;

import org.xmeta.ActionContext;

def item = dataTable.getSelection()[0];
def data = item.getData();

if(dataTable.getSelectionIndex() == 0 && data.type == "parent"){
}else if(data.type == "normalFile"){
    def f = data.file;
    def ac = new ActionContext();
    ac.put("parent", dataTable.getShell());
    ac.put("explorerActions", explorerActions);
    ac.put("explorerActionContext", explorerActionContext);
    ac.put("file", f);
    
    def shell = world.getThing("xworker.ide.worldExplorer.swt.dialogs.RenameFileDialog").doAction("create", ac);
    shell.open();
}else if(data.type != "thing"){   
    println("ddata=" + data.getIndexedObject());
}else{    
    //打开数据对象
    //println data.path;
    def thing = world.getThing(data.path);
    def ac = new ActionContext();
    ac.put("parent", dataTable.getShell());
    ac.put("explorerActions", explorerActions);
    ac.put("explorerActionContext", explorerActionContext);
    ac.put("thing", thing);
    
    def shell = world.getThing("xworker.ide.worldExplorer.swt.dialogs.RenameThingDialog").doAction("create", ac);
    shell.open();
}
#$@text#$@
                sinterpretationType
                Action
                screateLocalVarScope
                false
                ssaveReturn
                false
                sdescriptors
                xworker.lang.actions.Actions/@GroovyAction
                sinheritDescription
                false
                sth_createIndex
                false
                sth_registMyChilds
                false
                sth_mark
                false
                sid
                GroovyAction
          @/@shell/@packageCompoiste/@packageTable/@dataTableMenu/@separator1
          sname
          separator1
          sstyle
          SEPARATOR
          sselected
          false
          senabled
          true
          sdescriptors
          xworker.swt.widgets.Menu/@MenuItem
          sinheritDescription
          false
          sth_createIndex
          false
          sth_registMyChilds
          false
          sth_mark
          false
          sid
          separator1
          @/@shell/@packageCompoiste/@packageTable/@dataTableMenu/@deleteMenuItem
          sname
          deleteMenuItem
          stext
          删除
          sstyle
          PUSH
          sselected
          false
          senabled
          true
          sdescriptors
          xworker.swt.widgets.Menu/@MenuItem
          sinheritDescription
          false
          sth_createIndex
          false
          sth_registMyChilds
          false
          sth_mark
          false
          sid
          deleteMenuItem
            @/@shell/@packageCompoiste/@packageTable/@dataTableMenu/@deleteMenuItem/@listeners
            sname
            listeners
            sdescriptors
            xworker.swt.events.Listeners/@listeners
            sinheritDescription
            false
            sth_createIndex
            false
            sth_registMyChilds
            false
            sth_mark
            false
            sid
            listeners
              @/@shell/@packageCompoiste/@packageTable/@dataTableMenu/@deleteMenuItem/@listeners/@deleteMenuItemSelection
              sname
              deleteMenuItemSelection
              stype
              Selection
              sdescriptors
              xworker.swt.events.Listeners/@listeners/@Listener
              sinheritDescription
              false
              sth_createIndex
              false
              sth_registMyChilds
              false
              sth_mark
              false
              sid
              deleteMenuItemSelection
                @/@shell/@packageCompoiste/@packageTable/@dataTableMenu/@deleteMenuItem/@listeners/@deleteMenuItemSelection/@GroovyAction
                sname
                GroovyAction
                sisSynchronized
                false
                sthrowException
                true
                suseOtherAction
                false
                svarScope
                Local
                sdisableGlobalContext
                false
                Scode
#$@text#$@
import org.eclipse.swt.SWT;
import org.eclipse.swt.program.Program;
import org.eclipse.swt.widgets.TreeItem;
import org.eclipse.swt.widgets.MessageBox;

import xworker.util.XWorkerUtils;

import org.xmeta.ActionContext;

def box = new MessageBox(dataTable.getShell(), SWT.ICON_WARNING | SWT.OK | SWT.CANCEL);
box.setText("删除");
box.setMessage("确定要删除选中的事物或文件么？");
if(SWT.CANCEL == box.open()){
    return;
}

def item = dataTable.getSelection()[0];
def data = item.getData();

if(dataTable.getSelectionIndex() == 0 && data.type == "parent"){
}else if(data.type == "normalFile"){
    def f = data.file;    
    explorerActions.doAction("closeTab", explorerActionContext, ["path": "textFile" + f.getAbsolutePath()]);
    f.delete();
}else if(data.type != "thing"){   
    println("ddata=" + data.getIndexedObject());
}else{    
    //打开数据对象
    //println data.path;
    def thing = world.getThing(data.path);
    if(thing != null){
        explorerActions.doAction("closeTab", explorerActionContext, ["path": thing.getMetadata().getPath()]);
        thing.remove();
    }
        
}

actions.doAction("refreshTable", actionContext, ["index": projectTree.getSelection()[0].getData()]);
#$@text#$@
                sinterpretationType
                Action
                screateLocalVarScope
                false
                ssaveReturn
                false
                sdescriptors
                xworker.lang.actions.Actions/@GroovyAction
                sinheritDescription
                false
                sth_createIndex
                false
                sth_registMyChilds
                false
                sth_mark
                false
                sid
                GroovyAction
      @/@shell/@packageCompoiste/@actions1
      sname
      actions
      slabel
      actions
      sdescriptors
      xworker.swt.Widgets/@actions
      sid
      actions1
        @/@shell/@packageCompoiste/@actions1/@refreshTable
        sname
        refreshTable
        sisSynchronized
        false
        sthrowException
        false
        suseOtherAction
        false
        svarScope
        Global
        sdisableGlobalContext
        false
        Scode
#$@text#$@
import java.io.File;

import xworker.util.UtilFileIcon;
import org.eclipse.swt.program.Program;
import org.eclipse.swt.graphics.Image;

import org.xmeta.Index;

import org.xmeta.util.UtilString;
import org.xmeta.thingManagers.FileThingManager;

//取索引
if(actionContext.get("index") == null){
    index = Index.getInstance();
}

//println UtilGroovy.getProperty(binding, "refresh");
if(index == dataTable.getData("oldIndex") && actionContext.get("refresh") != true){
    //return;
}

//更新表格的数据
dataTable.removeAll();

def res = packageCompoiste.getData("resources");
if(index.getType() != "world"){
    def parent = index.getParent();
    def item = dataTable.updateRow(null, -1, ["name":"..", "parent":index, "type":"parent"]);
    if(res != null && res.parentImage != null)
        item.setImage(res.parentImage);
}

titleLabel.setText(UtilString.getString("res:res.w_exp:pathLabel:路径：", actionContext) + index.getPath());
index.refresh();
for(child in index.getChilds()){    
    def item = dataTable.updateRow(null, -1, child);
    if(res != null){
        setImage(item, child, res);
    }
}

dataTable.setData("oldIndex", index);

actions.doAction("refreshToolbarHelp", actionContext);


//刷新表格的文件，取消了Project，此功能目前不正常暂时屏蔽
def fdir = null;
if(index.getType() == "category"){
    def path = index.getPath();
    def thingManager = index.getIndexObject().getThingManager();
    if(thingManager instanceof FileThingManager){
        fdir = new File(thingManager.getFilePath(), path.replace('.', '/'));
    }
}else if(index.getType() == "thingManager"){
    def thingManager = index.getIndexObject();
    if(thingManager instanceof FileThingManager){
        fdir = new File(thingManager.getFilePath());
    }
}
if(fdir != null){
    for(f in fdir.listFiles()){
        if(f.isDirectory() || isThingFile(f.getName())) continue;    
        def item = dataTable.updateRow(null, -1, ["name":f.getName(), "parent":index, "type":"normalFile", "file":f]);
        int lastDot = f.getName().lastIndexOf('.');
        if(lastDot >= 0 && lastDot < f.getName().length()) {
            def icon = getIcon(f.getName().substring(lastDot+1));
            if(icon != null && icon instanceof Image){
                item.setImage(0, icon);
            }
        }    
    }
}

def isThingFile(fileName){
   for(coder in world.getThingCoders()){
       if(fileName.endsWith(coder.getType())){
           return true;
       }
   }
   
   return false;
}

def setImage(item, data, ress){
    if(data.type == "projects" || data.type == "plugins" || data.type == "childWorlds"){
        item.setImage(ress.projectImage);
    }else if(data.type == "project"){
        //println item;
        item.setImage(ress.project1Image);
    }else if((data.type == "category" && data.name == "") || data.type == "thingManager"){
        item.setImage(ress.factoryImage);
    }else if(data.type == "category"){
        item.setImage(ress.packageImage);
    }else if(data.type == "thing"){
        item.setImage(ress.dataObjectImage);
    }else if(data.type == "workingSet"){
        item.setImage(ress.worksetImage);
    }
}

def getIcon(String extension) {
    return UtilFileIcon.getFileIcon(extension, false);
    /*
    if(actionContext.get("imageRegistry") == null){
        def imageRegistry = new ImageRegistry();
        actionContext.put("imageRegistry", imageRegistry);
    }
    //if(imageRegistry == null)
    //    imageRegistry = new ImageRegistry();
    Image image = imageRegistry.get(extension);
    if(image != null)
        return image;
    
    Program program = Program.findProgram(extension);
    if(program != null) {
        image = new Image(dataTable.getDisplay(), program.getImageData());
        imageRegistry.put(extension, image);
    }else{
        imageRegistry.put(extension, normalFileImage);
    }
    
    return image;*/
}
#$@text#$@
        sinterpretationType
        Action
        screateLocalVarScope
        false
        ssaveReturn
        false
        sdebugLog
        false
        sdescriptors
        xworker.lang.actions.Actions/@GroovyAction
        sid
        refreshTable
          @/@shell/@packageCompoiste/@actions1/@refreshTable/@contexts
          sname
          contexts
          slabel
          contexts
          sdescriptors
          xworker.lang.actions.Inout/@contexts
          sid
          contexts
            @/@shell/@packageCompoiste/@actions1/@refreshTable/@contexts/@performance
            slabel
            RefreshTable
            sshowSecond
            false
            sname
            performance
            sconflicting
            ignore
            sdisable
            true
            sonError
            ignore
            spreventError
            false
            sinherit
            true
            sdescriptors
            xworker.lang.context.PerformanceContext,xworker.lang.actions.Inout/@contexts/@context
            sid
            performance
        @/@shell/@packageCompoiste/@actions1/@refreshToolbarHelp
        sname
        refreshToolbarHelp
        sisSynchronized
        false
        sthrowException
        true
        suseOtherAction
        false
        svarScope
        Local
        sdisableGlobalContext
        false
        Scode
#$@text#$@
import xworker.util.XWorkerUtils;

//根据索引显示帮助和ToolBar
def indexType = index.type;

def helpThing = null;
def toolbarThing = null;
if(indexType == "world"){
    helpThing = world.getThing("xworker.ide.worldExplorer.swt.help.ProjectHelps/@World");
    toolbarThing = world.getThing("xworker.ide.worldExplorer.swt.dataExplorerParts.PackageViewerToolbars/@mainCoolBar/@mainCollItem/@mainToolBar");
    //titleLabel.setText("
}else if(indexType == "workingSet"){
    helpThing = world.getThing("xworker.ide.worldExplorer.swt.help.ProjectHelps/@WorkingSet");
    toolbarThing = world.getThing("xworker.ide.worldExplorer.swt.dataExplorerParts.PackageViewerToolbars/@mainCoolBar/@mainCollItem/@mainToolBar");
    titleLabel.setText("工作组：" + index.label);
}else if(indexType == "thingManager"){
    helpThing = world.getThing("xworker.ide.worldExplorer.swt.help.ProjectHelps/@ThingManager");
    toolbarThing = world.getThing("xworker.ide.worldExplorer.swt.dataExplorerParts.PackageViewerToolbars/@mainCoolBar/@mainCollItem/@thingManagerToolBar");
    titleLabel.setText("事物管理器：" + index.label);
}else if(indexType == "category"){
    helpThing = world.getThing("xworker.ide.worldExplorer.swt.help.ProjectHelps/@Category");
    toolbarThing = world.getThing("xworker.ide.worldExplorer.swt.dataExplorerParts.PackageViewerToolbars/@mainCoolBar/@mainCollItem/@categoryToolBar");
    titleLabel.setText("目录：" + index.path);
}else if(indexType == "parent"){
    helpThing = world.getThing("xworker.ide.worldExplorer.swt.help.ProjectHelps/@Parent");
}else if(indexType == "thing"){
    helpThing = world.getThing("xworker.ide.worldExplorer.swt.help.ProjectHelps/@Thing");
    toolbarThing = world.getThing("xworker.ide.worldExplorer.swt.dataExplorerParts.PackageViewerToolbars/@mainCoolBar/@mainCollItem/@thingToolBAr");
    titleLabel.setText("事物：" + index.label + "，路径：" + index.path);
}

if(actionContext.get("packageViewerHelpBrowser") != null){
    if(helpThing != null){
        def url = XWorkerUtils.getThingDescUrl(helpThing);
        packageViewerHelpBrowser.setUrl(url);
    }else{
        packageViewerHelpBrowser.setText("未知的类型：" + indexType);
    }
}

for(item in buttonToolBar.getItems()){
    item.dispose();
}

if(toolbarThing != null){
    actionContext.peek().put("parent", buttonToolBar);
    for(child in toolbarThing.getChilds()){
        child.doAction("create", actionContext);
    }
    
    menuBarCompoiste.layout();
    buttonToolBar.update();
}
#$@text#$@
        sinterpretationType
        Action
        screateLocalVarScope
        false
        ssaveReturn
        false
        sdescriptors
        xworker.lang.actions.Actions/@GroovyAction
        sinheritDescription
        false
        sth_createIndex
        false
        sth_registMyChilds
        false
        sth_mark
        false
        sid
        refreshToolbarHelp
      @/@shell/@packageCompoiste/@initCode
      sname
      initCode
      sisSynchronized
      false
      sthrowException
      true
      suseOtherAction
      false
      svarScope
      Local
      sdisableGlobalContext
      false
      Scode
#$@text#$@
import xworker.ui.swt.SwtBorder;

//标题的边框
SwtBorder.attach(titleComposite);
dataTable.setColumnNames(["name", "label", "descriptors", "lastDate"] as String[]);

//初始化表格
actions.doAction("refreshTable");

//文件的菜单先不需要了，暂时屏蔽
mainCoolbar.dispose();
#$@text#$@
      sinterpretationType
      Action
      screateLocalVarScope
      false
      ssaveReturn
      false
      sdescriptors
      xworker.swt.Widgets/@Code
      sid
      initCode
  @/@packageViewerHelpBrowser
  sname
  packageViewerHelpBrowser
  slabel
  packageViewerHelpBrowser
  sdescriptors
  xworker.swt.browser.Browser
  sid
  packageViewerHelpBrowser
    @/@packageViewerHelpBrowser/@helpBrowerUtilBrowser
    sname
    helpBrowerUtilBrowser
    sdescriptors
    xworker.swt.browser.Browser/@UtilBrowser
    sid
    helpBrowerUtilBrowser
