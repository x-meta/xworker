%1482289566350
@
sname=shell
stext=移除项目
sNO_TRIM=false
sCLOSE=true
sTITLE=true
sMIN=true
sMAX=true
sBORDER=false
sRESIZE=true
sON_TOP=false
sTOOL=false
sNO_FOCUS=false
swidth=400
sheight=300
scenterScreen=true
spack=true
smaximized=false
sfullScreen=false
sdesign=true
sisIde=false
sdesignDefaultOpen=false
sH_SCROLL=false
sV_SCROLL=false
sNO_BACKGROUND=false
sNO_MERGE_PAINTS=false
sNO_REDRAW_RESIZE=false
sNO_RADIO_GROUP=false
sEMBEDDED=false
sDOUBLE_BUFFERED=false
slabel=DeleteProjectDialog
scapture=false
senabled=true
sredraw=true
svisible=true
sdescriptors=xworker.swt.widgets.Shell
sinheritDescription=false
sth_createIndex=false
sth_registMyChilds=false
sth_registDisabled=false
sth_mark=false
  @/@shellGridLayout
  sname=shellGridLayout
  snumColumns=1
  smakeColumnsEqualWidth=false
  smarginWidth=5
  smarginHeight=5
  smarginLeft=0
  smarginTop=0
  smarginRight=0
  smarginBottom=0
  shorizontalSpacing=5
  sverticalSpacing=5
  sdescriptors=xworker.swt.Layouts/@GridLayout
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=shellGridLayout
  @/@resources
  sname=resources
  sdescriptors=xworker.swt.Widgets/@Resource
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=resources
    @/@resources/@questionImage
    sname=questionImage
    simage=QUESTION
    sdescriptors=xworker.swt.util.Resource/@SystemImage
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=questionImage
  @/@formCompoiste
  sname=formCompoiste
  sBORDER=false
  sH_SCROLL=false
  sV_SCROLL=false
  sNO_BACKGROUND=false
  sNO_FOCUS=false
  sNO_MERGE_PAINTS=false
  sNO_REDRAW_RESIZE=false
  sNO_RADIO_GROUP=false
  sEMBEDDED=false
  sDOUBLE_BUFFERED=false
  scapture=false
  senabled=true
  sredraw=true
  svisible=true
  sdescriptors=xworker.swt.Widgets/@Composite
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=formCompoiste
    @/@formCompoiste/@shellGridLayout
    sname=formGridLayout
    snumColumns=2
    smakeColumnsEqualWidth=false
    smarginWidth=5
    smarginHeight=5
    smarginLeft=0
    smarginTop=0
    smarginRight=0
    smarginBottom=0
    shorizontalSpacing=5
    sverticalSpacing=5
    sdescriptors=xworker.swt.Layouts/@GridLayout
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=shellGridLayout
    @/@formCompoiste/@formCompositeGridData
    sname=formCompositeGridData
    sstyle=FILL_BOTH
    shorizontalIndent=0
    swidth=-1
    sheight=-1
    shorizontalAlignment=BEGINNING
    sverticalAlignment=CENTER
    shorizontalSpan=1
    sverticalSpan=1
    sgrabExcessHorizontalSpace=false
    sgrabExcessVerticalSpace=false
    sxw_cl_global=false
    sdescriptors=xworker.swt.layout.LayoutDatas/@GridData
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=formCompositeGridData
    @/@formCompoiste/@resources
    sname=resources
    sdescriptors=xworker.swt.Widgets/@Resource
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=resources
      @/@formCompoiste/@resources/@questionImage
      sname=questionImage
      simage=QUESTION
      sdescriptors=xworker.swt.util.Resource/@SystemImage
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=questionImage
    @/@formCompoiste/@infoLabel
    sname=infoImage
    sBORDER=false
    simage=questionImage
    stype=HORIZONTAL
    salignment=RIGHT
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Label
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=infoLabel
    @/@formCompoiste/@infoLabel1
    sname=infoLabel
    sBORDER=false
    stype=HORIZONTAL
    salignment=LEFT
    stext=确定要删除项目么？
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Label
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=infoLabel1
    @/@formCompoiste/@resButton
    sname=resButton
    stype=SWT.CHECK
    sflat=false
    sborder=false
    sselected=false
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Button
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=resButton
    @/@formCompoiste/@deleteResInfo
    sname=deleteResInfo
    sBORDER=false
    sstyle=WRAP
    stype=VERTICAL
    salignment=LEFT
    Stext=
#$@text#$@
是否同时删除磁盘上的资源文件。（删除后不可恢复）
如果项目移除后系统重启后还在，那么移除时需要同时删除磁盘上的资源文件。
#$@text#$@
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Label
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=deleteResInfo
    @/@formCompoiste/@nameLabel
    sname=nameLabelLabel
    sBORDER=false
    sstyle=WRAP
    stype=HORIZONTAL
    sshadow=SHADOW_IN
    salignment=LEFT
    stext=项目名称：
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Label
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=nameLabel
    @/@formCompoiste/@nameLabel1
    sname=nameLabel
    sBORDER=false
    sstyle=WRAP
    stype=HORIZONTAL
    sshadow=SHADOW_IN
    salignment=LEFT
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Label
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=nameLabel1
    @/@formCompoiste/@typeLabelLabel
    sname=typeLabelLabel
    sBORDER=false
    stype=HORIZONTAL
    salignment=LEFT
    stext=项目类型：
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Label
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=typeLabelLabel
    @/@formCompoiste/@Label
    sname=typeLabel
    sBORDER=false
    stype=HORIZONTAL
    salignment=LEFT
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Label
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=Label
    @/@formCompoiste/@Label1
    sname=pathLabelLabel
    sBORDER=false
    stype=HORIZONTAL
    salignment=LEFT
    stext=项目路径：
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Label
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=Label1
    @/@formCompoiste/@Label2
    sname=pathLabel
    sBORDER=false
    stype=HORIZONTAL
    salignment=LEFT
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Label
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=Label2
  @/@70105
  sname=buttonComposite
  sBORDER=false
  sH_SCROLL=false
  sV_SCROLL=false
  sNO_BACKGROUND=false
  sNO_FOCUS=false
  sNO_MERGE_PAINTS=false
  sNO_REDRAW_RESIZE=false
  sNO_RADIO_GROUP=false
  sEMBEDDED=false
  sDOUBLE_BUFFERED=false
  scapture=false
  senabled=true
  sredraw=true
  svisible=true
  sdescriptors=xworker.swt.Widgets/@Composite
  sid=70105
    @/@70105/@70106
    sname=buttonCompositeGridData
    sstyle=FILL_HORIZONTAL
    shorizontalIndent=0
    swidth=-1
    sheight=-1
    shorizontalAlignment=END
    sverticalAlignment=CENTER
    shorizontalSpan=1
    sverticalSpan=1
    sgrabExcessHorizontalSpace=false
    sgrabExcessVerticalSpace=false
    sdescriptors=xworker.swt.layout.LayoutDatas/@GridData
    sid=70106
    @/@70105/@70107
    sname=buttonCompositeRowLayout
    sfill=false
    sjustify=false
    smarginWidth=0
    smarginHeight=0
    smarginLeft=3
    smarginTop=3
    smarginRight=3
    smarginBottom=3
    spack=true
    sspacing=3
    stype=SWT.HORIZONTAL
    swrap=true
    sdescriptors=xworker.swt.Layouts/@RowLayout
    sid=70107
    @/@70105/@70108
    sname=okButton
    stext=确定
    stype=SWT.PUSH
    sflat=false
    sborder=false
    sselected=false
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Button
    sth_createIndex=false
    sid=70108
      @/@70105/@70108/@70109
      sname=RowData
      sexclude=false
      swidth=80
      sheight=-1
      sdescriptors=xworker.swt.layout.LayoutDatas/@RowData
      sth_createIndex=false
      sid=70109
      @/@70105/@70108/@70110
      sname=Listeners
      sdescriptors=xworker.swt.widgets.Widget/@Listeners
      sth_createIndex=false
      sid=70110
        @/@70105/@70108/@70110/@70111
        sname=okButtonSelection
        stype=Selection
        sdescriptors=xworker.swt.events.Listeners/@listeners/@Listener
        sth_createIndex=false
        sid=70111
          @/@70105/@70108/@70110/@70111/@GroovyAction
          sname=GroovyAction
          sisSynchronized=false
          sthrowException=true
          suseOtherAction=false
          svarScope=Local
          sdisableGlobalContext=false
          Scode=
#$@text#$@
import xworker.util.XWorkerUtils;

//移除项目
def deleteRes = resButton.getSelection();
world.removeThingManager(thingManager, deleteRes);

//从WrkingSet中删除索引   
def workingSet = world.getThing("_local.xworker.worldExplorer.WorkingSet");
if(workingSet != null){
    deleteWorkingSet(workingSet, thingManager.getName());
    workingSet.save();
}

//从自动加载的Project中移除
def projectSet = world.getThing("_local.xworker.worldExplorer.ProjectSet");
if(projectSet != null){
   for(prj in projectSet.getChilds()){
       def dir = thingManager.getRootDir();
       if(prj.getMetadata().getName() == thingManager.getName() ||
              dir != null && dir.getPath().equals(prj.getString("dir"))){
           projectSet.removeChild(prj);
           projectSet.save();
           //break;
       }
   } 
}

//刷新事物管理器的项目导航
XWorkerUtils.getIdeActionContainer().doAction("refreshProjectTree");

shell.dispose();

def deleteWorkingSet(thing, thingManagerName){
    def ok = false;
    def list = [];
    for(child in thing.getChilds()){
        if(child.getThingName() == "ThingManager"){
            if(child.getString("name") == thingManagerName){
                list.add(child);
            }
        }else{
            ok = ok | deleteWorkingSet(child, thingManagerName);
        }
    }
    
    for(delChild in list){
        thing.removeChild(delChild);
        ok = true;
    }
    
    return ok;
}
#$@text#$@
          sinterpretationType=Action
          screateLocalVarScope=false
          ssaveReturn=false
          sdebugLog=false
          sdescriptors=xworker.lang.actions.Actions/@GroovyAction
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_mark=false
          sid=GroovyAction
    @/@70105/@70112
    sname=cancelButton
    stext=取消
    stype=SWT.PUSH
    sflat=false
    sborder=false
    sselected=false
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Button
    sth_createIndex=false
    sid=70112
      @/@70105/@70112/@70113
      sname=RowData
      sexclude=false
      swidth=80
      sheight=-1
      sdescriptors=xworker.swt.layout.LayoutDatas/@RowData
      sth_createIndex=false
      sid=70113
      @/@70105/@70112/@70114
      sname=Listeners
      sdescriptors=xworker.swt.widgets.Widget/@Listeners
      sth_createIndex=false
      sid=70114
        @/@70105/@70112/@70114/@70115
        sname=cancelButtonSelection
        stype=Selection
        sdescriptors=xworker.swt.events.Listeners/@listeners/@Listener
        sth_createIndex=false
        sid=70115
          @/@70105/@70112/@70114/@70115/@Dispose
          sname=Dispose
          scontrolList=shell
          sinterpretationType=Self
          sattributeTemplate=false
          schildsAttributeTemplate=false
          svarScope=Local
          sisSynchronized=false
          sthrowException=true
          suseOtherAction=false
          screateLocalVarScope=false
          ssaveReturn=false
          sdisableGlobalContext=false
          sdebugLog=false
          sdescriptors=xworker.swt.actions.ControlActions/@Dispose
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_mark=false
          sid=Dispose
  @/@ini
  sname=init
  sisSynchronized=false
  sthrowException=true
  suseOtherAction=false
  svarScope=Local
  sdisableGlobalContext=false
  Scode=
#$@text#$@
import org.eclipse.swt.SWT;
import org.eclipse.swt.widgets.MessageBox;

if(actionContext.get("thingManager") == null){
    def box = new MessageBox(shell, SWT.ICON_INFORMATION | SWT.OK);
    box.setText("删除项目");
    box.setMessage("没有设置项目！");
    box.open();
    
    okButton.setEnabled(false);
    return;
}

infoLabel.setText("想要从XWorker中移除项目" + thingManager.getName() + "么?");
nameLabel.setText(thingManager.getName());
typeLabel.setText(thingManager.getClass().getSimpleName());
def rootDir = thingManager.getRootDir();
if(rootDir != null){
    //查看是否是xworker的下的项目
    if(rootDir.getPath().startsWith(world.getPath())){
        deleteResInfo.setText("项目在XWorker的projects目录下，移除需要同时删除磁盘上的资源。（不可恢复）\n" +
                   "如果不删除磁盘上的资源，下次重启事物管理器项目仍然存在。" );
        resButton.setSelection(true);
        //resButton.setEnabled(false)
    }
    pathLabel.setText(thingManager.getRootDir().getPath());
}
#$@text#$@
  sinterpretationType=Action
  screateLocalVarScope=false
  ssaveReturn=false
  sdebugLog=false
  sdescriptors=xworker.swt.widgets.Widget/@Code
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=ini
