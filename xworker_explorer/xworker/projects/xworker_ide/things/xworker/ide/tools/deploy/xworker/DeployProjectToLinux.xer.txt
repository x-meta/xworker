^1425376552203
@
sname
DeployProjectToLinux
slabel
DeployProjectToLinux
sdescriptors
xworker.lang.MetaDescriptor3
smany
true
seditCols
2
sinitialization
false
smodifier
public
sinheritDescription
false
Sdescription
#$@text#$@
<p>发布一个项目到linux的xworker的projects下，通过ssh和scp，将拷贝指定的项目并且覆盖远程的项目。</p>

<p><strong>SessionThing（会话事物）</strong></p>

<p>&nbsp;&nbsp;&nbsp;&nbsp; 新建事物时使用net.ssh.jsch下的会话事物。</p>

<p>&nbsp;</p>
#$@text#$@
snotXmlAttribute
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions
sname
actions
sdescriptors
xworker.lang.MetaDescriptor3/@actions
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run
sname
run
schangeSelf
true
sselfVarName
data
sinterpretationType
Self
sattributeTemplate
false
schildsAttributeTemplate
false
svarScope
Local
sisSynchronized
false
sthrowException
true
suseOtherAction
false
screateLocalVarScope
false
ssaveReturn
false
sdisableGlobalContext
false
sdescriptors
xworker.lang.actions.Actions/@ActionGroup
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions
sname
actions
sdescriptors
xworker.lang.actions.Begin/@actions
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@init
sname
init
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Local
sdisableGlobalContext
false
Scode
#$@text#$@
import org.xmeta.thingManagers.FileThingManager;

//变量范围
def scope = actionContext.getScope();

//会话
def sessionThing = world.getThing(data.getString("sessionThing"));
if(sessionThing == null){
    log.error("session thing is null, path=" + data.getMetadata().getPath());
    return;
}
scope.put("sessionPath", sessionThing.getMetadata().getPath());

//项目路径，压缩包路径
def projectName = data.getString("projectName");
def thingManager = world.getThingManager(data.getString("projectName"));
if(thingManager == null){
    log.error("project(ThingManager) is null, path=" + data.getMetadata().getPath());
}
if(!(thingManager instanceof FileThingManager)){
    log.error("current only supoort FileThingManager " + data.getString("projectName") + " is " + thingManager.class + ", path=" + data.getMetadata().getPath());
}
def projectPath = thingManager.getFilePath();
def parentFile = new File(projectPath).getParentFile();
scope.put("projectPath", parentFile.getAbsolutePath());
scope.put("projectName", projectName);
def zipPath = new File(world.getPath() + "/work/deploy/", projectName + ".zip");
if(!zipPath.getParentFile().exists()){
    zipPath.getParentFile().mkdirs();
}

zipPath = zipPath.getAbsolutePath();
scope.put("zipPath", zipPath);

//远程资源的路径
scope.put("remoteZipPath", data.getString("remoteXWorkerPath") + "/projects/" + projectName + ".zip");
scope.put("remotePath", data.getString("remoteXWorkerPath") + "/projects/");
#$@text#$@
sinterpretationType
Action
screateLocalVarScope
false
ssaveReturn
false
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@zipProject
sname
zipProject
ssourceFile
var:projectPath
stargetZipFile
var:zipPath
sincludeRootDir
true
sinterpretationType
Self
sattributeTemplate
false
schildsAttributeTemplate
false
svarScope
Local
sisSynchronized
false
sthrowException
true
suseOtherAction
false
screateLocalVarScope
false
ssaveReturn
false
sdisableGlobalContext
false
sdescriptors
xworker.java.util.ZipCompress
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@copyToServer
sname
copyToServer
ssessionPath
var:sessionPath
slocalFile
var:zipPath
sremoteFile
var:remoteZipPath
srunBackground
false
scloseSession
true
sinterpretationType
Self
sattributeTemplate
false
schildsAttributeTemplate
false
svarScope
Local
sisSynchronized
false
sthrowException
true
suseOtherAction
false
screateLocalVarScope
false
ssaveReturn
false
sdisableGlobalContext
false
sdescriptors
xworker.net.jsch.ScpTo
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@actions/@run/@actions/@unzipFile
sname
unzipFile
ssessionPath
var:sessionPath
Scommand
#$@text#$@
template:cd ${remotePath}
unzip -o ${projectName}.zip
rm -r ${projectName}.zip
#$@text#$@
scloseSession
true
srunBackground
false
sinterpretationType
Self
sattributeTemplate
false
schildsAttributeTemplate
false
svarScope
Local
sisSynchronized
false
sthrowException
true
suseOtherAction
false
screateLocalVarScope
false
ssaveReturn
false
sdisableGlobalContext
false
sdescriptors
xworker.net.jsch.Exec
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@name
sname
name
sshowLabel
true
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
snotXmlAttribute
false
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@label
sname
label
sshowLabel
true
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
snotXmlAttribute
false
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@serverSessionThing
sname
sessionThing
sinputtype
dataSelector
sshowLabel
true
ssize
60
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
snotXmlAttribute
false
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@projectName
sname
projectName
sinputtype
select
sshowLabel
true
sinputattrs
xworker.ide.worldexplorer.actions.WorldExplorStores/@ThingManagerStore,20,null
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
snotXmlAttribute
false
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@remoteXWorkerPath
sname
remoteXWorkerPath
sshowLabel
true
ssize
60
sreadOnly
false
sdefault
/usr/local/xworker/
sinheritDescription
false
sdescription
<p>远程服务器XWorker的路径。</p>
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
snotXmlAttribute
false
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@description
sname
description
sinputtype
html
sshowLabel
true
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
snotXmlAttribute
false
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
