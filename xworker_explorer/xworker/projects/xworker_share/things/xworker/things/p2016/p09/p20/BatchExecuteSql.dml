%1478764309764
@
sname=BatchExecuteSql
sBORDER=false
sH_SCROLL=false
sV_SCROLL=false
sNO_BACKGROUND=false
sNO_FOCUS=false
sNO_MERGE_PAINTS=false
sNO_REDRAW_RESIZE=false
sNO_RADIO_GROUP=false
sEMBEDDED=false
sDOUBLE_BUFFERED=false
slabel=批量执行SQL(每行一个SQL)
scapture=false
senabled=true
sredraw=true
svisible=true
sdescriptors=xworker.swt.widgets.Composite
sinheritDescription=false
sth_createIndex=true
sth_registThing=command|xworker.app.db.manager.DbToolsComposites
sth_registMyChilds=false
sth_registDisabled=false
sgroup=通用
sth_mark=false
  @/@compositeGridLayout
  sname=compositeGridLayout
  smakeColumnsEqualWidth=false
  smarginWidth=5
  smarginHeight=5
  smarginLeft=0
  smarginTop=0
  smarginRight=0
  smarginBottom=0
  shorizontalSpacing=5
  sverticalSpacing=5
  sdescriptors=xworker.swt.Layouts/@GridLayout
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=compositeGridLayout
  @/@sqlText
  sname=sqlText
  sstyle=MULTI
  sFULL_SELECTION=false
  sREAD_ONLY=false
  sWRAP=false
  sH_SCROLL=true
  sV_SCROLL=true
  sBORDER=false
  salign=LEFT
  sNO_BACKGROUND=false
  sNO_FOCUS=false
  sNO_MERGE_PAINTS=false
  sNO_REDRAW_RESIZE=false
  sNO_RADIO_GROUP=false
  sEMBEDDED=false
  sDOUBLE_BUFFERED=false
  scapture=false
  senabled=true
  sredraw=true
  svisible=true
  sdescriptors=xworker.swt.Widgets/@StyledText
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=sqlText
    @/@sqlText/@sqlTextGridData
    sname=sqlTextGridData
    sstyle=FILL_BOTH
    shorizontalIndent=0
    swidth=-1
    sheight=-1
    shorizontalAlignment=BEGINNING
    sverticalAlignment=CENTER
    shorizontalSpan=1
    sverticalSpan=1
    sgrabExcessHorizontalSpace=false
    sgrabExcessVerticalSpace=false
    sxw_cl_global=false
    sdescriptors=xworker.swt.Commons/@GridData
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=sqlTextGridData
    @/@sqlText/@Colorer
    sname=Colorer
    scodeName=sql
    scodeType=sql
    sdescriptors=xworker.swt.custom.StyledText/@Colorer
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=Colorer
  @/@3068
  sname=buttonComposite
  sBORDER=false
  sH_SCROLL=false
  sV_SCROLL=false
  sNO_BACKGROUND=false
  sNO_FOCUS=false
  sNO_MERGE_PAINTS=false
  sNO_REDRAW_RESIZE=false
  sNO_RADIO_GROUP=false
  sEMBEDDED=false
  sDOUBLE_BUFFERED=false
  scapture=false
  senabled=true
  sredraw=true
  svisible=true
  sdescriptors=xworker.swt.Widgets/@Composite
  sid=3068
    @/@3068/@3069
    sname=buttonCompositeGridData
    sstyle=FILL_HORIZONTAL
    shorizontalIndent=0
    swidth=-1
    sheight=-1
    shorizontalAlignment=END
    sverticalAlignment=CENTER
    shorizontalSpan=1
    sverticalSpan=1
    sgrabExcessHorizontalSpace=false
    sgrabExcessVerticalSpace=false
    sdescriptors=xworker.swt.layout.LayoutDatas/@GridData
    sid=3069
    @/@3068/@3070
    sname=buttonCompositeRowLayout
    sfill=false
    sjustify=false
    smarginWidth=0
    smarginHeight=0
    smarginLeft=3
    smarginTop=3
    smarginRight=3
    smarginBottom=3
    spack=true
    sspacing=3
    stype=SWT.HORIZONTAL
    swrap=true
    sdescriptors=xworker.swt.Layouts/@RowLayout
    sid=3070
    @/@3068/@3071
    sname=executeButton
    stext=执行
    stype=SWT.PUSH
    sflat=false
    sborder=false
    sselected=false
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Button
    sth_createIndex=false
    sid=3071
      @/@3068/@3071/@3072
      sname=RowData
      sexclude=false
      swidth=80
      sheight=-1
      sdescriptors=xworker.swt.layout.LayoutDatas/@RowData
      sth_createIndex=false
      sid=3072
      @/@3068/@3071/@3073
      sname=Listeners
      sdescriptors=xworker.swt.widgets.Widget/@Listeners
      sth_createIndex=false
      sid=3073
        @/@3068/@3071/@3073/@3074
        sname=executeButtonSelection
        stype=Selection
        sdescriptors=xworker.swt.events.Listeners/@listeners/@Listener
        sth_createIndex=false
        sid=3074
          @/@3068/@3071/@3073/@3074/@UserTask
          sname=UserTask
          sasync=false
          sprogressAble=true
          sinterpretationType=Self
          sattributeTemplate=false
          schildsAttributeTemplate=false
          svarScope=Local
          sisSynchronized=false
          sthrowException=true
          suseOtherAction=false
          screateLocalVarScope=false
          ssaveReturn=false
          sdisableGlobalContext=false
          sdebugLog=false
          sdescriptors=xworker.ide.task.actions.UserTask
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_mark=false
          sid=UserTask
            @/@3068/@3071/@3073/@3074/@UserTask/@Variables
            sname=Variables
            sdescriptors=xworker.ide.task.actions.UserTask/@Variables
            sinheritDescription=false
            sth_createIndex=false
            sth_registMyChilds=false
            sth_registDisabled=false
            sth_mark=false
            sid=Variables
              @/@3068/@3071/@3073/@3074/@UserTask/@Variables/@dataSource
              sname=dataSource
              svarName=dataSource
              sinterpretationType=Self
              sattributeTemplate=false
              schildsAttributeTemplate=false
              svarScope=Local
              sisSynchronized=false
              sthrowException=true
              suseOtherAction=false
              screateLocalVarScope=false
              ssaveReturn=false
              sdisableGlobalContext=false
              sdebugLog=false
              sdescriptors=xworker.lang.actions.Actions/@GetParentContextValue
              sinheritDescription=false
              sth_createIndex=false
              sth_registMyChilds=false
              sth_registDisabled=false
              sth_mark=false
              sid=dataSource
              @/@3068/@3071/@3073/@3074/@UserTask/@Variables/@sql
              sname=sql
              svarExpression=sqlText.getText()
              sinterpretationType=Self
              sattributeTemplate=false
              schildsAttributeTemplate=false
              svarScope=Local
              sisSynchronized=false
              sthrowException=true
              suseOtherAction=false
              screateLocalVarScope=false
              ssaveReturn=false
              sdisableGlobalContext=false
              sdebugLog=false
              sdescriptors=xworker.lang.actions.Actions/@GetVariableOgnl
              sinheritDescription=false
              sth_createIndex=false
              sth_registMyChilds=false
              sth_registDisabled=false
              sth_mark=false
              sid=sql
            @/@3068/@3071/@3073/@3074/@UserTask/@actions
            sname=actions
            sdescriptors=xworker.ide.task.actions.UserTask/@actions1
            sinheritDescription=false
            sth_createIndex=false
            sth_registMyChilds=false
            sth_registDisabled=false
            sth_mark=false
            sid=actions
              @/@3068/@3071/@3073/@3074/@UserTask/@actions/@doTask
              sname=doTask
              sisSynchronized=false
              sthrowException=true
              suseOtherAction=false
              svarScope=Local
              sdisableGlobalContext=false
              Scode=
#$@text#$@
try{
    //处理需要执行的SQL
    def sqls = [];
    for(def s in sql.split("[\n]")){
        s = s.trim();
        if(s.endsWith(";")){
            s = s.substring(0, s.length() - 1);
        }
        if(s == ""){ 
            continue;
        }
        
        sqls.add(s);
    }
    if(sqls.size() == 0){
        return;
    }
    
    //数据库链接
    def con = dataSource.doAction("getConnection", actionContext);
    
    def count = 0;
    try{
        for(s in sqls){
            task.setProgress((int) (count * 100 / sqls.size()));
            task.setDetail(s);
            
            def pst = con.prepareStatement(s);
            try{
                pst.execute();
            }finally{
                if(pst != null){
                    pst.close();
                }
            }
        }
    }finally{
        if(con != null){
            con.close();
        }
    }
}finally{
    task.finished();
}
#$@text#$@
              sinterpretationType=Action
              screateLocalVarScope=false
              ssaveReturn=false
              sdebugLog=false
              sdescriptors=xworker.lang.actions.Actions/@GroovyAction
              sinheritDescription=false
              sth_createIndex=false
              sth_registMyChilds=false
              sth_registDisabled=false
              sth_mark=false
              sid=doTask
    @/@3068/@30711
    sname=openFileButton
    stext=打开SQL文件
    stype=SWT.PUSH
    sflat=false
    sborder=false
    sselected=false
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Button
    sth_createIndex=false
    sid=30711
      @/@3068/@30711/@3072
      sname=RowData
      sexclude=false
      swidth=80
      sheight=-1
      sdescriptors=xworker.swt.layout.LayoutDatas/@RowData
      sth_createIndex=false
      sid=3072
      @/@3068/@30711/@3073
      sname=Listeners
      sdescriptors=xworker.swt.widgets.Widget/@Listeners
      sth_createIndex=false
      sid=3073
        @/@3068/@30711/@3073/@openFileButtonSelection
        sname=openFileButtonSelection
        stype=Selection
        sdescriptors=xworker.swt.events.Listeners/@listeners/@Listener
        sinheritDescription=false
        sth_createIndex=false
        sth_registMyChilds=false
        sth_registDisabled=false
        sth_mark=false
        sid=openFileButtonSelection
          @/@3068/@30711/@3073/@openFileButtonSelection/@fileDialog
          sname=fileDialog
          sstyle=OPEN
          soverwrite=false
          sinterpretationType=Self
          sattributeTemplate=false
          schildsAttributeTemplate=false
          svarScope=Local
          sisSynchronized=false
          sthrowException=true
          suseOtherAction=false
          screateLocalVarScope=false
          ssaveReturn=false
          sdisableGlobalContext=false
          sdebugLog=false
          sdescriptors=xworker.swt.actions.DialogActions/@FileDialog
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_mark=false
          sid=fileDialog
            @/@3068/@30711/@3073/@openFileButtonSelection/@fileDialog/@actions
            sname=actions
            sdescriptors=xworker.swt.actions.DialogActions/@FileDialog/@actions1
            sinheritDescription=false
            sth_createIndex=false
            sth_registMyChilds=false
            sth_registDisabled=false
            sth_mark=false
            sid=actions
              @/@3068/@30711/@3073/@openFileButtonSelection/@fileDialog/@actions/@onSelected
              sname=onSelected
              sisSynchronized=false
              sthrowException=true
              suseOtherAction=false
              svarScope=Local
              sdisableGlobalContext=false
              Scode=
#$@text#$@
import org.apache.commons.io.FileUtils;

def code = FileUtils.readFileToString(new File(fileName));
sqlText.setText(code);
#$@text#$@
              sinterpretationType=Action
              screateLocalVarScope=false
              ssaveReturn=false
              sdebugLog=false
              sdescriptors=xworker.lang.actions.Actions/@GroovyAction
              sinheritDescription=false
              sth_createIndex=false
              sth_registMyChilds=false
              sth_registDisabled=false
              sth_mark=false
              sid=onSelected
