%1563342931303
@
sname=SetMysqlUrl
slabel=设置Mysql数据源
sautoExecute=false
Sdescription=
#$@text#$@
<p>帮助设置Mysql数据源的工具。</p>
#$@text#$@
sen_label=Set Mysql DataSource
sdescriptors=xworker.lang.util.ThingGuide
sinheritDescription=false
sth_createIndex=true
sth_registThing=guide|xworker.db.jdbc.DataSource
sth_registMyChilds=false
sth_registDisabled=false
sth_fileMonitor=false
sth_mark=false
  @/@Composite
  sname=Composite
  snotRemoveGuideOnFinish=false
  sdescriptors=xworker.lang.util.ThingGuideNodes/@Composite
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_fileMonitor=false
  sth_mark=false
  sid=Composite
    @/@Composite/@Composite
    sname=Composite
    sBORDER=false
    sH_SCROLL=false
    sV_SCROLL=false
    sNO_BACKGROUND=false
    sNO_FOCUS=false
    sNO_MERGE_PAINTS=false
    sNO_REDRAW_RESIZE=false
    sNO_RADIO_GROUP=false
    sEMBEDDED=false
    sDOUBLE_BUFFERED=false
    scapture=false
    senabled=true
    sredraw=true
    spack=false
    svisible=true
    sdescriptors=xworker.lang.util.ThingGuideNodes/@Composite/@Composite
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_fileMonitor=false
    sth_mark=false
    sid=Composite
      @/@Composite/@Composite/@FillLayout
      sname=FillLayout
      stype=SWT.HORIZONTAL
      sdescriptors=xworker.swt.Layouts/@FillLayout
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_fileMonitor=false
      sth_mark=false
      sid=FillLayout
      @/@Composite/@Composite/@thingForm
      sname=thingForm
      scolumn=1
      sH_SCROLL=true
      sV_SCROLL=true
      sNO_BACKGROUND=false
      sNO_FOCUS=false
      sNO_MERGE_PAINTS=false
      sNO_REDRAW_RESIZE=false
      sNO_RADIO_GROUP=false
      sEMBEDDED=false
      sDOUBLE_BUFFERED=false
      sdescriptors=xworker.swt.Widgets/@ThingForm
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_fileMonitor=false
      sth_mark=false
      sid=thingForm
        @/@Composite/@Composite/@thingForm/@Thing
        sname=Thing
        sdescriptors=xworker.swt.xworker.ThingForm/@Thing
        smany=true
        seditCols=2
        sinitialization=false
        smodifier=public
        sinheritDescription=false
        snotXmlAttribute=false
        sjson_isArray=false
        sth_createIndex=false
        sth_registMyChilds=false
        sth_registDisabled=false
        sth_fileMonitor=false
        sth_mark=false
        sid=Thing
          @/@Composite/@Composite/@thingForm/@Thing/@driver
          sname=driver
          sinputtype=select
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          smodifier=public
          sreadOnly=false
          sdefault=cj
          sinheritDescription=false
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          snotXmlAttribute=false
          sdescriptors=xworker.lang.MetaDescriptor3/@attribute
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_fileMonitor=false
          sth_mark=false
          sid=driver
            @/@Composite/@Composite/@thingForm/@Thing/@driver/@cj
            sname=cj
            svalue=cj
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sinheritDescription=false
            sth_createIndex=false
            sth_registMyChilds=false
            sth_registDisabled=false
            sth_fileMonitor=false
            sth_mark=false
            sid=cj
            @/@Composite/@Composite/@thingForm/@Thing/@driver/@git
            sname=git
            svalue=git
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sinheritDescription=false
            sth_createIndex=false
            sth_registMyChilds=false
            sth_registDisabled=false
            sth_fileMonitor=false
            sth_mark=false
            sid=git
          @/@Composite/@Composite/@thingForm/@Thing/@host
          sname=host
          ssize=40
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          smodifier=public
          sreadOnly=false
          sinheritDescription=false
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          snotXmlAttribute=false
          sdescriptors=xworker.lang.MetaDescriptor3/@attribute
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_fileMonitor=false
          sth_mark=false
          sid=host
          @/@Composite/@Composite/@thingForm/@Thing/@port
          sname=port
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          smodifier=public
          sreadOnly=false
          sdefault=3306
          sinheritDescription=false
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          snotXmlAttribute=false
          sdescriptors=xworker.lang.MetaDescriptor3/@attribute
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_fileMonitor=false
          sth_mark=false
          sid=port
          @/@Composite/@Composite/@thingForm/@Thing/@schema
          sname=schema
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          smodifier=public
          sreadOnly=false
          sinheritDescription=false
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          snotXmlAttribute=false
          sdescriptors=xworker.lang.MetaDescriptor3/@attribute
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_fileMonitor=false
          sth_mark=false
          sid=schema
          @/@Composite/@Composite/@thingForm/@Thing/@useUnicode
          sname=useUnicode
          sinputtype=truefalseselect
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          smodifier=public
          sreadOnly=false
          sinheritDescription=false
          Sdescription=
#$@text#$@
<p>是否使用Unicode字符集，如果参数characterEncoding设置为gb2312或gbk，本参数值必须设置为true false 1.1g&nbsp;</p>
#$@text#$@
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          snotXmlAttribute=false
          sdescriptors=xworker.lang.MetaDescriptor3/@attribute
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_fileMonitor=false
          sth_mark=false
          sid=useUnicode
          @/@Composite/@Composite/@thingForm/@Thing/@characterEncoding
          sname=characterEncoding
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          smodifier=public
          sreadOnly=false
          sinheritDescription=false
          Sdescription=
#$@text#$@
<p>当useUnicode设置为true时，指定字符编码。比如可设置为gb2312或gbk false 1.1g&nbsp;</p>
#$@text#$@
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          snotXmlAttribute=false
          sdescriptors=xworker.lang.MetaDescriptor3/@attribute
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_fileMonitor=false
          sth_mark=false
          sid=characterEncoding
          @/@Composite/@Composite/@thingForm/@Thing/@autoReconnect
          sname=autoReconnect
          sinputtype=truefalseselect
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          smodifier=public
          sreadOnly=false
          sinheritDescription=false
          Sdescription=
#$@text#$@
<p>当数据库连接异常中断时，是否自动重新连接？ false 1.1&nbsp;</p>
#$@text#$@
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          snotXmlAttribute=false
          sdescriptors=xworker.lang.MetaDescriptor3/@attribute
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_fileMonitor=false
          sth_mark=false
          sid=autoReconnect
          @/@Composite/@Composite/@thingForm/@Thing/@autoReconnectForPools
          sname=autoReconnectForPools
          sinputtype=truefalseselect
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          smodifier=public
          sreadOnly=false
          sinheritDescription=false
          Sdescription=
#$@text#$@
<p>是否使用针对数据库连接池的重连策略 false 3.1.3&nbsp;</p>
#$@text#$@
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          snotXmlAttribute=false
          sdescriptors=xworker.lang.MetaDescriptor3/@attribute
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_fileMonitor=false
          sth_mark=false
          sid=autoReconnectForPools
          @/@Composite/@Composite/@thingForm/@Thing/@failOverReadOnly
          sname=failOverReadOnly
          sinputtype=truefalseselect
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          smodifier=public
          sreadOnly=false
          sinheritDescription=false
          Sdescription=
#$@text#$@
<p>自动重连成功后，连接是否设置为只读？ true 3.0.12&nbsp;</p>
#$@text#$@
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          snotXmlAttribute=false
          sdescriptors=xworker.lang.MetaDescriptor3/@attribute
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_fileMonitor=false
          sth_mark=false
          sid=failOverReadOnly
          @/@Composite/@Composite/@thingForm/@Thing/@maxReconnects
          sname=maxReconnects
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          smodifier=public
          sreadOnly=false
          sinheritDescription=false
          Sdescription=
#$@text#$@
<p>autoReconnect设置为true时，重试连接的次数 3 1.1&nbsp;</p>
#$@text#$@
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          snotXmlAttribute=false
          sdescriptors=xworker.lang.MetaDescriptor3/@attribute
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_fileMonitor=false
          sth_mark=false
          sid=maxReconnects
          @/@Composite/@Composite/@thingForm/@Thing/@initialTimeout
          sname=initialTimeout
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          smodifier=public
          sreadOnly=false
          sinheritDescription=false
          Sdescription=
#$@text#$@
<p>autoReconnect设置为true时，两次重连之间的时间间隔，单位：秒 2 1.1&nbsp;</p>
#$@text#$@
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          snotXmlAttribute=false
          sdescriptors=xworker.lang.MetaDescriptor3/@attribute
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_fileMonitor=false
          sth_mark=false
          sid=initialTimeout
          @/@Composite/@Composite/@thingForm/@Thing/@connectTimeout
          sname=connectTimeout
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          smodifier=public
          sreadOnly=false
          sinheritDescription=false
          Sdescription=
#$@text#$@
<p>和数据库服务器建立socket连接时的超时，单位：毫秒。 0表示永不超时，适用于JDK 1.4及更高版本 0 3.0.1&nbsp;</p>
#$@text#$@
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          snotXmlAttribute=false
          sdescriptors=xworker.lang.MetaDescriptor3/@attribute
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_fileMonitor=false
          sth_mark=false
          sid=connectTimeout
          @/@Composite/@Composite/@thingForm/@Thing/@socketTimeout
          sname=socketTimeout
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          smodifier=public
          sreadOnly=false
          sinheritDescription=false
          Sdescription=
#$@text#$@
<p>socket操作（读写）超时，单位：毫秒。 0表示永不超时 0 3.0.1&nbsp;</p>
#$@text#$@
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          snotXmlAttribute=false
          sdescriptors=xworker.lang.MetaDescriptor3/@attribute
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_fileMonitor=false
          sth_mark=false
          sid=socketTimeout
    @/@Composite/@actions
    sname=actions
    sdescriptors=xworker.lang.util.ThingGuideNodes/@Composite/@actions1
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_fileMonitor=false
    sth_mark=false
    sid=actions
      @/@Composite/@actions/@doFinish
      sname=doFinish
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      svarScope=Local
      sdisableGlobalContext=false
      Scode=
#$@text#$@
def values = thingForm.doAction("getValues", actionContext);
def driver = null;
if(values.driver == "git"){
    driver = "org.gjt.mm.mysql.Driver";
}else{
    driver = "com.mysql.cj.jdbc.Driver";
}

def url = "jdbc:mysql://" + values.host + ":" + values.port + "/" + values.schema;
def params = null;
params = addParam(params, values, "useUnicode");
params = addParam(params, values, "characterEncoding");
params = addParam(params, values, "autoReconnect");
params = addParam(params, values, "autoReconnectForPools");
params = addParam(params, values, "failOverReadOnly");
params = addParam(params, values, "maxReconnects");
params = addParam(params, values, "initialTimeout");
params = addParam(params, values, "connectTimeout");
params = addParam(params, values, "socketTimeout");

if(params != null){
    url = url + "?" + params;
}

def thing = thingGuide.getEditThing();
thing.put("driver_class", driver);
thing.put("url", url);

def addParam(params, values, name){
    def value = values.get(name);
    if(value == null || value == ""){
        return params;
    }
    
    if(params == null){
        params = name + "=" + value;
    }else{
        params = params + "&" + name + "=" + value;
    }
    
    return params;
}
#$@text#$@
      sinterpretationType=Action
      screateLocalVarScope=false
      ssaveReturn=false
      sdebugLog=false
      sdescriptors=xworker.lang.actions.Actions/@GroovyAction
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_fileMonitor=false
      sth_mark=false
      sid=doFinish
