^1403972979201
@
sname
NarratorActions
slabel
NarratorActions
sdescriptors
xworker.lang.MetaDescriptor3
smany
true
seditCols
2
sinitialization
false
smodifier
public
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak
sname
NarratorSpeak
sdescriptors
xworker.lang.MetaDescriptor3/@thing
sextends
xworker.lang.actions.SelfAction
smany
true
seditCols
2
sinitialization
false
sgroup
xworker.ide.guide.narrator,guide.narrator
smodifier
public
sinheritDescription
false
Sdescription
#$@text#$@
<p>&nbsp;&nbsp;&nbsp; 讲述人的一句话，在屏幕上显示讲述者的头像和本事物description字段的内容，并显示本事物的子事物Buttons节点下定义的按钮等。</p>

<p><strong>按钮事件处理</strong></p>

<p>&nbsp;&nbsp;&nbsp; 按钮是SWT的按钮，按钮所使用的变量上下文使用的是调用本动作时的动作上下文。</p>
#$@text#$@
snotXmlAttribute
false
sth_createIndex
true
sth_registThing
child|xworker.lang.actions.Actions
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak/@actions
sname
actions
sdescriptors
xworker.lang.MetaDescriptor3/@actions
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak/@actions/@run
sname
run
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Local
sdisableGlobalContext
false
Scode
#$@text#$@
import org.xmeta.ActionContext;

//如果有引用的使用引用的
def refNarratorSpeak = world.getThing(self.getString("refNarratorSpeak"));
if(refNarratorSpeak != null){
    refNarratorSpeak.doAction("run", actionContext);
    return;
}

//获取讲述人
def key = "__xworker.ide.guide.narrator__";
def narrator = world.getData(key);
if(narrator == null || narrator.shell.isDisposed()){
    def shellThing = world.getThing("xworker.ide.guide.narrator.DefaultNarrator");
    def shell = shellThing.doAction("create", actionContext);
    narrator = ["shell": shell, "actionContext": actionContext];
    world.setData(key, narrator);
}

//设置内容
def actions = narrator.actionContext.actions;
actions.doAction("setContent", narrator.actionContext, ["narrator": self.getString("narrator"), "contentThing": self]); 

def nextButton = false;
if(world.getThing(self.getString("nextNarratorSpeak")) != null){
    nextButton = true;
}
def buttons = self.getThing("Buttons@0");
def buttonThings = null;
if(buttons != null){
    buttonThings = buttons.getChilds();
}
actions.doAction("setButtons", narrator.actionContext, ["buttonThings": buttonThings, "nextButton": nextButton]);

narrator.shell.open();
#$@text#$@
sinitBreakPoint
false
ssuccessBreakPoint
false
sexceptionBreakPoint
false
seditBreakPoint
false
sinterpretationType
Action
screateLocalVarScope
false
ssaveReturn
false
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak/@name
sname
name
sshowLabel
true
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak/@label
sname
label
sshowLabel
true
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak/@narrator
sname
narrator
sinputtype
select
sshowLabel
true
sreadOnly
false
sdefault
default
sinheritDescription
false
Sdescription
#$@text#$@
<ul>
	<li><strong>default</strong><br />
	默认讲述人，通常是一个MM等。<br />
	&nbsp;</li>
	<li><strong>user</strong><br />
	用户，通常代表是的程序员自己。</li>
</ul>
#$@text#$@
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak/@narrator/@default
sname
default
slabel
讲述人
svalue
default
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak/@narrator/@user
sname
user
slabel
用户
svalue
user
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak/@refNarratorSpeak
sname
refNarratorSpeak
sinputtype
dataSelector
sshowLabel
true
ssize
60
sreadOnly
false
sinheritDescription
false
sdescription
<p>如果不为空且对应的事物存在，那么将忽略本事物的设置而使用引用的事物。</p>
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak/@nextNarratorSpeak
sname
nextNarratorSpeak
sinputtype
dataSelector
sshowLabel
true
ssize
60
sreadOnly
false
sinheritDescription
false
sdescription
<p>如果不为空且指定的事物存在，那么叙述人的按钮面板自动出现下一步。</p>
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak/@description
sname
description
sinputtype
html
sshowLabel
true
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak/@Buttons
sname
Buttons
sdescriptors
xworker.lang.MetaDescriptor3/@thing
sextends
xworker.swt.Widgets
smany
true
seditCols
2
sinitialization
false
smodifier
public
sinheritDescription
false
sdescription
<p>Buttons下的子节点是讲述人的要执行的动作按钮，其中父控件的布局是FlowLayout，在末尾会自动添加一个关闭的按钮。</p>
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1
sname
NarratorSpeakWithMark
sdescriptors
xworker.lang.MetaDescriptor3/@thing
sextends
xworker.lang.actions.SelfAction
smany
true
seditCols
2
sinitialization
false
sgroup
xworker.ide.guide.narrator,guide.narrator
smodifier
public
sinheritDescription
false
Sdescription
#$@text#$@
<p>&nbsp;&nbsp; 同NarratorSpeak，同时还能够标记控件和不标记控件等。</p>
#$@text#$@
snotXmlAttribute
false
sth_createIndex
true
sth_registThing
child|xworker.lang.actions.Actions
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@actions
sname
actions
sdescriptors
xworker.lang.MetaDescriptor3/@actions
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@actions/@run
sname
run
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Local
sdisableGlobalContext
false
Scode
#$@text#$@
import org.xmeta.ActionContext;

//如果有引用的使用引用的
def refNarratorSpeak = world.getThing(self.getString("refNarratorSpeak"));
if(refNarratorSpeak != null){
    refNarratorSpeak.doAction("run", actionContext);
    return;
}

//获取讲述人
def key = "__xworker.ide.guide.narrator__";
def narrator = world.getData(key);
if(narrator == null || narrator.shell.isDisposed()){
    def shellThing = world.getThing("xworker.ide.guide.narrator.DefaultNarrator");
    def shell = shellThing.doAction("create", actionContext);
    narrator = ["shell": shell, "actionContext": actionContext];
    world.setData(key, narrator);
}

//设置内容
def actions = narrator.actionContext.actions;
actions.doAction("setContent", narrator.actionContext, ["narrator": self.getString("narrator"), "contentThing": self]); 

def nextButton = false;
def buttons = self.getThing("Buttons@0");
def buttonThings = null;
if(buttons != null){
    buttonThings = buttons.getChilds();
}
def nextButtonThing = world.getThing("xworker.ide.guide.actions.NarratorActions/@NarratorSpeak1/@Buttons1/@nextButton");
if(buttonThings == null){
    buttonThings = [];
}
buttonThings.add(nextButtonThing);

actions.doAction("setButtons", narrator.actionContext, ["buttonThings": buttonThings, "nextButton": nextButton]);

narrator.shell.open();
#$@text#$@
sinitBreakPoint
false
ssuccessBreakPoint
false
sexceptionBreakPoint
false
seditBreakPoint
false
sinterpretationType
Action
screateLocalVarScope
false
ssaveReturn
false
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@name
sname
name
sshowLabel
true
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@label
sname
label
sshowLabel
true
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@refNarratorSpeak
sname
refNarratorSpeak
sinputtype
dataSelector
sshowLabel
true
ssize
60
sreadOnly
false
sinheritDescription
false
sdescription
<p>如果不为空且对应的事物存在，那么将忽略本事物的设置而使用引用的事物。</p>
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@narrator
sname
narrator
sinputtype
select
sshowLabel
true
sreadOnly
false
sdefault
default
sinheritDescription
false
Sdescription
#$@text#$@
<ul>
	<li><strong>default</strong><br />
	默认讲述人，通常是一个MM等。<br />
	&nbsp;</li>
	<li><strong>user</strong><br />
	用户，通常代表是的程序员自己。</li>
</ul>
#$@text#$@
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@narrator/@default
sname
default
slabel
讲述人
svalue
default
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@narrator/@user
sname
user
slabel
用户
svalue
user
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@nextNarratorSpeak
sname
nextNarratorSpeak
sinputtype
dataSelector
sshowLabel
true
ssize
60
sreadOnly
false
sinheritDescription
false
sdescription
<p>如果不为空且指定的事物存在，那么叙述人的按钮面板自动出现下一步。</p>
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@description
sname
description
sinputtype
html
sshowLabel
true
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@unmarkedControl
sname
unmarkedControl
sshowLabel
true
ssize
60
sgroup
MarkControl
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@markControl
sname
markControl
sshowLabel
true
ssize
60
sgroup
MarkControl
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@type
sname
markIconType
sinputtype
select
sshowLabel
true
sgroup
MarkControl
sreadOnly
false
sdefault
1
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@type/@small
sname
arrow_up
slabel
小箭头-朝上
svalue
0
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@type/@arrow_left
sname
arrow_left
slabel
小箭头-朝下
svalue
1
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@type/@arrow_left1
sname
arrow_left
slabel
小箭头-朝左
svalue
2
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@type/@arrow_right
sname
arrow_right
slabel
小箭头-朝右
svalue
3
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@type/@middle
sname
middle
slabel
中
svalue
4
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@type/@large
sname
large
slabel
大
svalue
5
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@align
sname
align
sinputtype
select
sshowLabel
true
sgroup
MarkControl
sreadOnly
false
sdefault
center
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@align/@topleft
sname
topleft
slabel
topleft
svalue
topleft
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@align/@top
sname
top
slabel
top
svalue
top
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@align/@topright
sname
topright
slabel
topright
svalue
topright
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@align/@left
sname
left
slabel
left
svalue
left
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@align/@center
sname
center
slabel
center
svalue
center
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@align/@right
sname
right
slabel
right
svalue
right
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@align/@bottomleft
sname
bottomleft
slabel
bottomleft
svalue
bottomleft
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@align/@bottom
sname
bottom
slabel
bottom
svalue
bottom
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@align/@bottomright
sname
bottomright
slabel
bottomright
svalue
bottomright
sdescriptors
xworker.lang.MetaDescriptor3/@attribute/@value
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@offsetX
sname
offsetX
sshowLabel
true
sgroup
MarkControl
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@offsetY
sname
offsetY
sshowLabel
true
sgroup
MarkControl
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@Buttons
sname
Buttons
sdescriptors
xworker.lang.MetaDescriptor3/@thing
sextends
xworker.swt.Widgets
smany
true
seditCols
2
sinitialization
false
smodifier
public
sinheritDescription
false
sdescription
<p>Buttons下的子节点是讲述人的要执行的动作按钮，其中父控件的布局是FlowLayout，在末尾会自动添加一个关闭的按钮。</p>
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@Buttons1
sname
Buttons
sdescriptors
xworker.ide.guide.actions.NarratorActions/@NarratorSpeak/@Buttons
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@Buttons1/@nextButton
sname
nextButton
stext
下一步
stype
SWT.PUSH
sflat
false
sborder
false
sselected
false
scapture
false
senabled
true
sredraw
true
svisible
true
sxw_cl_global
false
sdescriptors
xworker.swt.Widgets/@Button
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@Buttons1/@nextButton/@Listeners
sname
Listeners
sdescriptors
xworker.swt.widgets.Widget/@Listeners
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@Buttons1/@nextButton/@Listeners/@Listener
sname
Listener
stype
Selection
sdescriptors
xworker.swt.events.Listeners/@listeners/@Listener
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
@/@NarratorSpeak1/@Buttons1/@nextButton/@Listeners/@Listener/@GroovyAction
sname
GroovyAction
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Local
sdisableGlobalContext
false
Scode
#$@text#$@
import xworker.ide.assistor.guide.mark.ControlMarker;
import org.xmeta.util.OgnlUtil;

//取消标记
println(contentThing);
def unmarkedControl =  OgnlUtil.getValue(contentThing, "unmarkedControl", actionContext);
if(unmarkedControl != null){
    ControlMarker.unmark(unmarkedControl);
}
println("unmarkedControl=" + unmarkedControl);

//标记控件
def markControl = OgnlUtil.getValue(contentThing, "markControl", actionContext);
if(markControl != null){
    ControlMarker.mark(markControl, contentThing.getInt("markIconType"), contentThing.getString("align"), contentThing.getInt("offsetX"), contentThing.getInt("offsetY"))
}

//下一步
def nextThing = world.getThing(contentThing.getString("nextNarratorSpeak"));
if(nextThing != null){
    nextThing.doAction("run", actionContext);
}else{
    shell.dispose();
}
#$@text#$@
sinitBreakPoint
false
ssuccessBreakPoint
false
sexceptionBreakPoint
false
seditBreakPoint
false
sinterpretationType
Action
screateLocalVarScope
false
ssaveReturn
false
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
sth_createIndex
false
sth_registMyChilds
false
sth_mark
false
