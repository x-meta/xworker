%1565936036780
@
sname=shell
stext=数据库管理器
sNO_TRIM=false
sCLOSE=true
sTITLE=true
sMIN=true
sMAX=true
sBORDER=false
sRESIZE=true
sON_TOP=false
sTOOL=false
sNO_FOCUS=false
swidth=1024
sheight=768
scenterScreen=true
spack=false
smaximized=false
sfullScreen=false
sdesign=true
sisIde=false
sdesignDefaultOpen=false
sH_SCROLL=false
sV_SCROLL=false
sNO_BACKGROUND=false
sNO_MERGE_PAINTS=false
sNO_REDRAW_RESIZE=false
sNO_RADIO_GROUP=false
sEMBEDDED=false
sDOUBLE_BUFFERED=false
slabel=DbManager
scapture=false
senabled=true
sredraw=true
svisible=true
sdescriptors=xworker.swt.widgets.Shell
sinheritDescription=false
sth_createIndex=false
sth_registMyChilds=false
sth_registDisabled=false
sth_mark=false
  @/@shellFillLayout
  sname=shellFillLayout
  stype=SWT.HORIZONTAL
  sdescriptors=xworker.swt.Layouts/@FillLayout
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=shellFillLayout
  @/@mainSashForm
  sname=mainSashForm
  sstyle=HORIZONTAL
  sSMOOTH=false
  sweights=30,70
  sBORDER=false
  sH_SCROLL=false
  sV_SCROLL=false
  sNO_BACKGROUND=false
  sNO_FOCUS=false
  sNO_MERGE_PAINTS=false
  sNO_REDRAW_RESIZE=false
  sNO_RADIO_GROUP=false
  sEMBEDDED=false
  sDOUBLE_BUFFERED=false
  slabel=JDBC数据源
  scapture=false
  senabled=true
  sredraw=true
  svisible=true
  sen_label=JDBC DataSource
  sdescriptors=xworker.swt.Widgets/@SashForm
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sicon=icons/database.png
  sth_fileMonitor=false
  sth_mark=false
  sid=mainSashForm
    @/@mainSashForm/@dataSoureComposite
    sname=dataSoureComposite
    sBORDER=true
    sH_SCROLL=false
    sV_SCROLL=false
    sNO_BACKGROUND=false
    sNO_FOCUS=false
    sNO_MERGE_PAINTS=false
    sNO_REDRAW_RESIZE=false
    sNO_RADIO_GROUP=false
    sEMBEDDED=false
    sDOUBLE_BUFFERED=false
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Composite
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=dataSoureComposite
      @/@mainSashForm/@dataSoureComposite/@FillLayout
      sname=FillLayout
      stype=SWT.HORIZONTAL
      sdescriptors=xworker.swt.Layouts/@FillLayout
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=FillLayout
      @/@mainSashForm/@dataSoureComposite/@dataSourceSelector
      sname=dataSourceSelector
      sthing=xworker.ui.db.datasource.JdbcDatasourceRegistor
      sregistType=child
      ssearchByKeywords=true
      sshowDescBrowser=false
      sdescBrowserRight=false
      sautoLoad=true
      scache=true
      sdescritporForNewThing=xworker.db.jdbc.DataSource
      sdescriptors=xworker.swt.Widgets/@ThingRegistSelector
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=dataSourceSelector
        @/@mainSashForm/@dataSoureComposite/@dataSourceSelector/@actions
        sname=actions
        sdescriptors=xworker.swt.xworker.ThingRegistSelector/@actions1
        sinheritDescription=false
        sth_createIndex=false
        sth_registMyChilds=false
        sth_registDisabled=false
        sth_mark=false
        sid=actions
          @/@mainSashForm/@dataSoureComposite/@dataSourceSelector/@actions/@defaultSelected
          sname=selected
          sisSynchronized=false
          sthrowException=true
          suseOtherAction=false
          svarScope=Local
          sdisableGlobalContext=false
          Scode=
#$@text#$@
import org.xmeta.Thing;

def dbs = [
    "oracle":"xworker.app.db.indexs.ToolsOralceIndex",
    "derby":"xworker.app.db.indexs.ToolsDerbyIndex",
    "mysql":"xworker.app.db.indexs.ToolsMysqlIndex",
    "sqlserver":"xworker.app.db.indexs.ToolsSqlserverIndex",
    "db2":"xworker.app.db.indexs.ToolsDB2Index",
    "sqlite":"xworker.app.db.indexs.ToolsSqliteIndex"
];

if(thing != null){    
    def composite = world.getThing("xworker.app.db.manager.DbTools/@mainSashForm");
    def tabKey = thing.getMetadata().getPath();
    def text = thing.getMetadata().getLabel();
    def contentKey = thing.getMetadata().getPath();
    
    def item = actions.doAction("open", actionContext, [
             "composite":composite, "tabKey":tabKey, "text":text, "contentKey":contentKey
        ]);
    if(item != null){
        def ac = item.getData("actionContext");
        ac.g().put("dataSource", thing);
        
        //设置注册管理器
        def exts = "xworker.app.db.manager.DbToolsComposites," + thing.getMetadata().getPath();
        def dbType = thing.getStringBlankAsNull("dbType");
        if(dbType != null){
            dbType = dbType.toLowerCase();
            for(key in dbs.keySet()){
                if(dbType.indexOf(key) != -1){
                    exts = exts + "," + dbs.get(key);
                    break;
                }
            }
        }
        def toolsRegistThing = thing.getStringBlankAsNull("toolsRegistThing");
        if(toolsRegistThing != null){
            exts = exts + "," + toolsRegistThing;
        }
        def rthing = new Thing();        
        rthing.set("extends", exts);
        ac.tools.doAction("init", ac, ["thing": rthing, "type":"command"]);
        ac.tools.doAction("refresh", ac);
    }
}
#$@text#$@
          sinterpretationType=Action
          screateLocalVarScope=false
          ssaveReturn=false
          sdebugLog=false
          sdescriptors=xworker.lang.actions.Actions/@GroovyAction
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_mark=false
          sid=defaultSelected
    @/@mainSashForm/@mainTabFodler
    sname=mainTabFodler
    sstyle=TOP
    sBORDER=true
    sFLAT=false
    sCLOSE=false
    sSINGLE=false
    sMRUVisible=false
    ssimple=false
    sH_SCROLL=false
    sV_SCROLL=false
    sNO_BACKGROUND=false
    sNO_FOCUS=false
    sNO_MERGE_PAINTS=false
    sNO_REDRAW_RESIZE=false
    sNO_RADIO_GROUP=false
    sEMBEDDED=false
    sDOUBLE_BUFFERED=false
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@CTabFolder
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=mainTabFodler
    @/@mainSashForm/@actions
    sname=actions
    sdescriptors=xworker.swt.Widgets/@actions
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=actions
      @/@mainSashForm/@actions/@oepn
      sname=open
      scompositePath=var:composite
      scTabFolder=var:mainTabFodler
      sclose=true
      stabItemText=var:text
      stabItemKey=var:tabKey
      stabContentKey=var:contentKey
      sinterpretationType=Self
      sattributeTemplate=false
      schildsAttributeTemplate=false
      svarScope=Local
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      screateLocalVarScope=false
      ssaveReturn=false
      sdisableGlobalContext=false
      sdebugLog=false
      sdescriptors=xworker.swt.actions.CTabFolderActions/@Composite
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=oepn
      @/@mainSashForm/@actions/@getOutline
      sname=getOutline
      svarName=outlineBrowser
      sinterpretationType=Self
      sattributeTemplate=false
      schildsAttributeTemplate=false
      svarScope=Local
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      screateLocalVarScope=false
      ssaveReturn=false
      sdisableGlobalContext=false
      sdebugLog=false
      sdescriptors=xworker.lang.actions.Actions/@GetVariable1
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_fileMonitor=false
      sth_mark=false
      sid=getOutline
    @/@mainSashForm/@RunAction
    sname=RunAction
    sdescriptors=xworker.swt.widgets.Widget/@RunAction
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_fileMonitor=false
    sth_mark=false
    sid=RunAction
      @/@mainSashForm/@RunAction/@CreateOutline
      sname=CreateOutline
      soutlineBrowserUrl=descurl:xworker.app.db.manager.DbManagerDesc
      snewActionContext=false
      sinterpretationType=Self
      sattributeTemplate=false
      schildsAttributeTemplate=false
      svarScope=Local
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      screateLocalVarScope=false
      ssaveReturn=false
      sdisableGlobalContext=false
      sdebugLog=false
      sdescriptors=xworker.swt.app.AppActions/@CreateOutline
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_fileMonitor=false
      sth_mark=false
      sid=CreateOutline
