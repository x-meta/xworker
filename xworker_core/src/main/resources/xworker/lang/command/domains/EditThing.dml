%1556594424692
@
sname=EditThing
slabel=编辑模型
Sdescription=
#$@text#$@
<p>编辑事物模型的命令域，通常作为子命令域被调用。</p>

<p><strong>要编辑的事物</strong></p>

<p>&nbsp;&nbsp;&nbsp; 要编辑的事物是设置到命令执行器上，变量名固定为thing。</p>
#$@text#$@
sen_label=Edit Model
sdescriptors=xworker.lang.command.CommandDomain
sinheritDescription=false
sth_createIndex=true
sth_registThing=child|xworker.lang.command.CommandIndex
sth_registMyChilds=false
sth_registDisabled=false
sgroup=xworker
sth_mark=false
  @/@actions
  sname=actions
  sdescriptors=xworker.lang.command.CommandDomain/@actions1
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=actions
    @/@actions/@init
    sname=init
    sisSynchronized=false
    sthrowException=true
    suseOtherAction=false
    svarScope=Local
    sdisableGlobalContext=false
    Scode=
#$@text#$@
import xworker.swt.util.SwtUtils;

//把参数thing存放到executor的变量上下文中
def ac = executor.getActionContext();
def thing = executor.getDomainContext().get("thing");
ac.g().put("thing", executor.getDomainContext().get("thing"));

//显示模型到thingTree
def thingTree = ac.parentContext.get("thingTree");
ac.g().put("thingTree", thingTree);
if(thing != null && thingTree != null && !thingTree.isDisposed()){
    SwtUtils.showThingOnTree(thing, thingTree, ac);
    
    expandAll(thingTree.getItems()[0]);
    
    thingTree.setSelection(thingTree.getItems()[0]);
}

def expandAll(item){
    for(childItem in item.getItems()){
        expandAll(childItem);
    }
    
    item.setExpanded(true);
}
#$@text#$@
    sinterpretationType=Action
    screateLocalVarScope=false
    ssaveReturn=false
    sdebugLog=false
    sdescriptors=xworker.lang.actions.Actions/@GroovyAction
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=init
  @/@OtherCommands
  sname=OtherCommands
  sdescriptors=xworker.lang.command.CommandDomain/@OtherCommands
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=OtherCommands
    @/@OtherCommands/@list_nodes
    sname=list_nodes
    slabel=事物节点列表
    shasContents=true
    scommandContent=false
    sdescriptors=xworker.lang.command.CommandDomain/@Command
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=list_nodes
      @/@OtherCommands/@list_nodes/@actions
      sname=actions
      sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=actions
        @/@OtherCommands/@list_nodes/@actions/@getContents
        sname=getContents
        sisSynchronized=false
        sthrowException=true
        suseOtherAction=false
        svarScope=Local
        sdisableGlobalContext=false
        Scode=
#$@text#$@
import xworker.swt.xwidgets.SelectContent;
import xworker.util.UtilData;

def txts = text.split("[ ]");
def list = [];
def thing = commandExecutor.getActionContext().get("thing");
thingToSelectContent(thing, list, txts, "");		

return list;

def thingToSelectContent(thing, contents, text, ident){		
		String label = ident + thing.getMetadata().getLabel() + "(" + thing.getThingName() + ")";
		label = label.toLowerCase();
		if(UtilData.indexHas(label, text)){
			SelectContent content = new SelectContent(label, thing);
			contents.add(content);
		}
		
		for(child in thing.getChilds()){
			thingToSelectContent(child, contents, text, ident + "  ");
		}
	}
#$@text#$@
        sinterpretationType=Action
        screateLocalVarScope=false
        ssaveReturn=false
        sdebugLog=false
        sdescriptors=xworker.lang.actions.Actions/@GroovyAction
        sinheritDescription=false
        sth_createIndex=false
        sth_registMyChilds=false
        sth_registDisabled=false
        sth_mark=false
        sid=getContents
    @/@OtherCommands/@list_add_childs
    sname=list_add_childs
    slabel=可添加子节点列表
    shasContents=true
    scommandContent=false
    sdescriptors=xworker.lang.command.CommandDomain/@OtherCommands/@Command
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=list_add_childs
      @/@OtherCommands/@list_add_childs/@actions
      sname=actions
      sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=actions
        @/@OtherCommands/@list_add_childs/@actions/@run
        sname=getContents
        sisSynchronized=false
        sthrowException=true
        suseOtherAction=false
        svarScope=Local
        sdisableGlobalContext=false
        Scode=
#$@text#$@
import xworker.swt.xwidgets.SelectContent;

def thingTree = commandExecutor.getActionContext().get("thingTree");
def thing = thingTree.getSelection()[0].getData();
def descriptor = thing.getDescriptor();
def keyword = actionContext.getObject("text");

def dess = getChilds(actionContext, "thing", thing, "descriptor", descriptor, "keyword", keyword);

def contents = [];
for(des in dess){
    def content = new SelectContent(des.getMetadata().getLabel(), des);
    contents.add(content);
}

return contents;
#$@text#$@
        sinterpretationType=Action
        screateLocalVarScope=false
        ssaveReturn=false
        sdebugLog=false
        sdescriptors=xworker.lang.actions.Actions/@GroovyAction
        sinheritDescription=false
        sth_createIndex=false
        sth_registMyChilds=false
        sth_registDisabled=false
        sth_mark=false
        sid=run
          @/@OtherCommands/@list_add_childs/@actions/@run/@ActionDefined
          sname=ActionDefined
          sdescriptors=xworker.lang.actions.Inout/@ActionDefined
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_mark=false
          sid=ActionDefined
            @/@OtherCommands/@list_add_childs/@actions/@run/@ActionDefined/@getChilds
            sname=getChilds
            sdescriptor=var:descriptor
            sthing=var:thing
            skeyword=var:keyword
            sinterpretationType=Self
            sattributeTemplate=false
            schildsAttributeTemplate=false
            svarScope=Local
            sisSynchronized=false
            sthrowException=true
            suseOtherAction=false
            screateLocalVarScope=false
            ssaveReturn=false
            sdisableGlobalContext=false
            sdebugLog=false
            sdescriptors=xworker.app.xworker.ThingActions/@GetDefinedChilds
            sinheritDescription=false
            sth_createIndex=false
            sth_registMyChilds=false
            sth_registDisabled=false
            sth_mark=false
            sid=getChilds
    @/@OtherCommands/@SelectThingAttributes
    sname=SelectThingAttributes
    slabel=选择事物属性
    shasContents=true
    scommandContent=false
    sdescriptors=xworker.lang.command.CommandDomain/@OtherCommands/@Command
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=SelectThingAttributes
      @/@OtherCommands/@SelectThingAttributes/@actions
      sname=actions
      sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=actions
        @/@OtherCommands/@SelectThingAttributes/@actions/@run
        sname=getContents
        sisSynchronized=false
        sthrowException=true
        suseOtherAction=false
        svarScope=Local
        sdisableGlobalContext=false
        Scode=
#$@text#$@
import xworker.swt.xwidgets.SelectContent;
import xworker.util.UtilData;

def thingTree = commandExecutor.getActionContext().get("thingTree");
def thing = thingTree.getSelection()[0].getData();

if(text == null){
	text = "";
}

text = text.toLowerCase();
def txts = text.split("[ ]");
def contents = [];
def context = [:];
for(des in thing.getAllAttributesDescriptors()){
    def name = des.getMetadata().getName();
    def label= name +  "(" + des.getMetadata().getLabel() + ")";
    label = label.toLowerCase();
    if(UtilData.indexHas(label, txts) && context.get(name) == null){
        def content = new SelectContent(label, label, name,name );
        contents.add(content);
        
        context.put(name, name);
    }
}

return contents;
#$@text#$@
        sinterpretationType=Action
        screateLocalVarScope=false
        ssaveReturn=false
        sdebugLog=false
        sdescriptors=xworker.lang.actions.Actions/@GroovyAction
        sinheritDescription=false
        sth_createIndex=false
        sth_registMyChilds=false
        sth_registDisabled=false
        sth_mark=false
        sid=run
    @/@OtherCommands/@list_methods
    sname=list_methods
    slabel=事物方法列表
    shasContents=true
    scommandContent=false
    sdescriptors=xworker.lang.command.CommandDomain/@OtherCommands/@Command
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=list_methods
      @/@OtherCommands/@list_methods/@actions
      sname=actions
      sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=actions
        @/@OtherCommands/@list_methods/@actions/@run
        sname=getContents
        sisSynchronized=false
        sthrowException=true
        suseOtherAction=false
        svarScope=Local
        sdisableGlobalContext=false
        Scode=
#$@text#$@
import xworker.swt.xwidgets.SelectContent;
import xworker.util.UtilData;
if(text == null){
	text = "";
}

text = text.toLowerCase();
def txts = text.split("[ ]");
def contents = [];
def context = [:];
for(des in currentThing.getActionThings()){
    def name = des.getMetadata().getName();
    def label= name;
    label = label.toLowerCase();
    if(UtilData.indexHas(label, txts) && context.get(name) == null){
        def content = new SelectContent(name, name, name,name );
        contents.add(content);
        
        context.put(name, name);
    }
}

return contents;
#$@text#$@
        sinterpretationType=Action
        screateLocalVarScope=false
        ssaveReturn=false
        sdebugLog=false
        sdescriptors=xworker.lang.actions.Actions/@GroovyAction
        sinheritDescription=false
        sth_createIndex=false
        sth_registMyChilds=false
        sth_registDisabled=false
        sth_mark=false
        sid=run
  @/@select
  sname=select
  slabel=选择节点
  shasContents=false
  scommandContent=false
  sdescriptors=xworker.lang.command.CommandDomain/@Command
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=select
    @/@select/@actions
    sname=actions
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=actions
      @/@select/@actions/@run1
      sname=run
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      svarScope=Local
      sdisableGlobalContext=false
      Scode=
#$@text#$@
import org.xmeta.Thing;

if(thingNode instanceof Thing){
    def thingTree = commandExecutor.getActionContext().get("thingTree");
    selectItem(thingNode.getMetadata().getPath(), thingTree, thingTree.getItems()[0]);
}
//println thingNode;
//actions.doAction("selectThing", actionContext, ["thing": thingNode]);

def selectItem(thingPath, thingTree, item){
    def data = item.getData();
    if(data.getMetadata().getPath() == thingPath){
        thingTree.setSelection(item);
        return;
    }
    
    for(childItem in item.getItems()){
        if(selectItem(thingPath, thingTree, childItem)){
            return;
        }
    }
}
#$@text#$@
      sinterpretationType=Action
      screateLocalVarScope=false
      ssaveReturn=false
      sdebugLog=false
      sdescriptors=xworker.lang.actions.Actions/@GroovyAction
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=run1
    @/@select/@thing
    sname=thingNode
    slabel=事物节点
    scommand=xworker.lang.command.domains.EditThing/@OtherCommands/@list_nodes
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@Parameter
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=thing
  @/@add1
  sname=add
  slabel=添加子节点
  shasContents=false
  scommandContent=false
  sdescriptors=xworker.lang.command.CommandDomain/@Command
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=add1
    @/@add1/@actions
    sname=actions
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=actions
      @/@add1/@actions/@run
      sname=run
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      svarScope=Local
      sdisableGlobalContext=false
      Scode=
#$@text#$@
import org.eclipse.swt.SWT;
import org.eclipse.swt.widgets.TreeItem;
import org.xmeta.Thing;
import xworker.swt.util.XWorkerTreeUtil;

def thingTree = commandExecutor.getActionContext().get("thingTree");
def thing = thingTree.getSelection()[0].getData();

//def selectIndex = childList.getSelectionIndex();
def childStructure = descriptor;
if(childStructure == null){
    return;
}

def childData = ["name": name];

//创建和添加子节点
Thing childObj = new Thing(null, null, childStructure.metadata.path, false);
childObj.cognize(childData);
childObj.set("descriptors", childStructure.metadata.path);        

def treeItem = thingTree.getSelection()[0];
thing.addChild(childObj);
thing.save();

TreeItem newItem = new TreeItem(treeItem, SWT.NONE);
newItem.setData(childObj);
XWorkerTreeUtil.initItem(newItem, childObj, actionContext);

treeItem.setExpanded(true);
#$@text#$@
      sinterpretationType=Action
      screateLocalVarScope=false
      ssaveReturn=false
      sdebugLog=false
      sdescriptors=xworker.lang.actions.Actions/@GroovyAction
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=run
    @/@add1/@descritpor
    sname=descriptor
    slabel=子节点描述者
    scommand=xworker.lang.command.domains.EditThing/@OtherCommands/@list_add_childs
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@Parameter
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=descritpor
    @/@add1/@name
    sname=name
    slabel=名称
    scommand=xworker.lang.command.BaseDomain/@OtherCommands/@InputText
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@Parameter
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=name
  @/@remove
  sname=delete
  slabel=删除节点
  shasContents=false
  scommandContent=false
  sdescription=<p>删除当前选中的节点？</p>
  sdescriptors=xworker.lang.command.CommandDomain/@Command
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=remove
    @/@remove/@actions
    sname=actions
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=actions
      @/@remove/@actions/@run
      sname=run
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      svarScope=Local
      sdisableGlobalContext=false
      Scode=
#$@text#$@
def thingTree = commandExecutor.getActionContext().get("thingTree");
def treeItem = thingTree.getSelection()[0];
def thing = treeItem.getData();
def parentTreeItem = treeItem.getParentItem();
treeItem.dispose();

def parent = thing.getParent();
parent.removeChild(thing);
parent.save();
#$@text#$@
      sinterpretationType=Action
      screateLocalVarScope=false
      ssaveReturn=false
      sdebugLog=false
      sdescriptors=xworker.lang.actions.Actions/@GroovyAction
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=run
    @/@remove/@choice
    sname=choice
    slabel=选择
    scommand=xworker.lang.command.BaseDomain/@OtherCommands/@YesNo
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@Parameter
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=choice
  @/@set
  sname=set
  slabel=设置属性
  shasContents=false
  scommandContent=false
  sdescriptors=xworker.lang.command.CommandDomain/@Command
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=set
    @/@set/@actions
    sname=actions
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=actions
      @/@set/@actions/@run
      sname=run
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      svarScope=Local
      sdisableGlobalContext=false
      Scode=
#$@text#$@
import xworker.swt.util.XWorkerTreeUtil;

def thingTree = commandExecutor.getActionContext().get("thingTree");
def treeItem = thingTree.getSelection()[0];
def thing = treeItem.getData();

thing.set(name, value);
thing.save();

XWorkerTreeUtil.initItem(treeItem, thing, actionContext);
#$@text#$@
      sinterpretationType=Action
      screateLocalVarScope=false
      ssaveReturn=false
      sdebugLog=false
      sdescriptors=xworker.lang.actions.Actions/@GroovyAction
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=run
    @/@set/@attributeName
    sname=name
    slabel=属性名
    scommand=xworker.lang.command.domains.EditThing/@OtherCommands/@SelectThingAttributes
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@Parameter
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=attributeName
    @/@set/@value
    sname=value
    slabel=属性值
    scommand=xworker.lang.command.BaseDomain/@OtherCommands/@InputText
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@Parameter
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=value
  @/@Save
  sname=save
  slabel=保存
  shasContents=false
  scommandContent=false
  sdescriptors=xworker.lang.command.CommandDomain/@Command
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=Save
    @/@Save/@actions
    sname=actions
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=actions
      @/@Save/@actions/@run
      sname=run
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      svarScope=Local
      sdisableGlobalContext=false
      Scode=
#$@text#$@
def thingTree = commandExecutor.getActionContext().get("thingTree");
def treeItem = thingTree.getSelection()[0];
def thing = treeItem.getData();

thing.save();
#$@text#$@
      sinterpretationType=Action
      screateLocalVarScope=false
      ssaveReturn=false
      sdebugLog=false
      sdescriptors=xworker.lang.actions.Actions/@GroovyAction
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=run
  @/@edit
  sname=edit
  slabel=编辑属性
  shasContents=false
  scommandContent=false
  sdescriptors=xworker.lang.command.CommandDomain/@CompoisteCommand
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=edit
    @/@edit/@attributeName
    sname=name
    slabel=属性名
    scommand=xworker.lang.command.domains.EditThing/@OtherCommands/@SelectThingAttributes
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@Parameter
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=attributeName
    @/@edit/@Composite
    sname=Composite
    sBORDER=false
    sH_SCROLL=false
    sV_SCROLL=false
    sNO_BACKGROUND=false
    sNO_FOCUS=false
    sNO_MERGE_PAINTS=false
    sNO_REDRAW_RESIZE=false
    sNO_RADIO_GROUP=false
    sEMBEDDED=false
    sDOUBLE_BUFFERED=false
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.lang.command.CommandDomain/@CompoisteCommand/@Composite
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=Composite
      @/@edit/@Composite/@thingForm
      sname=thingForm
      scolumn=1
      sH_SCROLL=true
      sV_SCROLL=true
      sNO_BACKGROUND=false
      sNO_FOCUS=false
      sNO_MERGE_PAINTS=false
      sNO_REDRAW_RESIZE=false
      sNO_RADIO_GROUP=false
      sEMBEDDED=false
      sDOUBLE_BUFFERED=false
      sdescriptors=xworker.swt.Widgets/@ThingForm
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=thingForm
      @/@edit/@Composite/@compositeFillLayout
      sname=compositeFillLayout
      stype=SWT.HORIZONTAL
      sdescriptors=xworker.swt.Layouts/@FillLayout
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=compositeFillLayout
      @/@edit/@Composite/@init
      sname=init
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      svarScope=Local
      sdisableGlobalContext=false
      Scode=
#$@text#$@
import org.xmeta.ActionContext;
import org.xmeta.Thing;

import xworker.swt.util.SwtDialog;

def thingTree = executorContext.get("thingTree");
def treeItem = thingTree.getSelection()[0];
def thing = treeItem.getData();

actionContext.g().put("thing", thing);

//属性的描述者
def descriptor = thing.getAttributeDescriptor(name);

if(descriptor != null){    
    def desThing = new Thing("xworker.lang.MetaDescriptor3");
    desThing.addChild(descriptor.detach());
    
    def newThing = new Thing(desThing.getMetadata().getPath());
    newThing.put(name, thing.get(name));
    thingForm.doAction("setThing", actionContext, ["thing": newThing]);
    
    executorContext.mainComposite.display.asyncExec({
        thingForm.doAction("setFocus", actionContext);
    });
}
#$@text#$@
      sinterpretationType=Action
      screateLocalVarScope=false
      ssaveReturn=false
      sdebugLog=false
      sdescriptors=xworker.swt.widgets.Widget/@Code
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=init
    @/@edit/@Buttons
    sname=Buttons
    sdescriptors=xworker.lang.command.CommandDomain/@CompoisteCommand/@Buttons
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=Buttons
      @/@edit/@Buttons/@saveButton
      sname=saveButton
      stext=lang:d=保存(&amp;S)&en=Save(&amp;S)
      stype=SWT.PUSH
      sflat=false
      sborder=false
      sselected=false
      scapture=false
      senabled=true
      sredraw=true
      svisible=true
      sdescriptors=xworker.lang.command.CommandDomain/@CompoisteCommand/@Buttons/@Button
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=saveButton
        @/@edit/@Buttons/@saveButton/@onSelection
        sname=onSelection
        sdescriptors=xworker.swt.widgets.Widget/@Event
        sinheritDescription=false
        sth_createIndex=false
        sth_registMyChilds=false
        sth_registDisabled=false
        sth_mark=false
        sid=onSelection
          @/@edit/@Buttons/@saveButton/@onSelection/@GroovyAction
          sname=GroovyAction
          sisSynchronized=false
          sthrowException=true
          suseOtherAction=false
          svarScope=Local
          sdisableGlobalContext=false
          Scode=
#$@text#$@
def result = thingForm.doAction("getValues", actionContext);
if(result != null){
    thing.put(name, result.get(name));
    thing.save();
}

command.setResult(null);
commandExecutor.checkStatus();
executorContext.mainStackLayout.topControl = executorContext.commandComposite;
executorContext.mainComposite.layout();
#$@text#$@
          sinterpretationType=Action
          screateLocalVarScope=false
          ssaveReturn=false
          sdebugLog=false
          sdescriptors=xworker.lang.actions.Actions/@GroovyAction
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_mark=false
          sid=GroovyAction
  @/@run
  sname=run
  slabel=执行方法
  shasContents=false
  scommandContent=false
  sdescriptors=xworker.lang.command.CommandDomain/@Command
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=run
    @/@run/@actions
    sname=actions
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=actions
      @/@run/@actions/@run
      sname=run
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      svarScope=Local
      sdisableGlobalContext=false
      Scode=
#$@text#$@
import org.xmeta.ActionContext;

def thingTree = commandExecutor.getActionContext().get("thingTree");
def treeItem = thingTree.getSelection()[0];
def thing = treeItem.getData();

def ac = new ActionContext();
ac.put("parentContext", actionContext);
println(thing.doAction(action, ac));
#$@text#$@
      sinterpretationType=Action
      screateLocalVarScope=false
      ssaveReturn=false
      sdebugLog=false
      sdescriptors=xworker.lang.actions.Actions/@GroovyAction
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=run
    @/@run/@action
    sname=action
    slabel=动作
    scommand=xworker.ide.worldExplorer.swt.command.ThingEditorCommandDomain/@OtherCommands/@list_methods
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@Parameter
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=action
  @/@moveup
  sname=moveup
  slabel=节点上移
  shasContents=false
  scommandContent=false
  sdescriptors=xworker.lang.command.CommandDomain/@Command
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=moveup
    @/@moveup/@actions
    sname=actions
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=actions
      @/@moveup/@actions/@run
      sname=run
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      svarScope=Local
      sdisableGlobalContext=false
      Scode=
#$@text#$@
import org.eclipse.swt.SWT;
import org.eclipse.swt.widgets.TreeItem;
import xworker.swt.util.XWorkerTreeUtil;

def thingTree = commandExecutor.getActionContext().get("thingTree");
def treeItem = thingTree.getSelection()[0];
def thing = treeItem.getData();

def parent = thing.getParent();
if(parent != null){
    parent.changeChildIndex(thing, -1, -1);
    
    def parentTreeItem = treeItem.getParentItem();  
    int index = parentTreeItem.indexOf(treeItem);
    if(index > 0){
        index --;        
        def item = new TreeItem(parentTreeItem, SWT.NONE, index);
        item.setData(thing);
        item.setText(thing.metadata.label+ " (" + thing.thingName + ")");
        XWorkerTreeUtil.initItem(item, thing, actionContext);
        
        for(child in thing.childs){
            init(item, child);
        }
        item.setExpanded(true);
        treeItem.dispose();
        thingTree.setSelection(item);        
        parent.save();
    }
}

def init(treeItem, dataObj){
    TreeItem childItem = new TreeItem(treeItem, SWT.NONE);
    childItem.setData(dataObj);
    childItem.setText(dataObj.metadata.label + " (" + dataObj.thingName + ")");
    //childItem.setImage(Resources.getImage("dataObject.png"));
    XWorkerTreeUtil.initItem(childItem, dataObj, actionContext);
    
    for(child in dataObj.childs){
        init(childItem, child);
    }
    
    childItem.setExpanded(true);
}
#$@text#$@
      sinterpretationType=Action
      screateLocalVarScope=false
      ssaveReturn=false
      sdebugLog=false
      sdescriptors=xworker.lang.actions.Actions/@GroovyAction
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=run
  @/@movedown
  sname=movedown
  slabel=节点下移
  shasContents=false
  scommandContent=false
  sdescriptors=xworker.lang.command.CommandDomain/@Command
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=movedown
    @/@movedown/@actions
    sname=actions
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=actions
      @/@movedown/@actions/@run
      sname=run
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      svarScope=Local
      sdisableGlobalContext=false
      Scode=
#$@text#$@
import org.eclipse.swt.SWT;
import org.eclipse.swt.widgets.TreeItem;
import xworker.swt.util.XWorkerTreeUtil;

def thingTree = commandExecutor.getActionContext().get("thingTree");
def treeItem = thingTree.getSelection()[0];
def thing = treeItem.getData();

def parent = thing.getParent();
if(parent != null){
    parent.changeChildIndex(thing, -1, 1);
    
    def parentTreeItem = treeItem.getParentItem();  
    int index = parentTreeItem.indexOf(treeItem);
    if(index < parentTreeItem.items.length - 1){
        index = index + 2;        
        def item = new TreeItem(parentTreeItem, SWT.NONE, index);
        item.setData(thing);
        item.setText(thing.metadata.label+ " (" + thing.thingName + ")");
        XWorkerTreeUtil.initItem(item, thing, actionContext);
        
        for(child in thing.childs){
            init(item, child);
        }
        item.setExpanded(true);
        treeItem.dispose();
        thingTree.setSelection(item);
        
        parent.save();
    }
}

def init(treeItem, dataObj){
    TreeItem childItem = new TreeItem(treeItem, SWT.NONE);
    childItem.setData(dataObj);
    childItem.setText(dataObj.metadata.label + " (" + dataObj.thingName + ")");
    //childItem.setImage(Resources.getImage("dataObject.png"));
    XWorkerTreeUtil.initItem(childItem, dataObj, actionContext);
    
    for(child in dataObj.childs){
        init(childItem, child);
    }
    
    childItem.setExpanded(true);
}
#$@text#$@
      sinterpretationType=Action
      screateLocalVarScope=false
      ssaveReturn=false
      sdebugLog=false
      sdescriptors=xworker.lang.actions.Actions/@GroovyAction
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=run
  @/@copy
  sname=copy
  slabel=拷贝
  shasContents=false
  scommandContent=false
  sdescriptors=xworker.lang.command.CommandDomain/@Command
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=copy
    @/@copy/@actions
    sname=actions
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=actions
      @/@copy/@actions/@run
      sname=run
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      svarScope=Local
      sdisableGlobalContext=false
      Scode=
#$@text#$@
import org.xmeta.Thing;
import xworker.ui.swt.Clipboard;

def thingTree = commandExecutor.getActionContext().get("thingTree");
def treeItem = thingTree.getSelection()[0];
Thing thing = treeItem.getData();
if(thing != null){
    Clipboard.add(thing.detach(false));
}
#$@text#$@
      sinterpretationType=Action
      screateLocalVarScope=false
      ssaveReturn=false
      sdebugLog=false
      sdescriptors=xworker.lang.actions.Actions/@GroovyAction
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=run
  @/@copy_path
  sname=copy_path
  slabel=拷贝路径
  shasContents=false
  scommandContent=false
  sdescriptors=xworker.lang.command.CommandDomain/@Command
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=copy_path
    @/@copy_path/@actions
    sname=actions
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=actions
      @/@copy_path/@actions/@run1
      sname=run
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      svarScope=Local
      sdisableGlobalContext=false
      Scode=
#$@text#$@
import xworker.swt.util.SwtUtils;

def thingTree = commandExecutor.getActionContext().get("thingTree");
def treeItem = thingTree.getSelection()[0];
def thing = treeItem.getData();

if(SwtUtils.isRWT()){
    String plainText = thing.metadata.path;
    copyRWT(actionContext, "path", plainText);
}else{
    copyNormal(actionContext);
}
#$@text#$@
      sinterpretationType=Action
      screateLocalVarScope=false
      ssaveReturn=false
      sdebugLog=false
      sdescriptors=xworker.lang.actions.Actions/@GroovyAction
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=run1
        @/@copy_path/@actions/@run1/@ActionDefined
        sname=ActionDefined
        sdescriptors=xworker.lang.actions.Inout/@ActionDefined
        sinheritDescription=false
        sth_createIndex=false
        sth_registMyChilds=false
        sth_registDisabled=false
        sth_mark=false
        sid=ActionDefined
          @/@copy_path/@actions/@run1/@ActionDefined/@copyRWT1
          sname=copyRWT
          stitle=lang:d=拷贝路径&en=Copy Path
          stext=var:path
          sinterpretationType=Self
          sattributeTemplate=false
          schildsAttributeTemplate=false
          svarScope=Local
          sisSynchronized=false
          sthrowException=true
          suseOtherAction=false
          screateLocalVarScope=false
          ssaveReturn=false
          sdisableGlobalContext=false
          sdebugLog=false
          sdescriptors=xworker.swt.actions.MessageBoxActions/@Prompt
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_mark=false
          sid=copyRWT1
          @/@copy_path/@actions/@run1/@ActionDefined/@copyNormal1
          sname=copyNormal
          sisSynchronized=false
          sthrowException=true
          suseOtherAction=false
          svarScope=Local
          sdisableGlobalContext=false
          Scode=
#$@text#$@
import org.eclipse.swt.SWT;
import org.eclipse.swt.dnd.Clipboard;
import org.eclipse.swt.dnd.RTFTransfer;
import org.eclipse.swt.dnd.TextTransfer;
import org.eclipse.swt.dnd.Transfer;

def thingTree = commandExecutor.getActionContext().get("thingTree");
def treeItem = thingTree.getSelection()[0];
Clipboard clipboard = new Clipboard(thingTree.getDisplay());
String plainText = treeItem.getData().metadata.path;
TextTransfer textTransfer = TextTransfer.getInstance();
clipboard.setContents([plainText] as String[], [textTransfer] as Transfer[]);
clipboard.dispose();
#$@text#$@
          sinterpretationType=Action
          screateLocalVarScope=false
          ssaveReturn=false
          sdebugLog=false
          sdescriptors=xworker.lang.actions.Actions/@GroovyAction
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_mark=false
          sid=copyNormal1
  @/@paset
  sname=paset
  slabel=粘贴
  shasContents=false
  scommandContent=false
  sdescriptors=xworker.lang.command.CommandDomain/@Command
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=paset
    @/@paset/@actions
    sname=actions
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=actions
      @/@paset/@actions/@run
      sname=run
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      svarScope=Local
      sdisableGlobalContext=false
      Scode=
#$@text#$@
import xworker.ui.swt.Clipboard;
import org.xmeta.util.ThingUtil;
import xworker.swt.util.XWorkerTreeUtil;

def thingTree = commandExecutor.getActionContext().get("thingTree");
def treeItem = thingTree.getSelection()[0];
def thing = treeItem.getData();
thing = world.getThing(thing.metadata.path);

def memObj = Clipboard.get();
if(memObj == null) return;

memObj = memObj.detach();
ThingUtil.paste(thing, memObj);
thing.save();

XWorkerTreeUtil.refresh(treeItem, thing, commandExecutor.getActionContext());
XWorkerTreeUtil.expandAll(treeItem);
#$@text#$@
      sinterpretationType=Action
      screateLocalVarScope=false
      ssaveReturn=false
      sdebugLog=false
      sdescriptors=xworker.lang.actions.Actions/@GroovyAction
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=run
  @/@paste_as_child
  sname=paste_as_child
  slabel=粘贴到子节点
  shasContents=false
  scommandContent=false
  sdescriptors=xworker.lang.command.CommandDomain/@Command
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=paste_as_child
    @/@paste_as_child/@actions
    sname=actions
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=actions
      @/@paste_as_child/@actions/@run
      sname=run
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      svarScope=Local
      sdisableGlobalContext=false
      Scode=
#$@text#$@
import xworker.ui.swt.Clipboard;
import org.xmeta.util.ThingUtil;
import xworker.swt.util.XWorkerTreeUtil;

def thingTree = commandExecutor.getActionContext().get("thingTree");
def treeItem = thingTree.getSelection()[0];
def thing = treeItem.getData();
thing = world.getThing(thing.metadata.path);

def memObj = Clipboard.get();
if(memObj == null) return;

memObj = memObj.detach();
ThingUtil.pasteAsChild(thing, memObj);
thing.save();

XWorkerTreeUtil.refresh(treeItem, thing, commandExecutor.getActionContext());
XWorkerTreeUtil.expandAll(treeItem);
#$@text#$@
      sinterpretationType=Action
      screateLocalVarScope=false
      ssaveReturn=false
      sdebugLog=false
      sdescriptors=xworker.lang.actions.Actions/@GroovyAction
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=run
  @/@cut
  sname=cut
  slabel=剪切
  shasContents=false
  scommandContent=false
  sdescriptors=xworker.lang.command.CommandDomain/@Command
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=cut
    @/@cut/@actions
    sname=actions
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=actions
      @/@cut/@actions/@run
      sname=run
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      svarScope=Local
      sdisableGlobalContext=false
      Scode=
#$@text#$@
import org.xmeta.Thing;
import xworker.ui.swt.Clipboard;

def thingTree = commandExecutor.getActionContext().get("thingTree");
def treeItem = thingTree.getSelection()[0];
Thing thing = treeItem.getData();
if(thing != null){
    Clipboard.add(thing.detach(false));
}

//删除
def parentTreeItem = treeItem.getParentItem();
treeItem.dispose();

def parent = thing.getParent();
parent.removeChild(thing);
parent.save();
#$@text#$@
      sinterpretationType=Action
      screateLocalVarScope=false
      ssaveReturn=false
      sdebugLog=false
      sdescriptors=xworker.lang.actions.Actions/@GroovyAction
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=run
  @/@refresh
  sname=refresh
  slabel=刷新
  shasContents=false
  scommandContent=false
  sdescriptors=xworker.lang.command.CommandDomain/@Command
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=refresh
    @/@refresh/@actions
    sname=actions
    sdescriptors=xworker.lang.command.CommandDomain/@Command/@actions
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=actions
      @/@refresh/@actions/@run
      sname=run
      sisSynchronized=false
      sthrowException=true
      suseOtherAction=false
      svarScope=Local
      sdisableGlobalContext=false
      Scode=
#$@text#$@
import xworker.swt.util.XWorkerTreeUtil;

def thingTree = commandExecutor.getActionContext().get("thingTree");
def treeItem = thingTree.getSelection()[0];
def thing = treeItem.getData();

XWorkerTreeUtil.refresh(treeItem, thing, commandExecutor.getActionContext());
XWorkerTreeUtil.expandAll(treeItem);
#$@text#$@
      sinterpretationType=Action
      screateLocalVarScope=false
      ssaveReturn=false
      sdebugLog=false
      sdescriptors=xworker.lang.actions.Actions/@GroovyAction
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=run
