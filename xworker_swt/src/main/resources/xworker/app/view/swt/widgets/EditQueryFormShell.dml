%1565171459321
@
sname=shell
stext=设置查询条件
sNO_TRIM=false
sCLOSE=true
sTITLE=true
sMIN=true
sMAX=true
sBORDER=false
sRESIZE=true
sON_TOP=false
sTOOL=false
sNO_FOCUS=false
swidth=640
sheight=480
scenterScreen=true
spack=false
smaximized=false
sfullScreen=false
sdesign=true
sisIde=false
sdesignDefaultOpen=false
sH_SCROLL=false
sV_SCROLL=false
sNO_BACKGROUND=false
sNO_MERGE_PAINTS=false
sNO_REDRAW_RESIZE=false
sNO_RADIO_GROUP=false
sEMBEDDED=false
sDOUBLE_BUFFERED=false
slabel=EditQueryFormShell
scapture=false
senabled=true
sredraw=true
svisible=true
sdescriptors=xworker.swt.widgets.Shell
sinheritDescription=false
sth_createIndex=false
sth_registMyChilds=false
sth_registDisabled=false
sth_mark=false
  @/@beforeInit
  sname=beforeInit
  sisSynchronized=false
  sthrowException=true
  suseOtherAction=false
  svarScope=Local
  sdisableGlobalContext=false
  Scode=
#$@text#$@
def queryDataObject = null;
if(parentQueryForm != null){
    queryDataObject = parentQueryForm.doAction("getDataObject", actionContext);
}
actionContext.g().put("queryDataObject", queryDataObject);
#$@text#$@
  sinterpretationType=Action
  screateLocalVarScope=false
  ssaveReturn=false
  sdebugLog=false
  sdescriptors=xworker.swt.widgets.Widget/@Code
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_fileMonitor=false
  sth_mark=false
  sid=beforeInit
  @/@shellGridLayout
  sname=shellGridLayout
  smakeColumnsEqualWidth=false
  smarginWidth=5
  smarginHeight=5
  smarginLeft=0
  smarginTop=0
  smarginRight=0
  smarginBottom=0
  shorizontalSpacing=5
  sverticalSpacing=5
  sdescriptors=xworker.swt.Layouts/@GridLayout
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=shellGridLayout
  @/@table
  sname=table
  sselectStyle=SINGLE
  sV_SCROLL=true
  sH_SCROLL=true
  sCHECK=true
  sFULL_SELECTION=true
  sHIDE_SELECTION=true
  sBORDER=false
  slineVisible=true
  smultipleColumns=true
  sheaderVisible=true
  ssortIndicator=true
  smoveableColumns=true
  sheadImages=false
  ssubImages=false
  sVIRTUAL=false
  scapture=false
  senabled=true
  sredraw=true
  svisible=true
  sdescriptors=xworker.swt.Widgets/@Table
  sinheritDescription=false
  sth_createIndex=false
  sth_registMyChilds=false
  sth_registDisabled=false
  sth_mark=false
  sid=table
    @/@table/@dataStore
    sname=dataStore
    sattachToParent=true
    sloadBackground=true
    sautoLoad=true
    sautoSave=false
    spaging=extend
    spageSize=50
    sstoreSortField=_extend
    sstoreSortDir=ASC
    seditable=extend
    seditmethod=extend
    sdescriptors=xworker.swt.widgets.Table/@DataStore
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=dataStore
      @/@table/@dataStore/@dataObjects
      sname=dataObjects
      sdescriptors=xworker.app.view.swt.data.DataStore/@DataObjects
      sinheritDescription=false
      sth_createIndex=false
      sth_registMyChilds=false
      sth_registDisabled=false
      sth_mark=false
      sid=dataObjects
        @/@table/@dataStore/@dataObjects/@AbstractDataObject
        sname=AbstractDataObject
        seditCols=2
        spaging=false
        snoTotalCount=false
        spagineByCursor=false
        sreadUrl=do?sc=xworker.app.view.extjs.server.DataObjectStore/@read
        screateUrl=do?sc=xworker.app.view.extjs.server.DataObjectStore/@create
        supdateUrl=do?sc=xworker.app.view.extjs.server.DataObjectStore/@update
        sdestroyUrl=do?sc=xworker.app.view.extjs.server.DataObjectStore/@destroy
        LstoreAutoDestroy=false
        sstoreAutoLoad=false
        LstoreAutoSave=true
        LstoreBatch=true
        LstorePruneModifiedRecords=false
        LstoreRemoteSort=false
        LstoreRestful=false
        sstoreRoot='rows'
        sstoreSuccessProperty='success'
        sstoreTotalProperty='totalCount'
        sstoreMessageProperty='msg'
        sgridEditable=true
        sgridEditType=cell
        sformReadUrl=do?sc=xworker.app.view.extjs.server.DataObjectForm/@read
        sformCreateUrl=do?sc=xworker.app.view.extjs.server.DataObjectForm/@create
        sformUpdateUrl=do?sc=xworker.app.view.extjs.server.DataObjectForm/@update
        sformDestroyUrl=do?sc=xworker.app.view.extjs.server.DataObjectForm/@delete
        spaging_afterPageText=页 共
        spaging_beforePageText=第
        Lpaging_displayInfo=false
        spaging_displayMsg=第{0}-第{1}条，共{2}条
        spaging_emptyMsg=没有数据
        spaging_firstText=首页
        spaging_lastText=最后一页
        spaging_nextText=下一页
        Lpaging_prependButtons=false
        spaging_prevText=上一页
        spaging_refreshText=刷新
        sgridColumnLocking=false
        sgridLockText='锁定'
        sgridUnlockText='解锁'
        scolumnGroup=false
        sgridCheckable=true
        sgridRowNumber=false
        sgridGrouping=false
        sgridGroupTextTpl='{text} ({[values.rs.length]} 条)'
        sgridRowExpander=false
        sautoGenerateId=false
        sidGenerateType=action
        sidAction=generateId
        sstoreSortDir=ASC
        sautoInit=false
        sautoInitAction=beforeCreate
        scacheRelation=false
        scacheRelationMaxSize=1000
        scacheRelationReadnone=false
        safterCreated=false
        sonLoaded=false
        sbeforeUpdate=false
        safterUpdated=false
        sbeforeDelete=false
        safterDeleted=false
        sbeforeQuery=false
        safterQueryed=false
        sshowUserTask=false
        sdescriptors=xworker.dataObject.DataObjects/@AbstractDataObject
        sinheritDescription=false
        sth_createIndex=false
        sth_registMyChilds=false
        sth_registDisabled=false
        sth_mark=false
        sid=AbstractDataObject
          @/@table/@dataStore/@dataObjects/@AbstractDataObject/@actions
          sname=actions
          sdescriptors=xworker.dataObject.AbstractDataObject/@actions
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_mark=false
          sid=actions
            @/@table/@dataStore/@dataObjects/@AbstractDataObject/@actions/@query
            sname=query
            sisSynchronized=false
            sthrowException=true
            suseOtherAction=false
            svarScope=Local
            sdisableGlobalContext=false
            Scode=
#$@text#$@
import xworker.dataObject.DataObject;

def queryDataObject = actionContext.get("queryDataObject");
//println queryDataObject.getClass();
def datas = [];
for(attr in parentDataStore.dataObject.getChilds("attribute")){
    def data = null;    
    def qattr = getQueryAttr(attr.getMetadata().getName(), queryDataObject);
    if(qattr == null){
        data = new DataObject("xworker.app.view.swt.widgets.EditQueryFormShell/@table/@dataStore/@dataObjects/@AbstractDataObject");
        data.put("name", attr.getMetadata().getName());
        data.put("label", attr.getMetadata().getLabel());
        data.put("operator", "1");
        data.put("range", "false");
        data.put("attr", attr);
        data.put("inputtype", attr.get("inputtype"));
        data.put("size", attr.get("size"));
    }else{
        data = new DataObject("xworker.app.view.swt.widgets.EditQueryFormShell/@table/@dataStore/@dataObjects/@AbstractDataObject");
        data.putAll(qattr.getAttributes());
        data.put("attr", attr);
    }
    
    checkInQuery(data, parentDataStore.queryConfig);
    //是否在查询表单
    datas.add(data);
}

return datas;

def getQueryAttr(name, queryDataObject){
    if(queryDataObject == null){
        return null;
    }else{
        for(attr in queryDataObject.getMetadata().getAttributes()){
             //println attr;
             if(attr.get("name") == name){
                 return attr;
             }
        }
    }
    
    return null;
}

def checkInQuery(data, condition){
    if(condition == null){
        return false;
    }
    for(attr in condition.getChilds()){
        def name = data.getString("name");
        if("true" == data.getString("range")){
            name = name + "Start";
        }
        if(data.getString("name") == attr.getString("attributeName")){
            if("true" != data.getString("range")){
                data.put("operator", attr.get("operator"));
            }
            data.put(DataObject.CHECKED_ATTRIBUTE_NAME, "true");
            return true;
        }
    }
    
    return false;
}
#$@text#$@
            sinterpretationType=Action
            screateLocalVarScope=false
            ssaveReturn=false
            sdebugLog=false
            sdescriptors=xworker.lang.actions.Actions/@GroovyAction
            sinheritDescription=false
            sth_createIndex=false
            sth_registMyChilds=false
            sth_registDisabled=false
            sth_mark=false
            sid=query
          @/@table/@dataStore/@dataObjects/@AbstractDataObject/@name
          sname=name
          slabel=名称
          stype=string
          soptional=true
          skey=false
          sdataField=true
          sviewField=true
          sreadField=true
          screateEditor=true
          seditEditor=true
          sviewEditor=true
          sgridEditor=true
          squeryEditor=true
          sreadOnly=false
          seditable=false
          sdisabled=false
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          sshowInTable=true
          sgridWidth=200
          sdisplayRelationLabel=false
          sgridFixed=false
          sgridHidden=false
          sgridHideable=true
          sgridSortable=false
          scolumnLocked=false
          sgridGroupable=true
          sgridMenuDisabled=false
          sgridResizable=true
          sdescriptors=xworker.dataObject.AbstractDataObject/@attribute
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_mark=false
          sid=name
          @/@table/@dataStore/@dataObjects/@AbstractDataObject/@label
          sname=label
          slabel=标签
          stype=string
          soptional=true
          skey=false
          sdataField=true
          sviewField=true
          sreadField=true
          screateEditor=true
          seditEditor=true
          sviewEditor=true
          sgridEditor=true
          squeryEditor=true
          sreadOnly=false
          seditable=true
          sdisabled=false
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          sshowInTable=true
          sgridWidth=200
          sdisplayRelationLabel=false
          sgridFixed=false
          sgridHidden=false
          sgridHideable=true
          sgridSortable=false
          scolumnLocked=false
          sgridGroupable=true
          sgridMenuDisabled=false
          sgridResizable=true
          sdescriptors=xworker.dataObject.AbstractDataObject/@attribute
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_mark=false
          sid=label
          @/@table/@dataStore/@dataObjects/@AbstractDataObject/@operator
          sname=operator
          slabel=操作符
          stype=string
          soptional=true
          skey=false
          sdataField=true
          sviewField=true
          sreadField=true
          sdefault=1
          sdescription=<p>数值比较的操作符。</p>
          screateEditor=true
          seditEditor=true
          sviewEditor=true
          sgridEditor=true
          squeryEditor=true
          sinputtype=select
          sreadOnly=false
          seditable=true
          sdisabled=false
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          svalidateAllowBlank=true
          LvalidateOnBlur=false
          LallowDecimals=false
          LallowNegative=false
          sshowInTable=true
          sdisplayRelationLabel=false
          sgridFixed=false
          sgridHidden=false
          sgridHideable=true
          sgridSortable=false
          scolumnLocked=false
          sgridGroupable=true
          sgridMenuDisabled=false
          sgridResizable=true
          sdescriptors=xworker.dataObject.AbstractDataObject/@attribute
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_mark=false
          sid=operator
            @/@table/@dataStore/@dataObjects/@AbstractDataObject/@operator/@=
            sname==
            slabel==
            svalue=1
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sid==
            @/@table/@dataStore/@dataObjects/@AbstractDataObject/@operator/@!=
            sname=!=
            slabel=!=
            svalue=2
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sid=!=
            @/@table/@dataStore/@dataObjects/@AbstractDataObject/@operator/@>
            sname=>
            slabel=>
            svalue=3
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sid=>
            @/@table/@dataStore/@dataObjects/@AbstractDataObject/@operator/@>=
            sname=>=
            slabel=>=
            svalue=4
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sid=>=
            @/@table/@dataStore/@dataObjects/@AbstractDataObject/@operator/@<
            sname=<
            slabel=<
            svalue=5
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sid=<
            @/@table/@dataStore/@dataObjects/@AbstractDataObject/@operator/@<=
            sname=<=
            slabel=<=
            svalue=6
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sid=<=
            @/@table/@dataStore/@dataObjects/@AbstractDataObject/@operator/@like
            sname=like
            slabel=like
            svalue=7
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sid=like
            @/@table/@dataStore/@dataObjects/@AbstractDataObject/@operator/@llike
            sname=llike
            slabel=endsWith
            svalue=8
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sid=llike
            @/@table/@dataStore/@dataObjects/@AbstractDataObject/@operator/@rlike
            sname=rlike
            slabel=startsWith
            svalue=9
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sid=rlike
            @/@table/@dataStore/@dataObjects/@AbstractDataObject/@operator/@lrlike
            sname=lrlike
            slabel=lrlike
            svalue=10
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sid=lrlike
            @/@table/@dataStore/@dataObjects/@AbstractDataObject/@operator/@in
            sname=in
            slabel=in
            svalue=11
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sid=in
            @/@table/@dataStore/@dataObjects/@AbstractDataObject/@operator/@regex
            sname=regex
            slabel=regex
            svalue=12
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sid=regex
            @/@table/@dataStore/@dataObjects/@AbstractDataObject/@operator/@equals
            sname=equals
            slabel=equals
            svalue=13
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sid=equals
            @/@table/@dataStore/@dataObjects/@AbstractDataObject/@operator/@isnull
            sname=isnull
            slabel=isnull
            svalue=14
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sid=isnull
            @/@table/@dataStore/@dataObjects/@AbstractDataObject/@operator/@notnull
            sname=notnull
            slabel=notnull
            svalue=15
            sdescriptors=xworker.lang.MetaDescriptor3/@attribute/@value
            sid=notnull
          @/@table/@dataStore/@dataObjects/@AbstractDataObject/@range
          sname=range
          slabel=范围查询
          stype=string
          soptional=true
          skey=false
          sdataField=true
          sviewField=true
          sreadField=true
          sdefault=false
          sdescription=<p>如果是范围查询，则包含起始和截至两个字段。</p>
          screateEditor=true
          seditEditor=true
          sviewEditor=true
          sgridEditor=true
          squeryEditor=true
          sinputtype=truefalse
          sreadOnly=false
          seditable=true
          sdisabled=false
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          sshowInTable=true
          sdisplayRelationLabel=false
          sgridFixed=false
          sgridHidden=false
          sgridHideable=true
          sgridSortable=false
          scolumnLocked=false
          sgridGroupable=true
          sgridMenuDisabled=false
          sgridResizable=true
          sdescriptors=xworker.dataObject.AbstractDataObject/@attribute
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_mark=false
          sid=range
          @/@table/@dataStore/@dataObjects/@AbstractDataObject/@inputtype
          sname=inputtype
          slabel=InputType
          soptional=true
          skey=false
          sdataField=true
          sviewField=true
          sreadField=true
          Sdescription=
#$@text#$@
<p>如果想要对输入方式做进一步的设定，可以尝试点击属性&lsquo;输入扩展属性&rsquo;输入框后的&lsquo;*&rsquo;号按钮。</p>
<p>如果使用DataStore或者关联作为数据源，那么应注意相关联的数据对象应该有一个主键，否则会有时发生取不到值的情况，如swt的combo。</p>
#$@text#$@
          screateEditor=true
          seditEditor=true
          sviewEditor=true
          sgridEditor=true
          squeryEditor=true
          sinputtype=inputSelect
          sreadOnly=false
          seditable=true
          sdisabled=false
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          sgroup=Editor
          svalidateAllowBlank=true
          LvalidateOnBlur=true
          LallowDecimals=true
          LallowNegative=true
          sshowInTable=true
          sgridShowEditor=false
          sdisplayRelationLabel=false
          sgridFixed=false
          sgridHidden=false
          sgridHideable=true
          sgridSortable=false
          scolumnLocked=false
          sgridGroupable=true
          sgridMenuDisabled=false
          sgridResizable=true
          szh_label=输入方式
          sdescriptors=xworker.dataObject.AbstractDataObject/@attribute
          sextends=xworker.lang.MetaDescriptor3/@attribute/@inputtype
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_fileMonitor=false
          Szh_description=
#$@text#$@
属性的编辑控件定义。<br />
<br />
可以在输入扩展属性里定义编辑控件的更多参数。
#$@text#$@
          sth_mark=false
          sid=inputtype
          @/@table/@dataStore/@dataObjects/@AbstractDataObject/@size1
          sname=size
          slabel=尺寸
          soptional=true
          skey=false
          sdataField=true
          sviewField=true
          sreadField=true
          screateEditor=true
          seditEditor=true
          sviewEditor=true
          sgridEditor=true
          squeryEditor=true
          sreadOnly=false
          seditable=true
          sdisabled=false
          sshowLabel=true
          slabelAlign=right
          slabelVAlign=baseline
          sgroup=Editor
          svalidateAllowBlank=true
          LvalidateOnBlur=false
          LallowDecimals=false
          LallowNegative=false
          sshowInTable=true
          sgridShowEditor=false
          sdisplayRelationLabel=false
          sgridFixed=false
          sgridHidden=false
          sgridHideable=true
          sgridSortable=false
          scolumnLocked=false
          sgridGroupable=true
          sgridMenuDisabled=false
          sgridResizable=true
          sen_label=Size
          sdescriptors=xworker.dataObject.AbstractDataObject/@attribute
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_fileMonitor=false
          sth_mark=false
          sid=size1
    @/@table/@tableGridData
    sname=tableGridData
    sstyle=FILL_BOTH
    shorizontalIndent=0
    swidth=-1
    sheight=-1
    shorizontalAlignment=BEGINNING
    sverticalAlignment=CENTER
    shorizontalSpan=1
    sverticalSpan=1
    sgrabExcessHorizontalSpace=false
    sgrabExcessVerticalSpace=false
    sdescriptors=xworker.swt.layout.LayoutDatas/@GridData
    sinheritDescription=false
    sth_createIndex=false
    sth_registMyChilds=false
    sth_registDisabled=false
    sth_mark=false
    sid=tableGridData
  @/@1920
  sname=buttonComposite
  sBORDER=false
  sH_SCROLL=false
  sV_SCROLL=false
  sNO_BACKGROUND=false
  sNO_FOCUS=false
  sNO_MERGE_PAINTS=false
  sNO_REDRAW_RESIZE=false
  sNO_RADIO_GROUP=false
  sEMBEDDED=false
  sDOUBLE_BUFFERED=false
  scapture=false
  senabled=true
  sredraw=true
  svisible=true
  sdescriptors=xworker.swt.Widgets/@Composite
  sid=1920
    @/@1920/@1921
    sname=buttonCompositeGridData
    sstyle=FILL_HORIZONTAL
    shorizontalIndent=0
    swidth=-1
    sheight=-1
    shorizontalAlignment=END
    sverticalAlignment=CENTER
    shorizontalSpan=1
    sverticalSpan=1
    sgrabExcessHorizontalSpace=false
    sgrabExcessVerticalSpace=false
    sdescriptors=xworker.swt.layout.LayoutDatas/@GridData
    sid=1921
    @/@1920/@1922
    sname=buttonCompositeRowLayout
    sfill=false
    sjustify=false
    smarginWidth=0
    smarginHeight=0
    smarginLeft=3
    smarginTop=3
    smarginRight=3
    smarginBottom=3
    spack=true
    sspacing=3
    stype=SWT.HORIZONTAL
    swrap=true
    sdescriptors=xworker.swt.Layouts/@RowLayout
    sid=1922
    @/@1920/@1923
    sname=okButton
    stext=确定
    stype=SWT.PUSH
    sflat=false
    sborder=false
    sselected=false
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Button
    sth_createIndex=false
    sid=1923
      @/@1920/@1923/@1924
      sname=RowData
      sexclude=false
      swidth=80
      sheight=-1
      sdescriptors=xworker.swt.layout.LayoutDatas/@RowData
      sth_createIndex=false
      sid=1924
      @/@1920/@1923/@1925
      sname=Listeners
      sdescriptors=xworker.swt.widgets.Widget/@Listeners
      sth_createIndex=false
      sid=1925
        @/@1920/@1923/@1925/@1926
        sname=okButtonSelection
        stype=Selection
        sdescriptors=xworker.swt.events.Listeners/@listeners/@Listener
        sth_createIndex=false
        sid=1926
          @/@1920/@1923/@1925/@1926/@ok
          sname=ok
          sisSynchronized=false
          sthrowException=true
          suseOtherAction=false
          svarScope=Local
          sdisableGlobalContext=false
          Scode=
#$@text#$@
import org.xmeta.Thing;

//获取form并清空
def form = new Thing("xworker.dataObject.DataObjects/@AbstractDataObject");
def con = new Thing("xworker.dataObject.DataObject/@Condition");

for(item in table.getItems()){
    if(item.getChecked()){
        def data = item.getData();
        def name = data.getString("name");
        def label = data.getString("label");
        def operator = data.getString("operator");
        if(operator == null || operator == ""){
            operator = "1";
        }
        def range = data.getBoolean("range");
        def attr = data.get("attr");
        def inputtype = data.get("inputtype");
        def size = data.get("size");
        
        if(range){
            def attrStart = attr.detach();
            attrStart.put("queryEditor", "true");
            attrStart.put("inputtype", inputtype);
            attrStart.put("size", size);
            attrStart.put("name", name + "Start");
            attrStart.put("label", label + "起始");
            form.addChild(attrStart);            
            addCondition(con, name, name + "Start", "4", "false");
            
            def attrEnd = attr.detach();
            attrEnd.put("queryEditor", "true");
            attrEnd.put("inputtype", inputtype);
            attrEnd.put("size", size);
            attrEnd.put("name", name + "End");
            attrEnd.put("label", label + "截止");
            form.addChild(attrEnd);
            def addOneDay = "false";
            def type = attr.get("type");
            if(type == "date" || type == "datetime"){
                addOneDay = "true";
            }
            addCondition(con, name, name + "Start", "5", addOneDay);
        }else{
            attr = attr.detach();
            attr.put("queryEditor", "true");
            attr.put("inputtype", inputtype);
            attr.put("size", size);
            attr.put("label", label);
            form.addChild(attr);
            addCondition(con, name, name, operator, "false");
        }
    }
}

//设置查询条件
//println form.getChilds();
if(parentQueryForm != null){
    parentQueryForm.doAction("setDataObject", actionContext, ["dataObject":form]);
}
//设置dataStore的查询条件
//println con.getChilds();
parentDataStore.set("queryConfig", con);
//println(con.getChilds());
dataObjectComposite.layout();

shell.dispose();

def addCondition(parent, attrName, paramName, operator, addOneDay){
    def con = new Thing("xworker.dataObject.query.Condition/@Condition");
    con.put("name", paramName);
    con.put("attributeName", attrName);
    con.put("dataName", paramName);
    con.put("operator", operator);
    con.put("addOneDay", addOneDay);
    parent.addChild(con);
    
}
#$@text#$@
          sinterpretationType=Action
          screateLocalVarScope=false
          ssaveReturn=false
          sdebugLog=false
          sdescriptors=xworker.lang.actions.Actions/@GroovyAction
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_mark=false
          sid=ok
    @/@1920/@1927
    sname=cancelButton
    stext=取消
    stype=SWT.PUSH
    sflat=false
    sborder=false
    sselected=false
    scapture=false
    senabled=true
    sredraw=true
    svisible=true
    sdescriptors=xworker.swt.Widgets/@Button
    sth_createIndex=false
    sid=1927
      @/@1920/@1927/@1928
      sname=RowData
      sexclude=false
      swidth=80
      sheight=-1
      sdescriptors=xworker.swt.layout.LayoutDatas/@RowData
      sth_createIndex=false
      sid=1928
      @/@1920/@1927/@1929
      sname=Listeners
      sdescriptors=xworker.swt.widgets.Widget/@Listeners
      sth_createIndex=false
      sid=1929
        @/@1920/@1927/@1929/@1930
        sname=cancelButtonSelection
        stype=Selection
        sdescriptors=xworker.swt.events.Listeners/@listeners/@Listener
        sth_createIndex=false
        sid=1930
          @/@1920/@1927/@1929/@1930/@Dispose
          sname=Dispose
          scontrolList=shell
          sinterpretationType=Self
          sattributeTemplate=false
          schildsAttributeTemplate=false
          svarScope=Local
          sisSynchronized=false
          sthrowException=true
          suseOtherAction=false
          screateLocalVarScope=false
          ssaveReturn=false
          sdisableGlobalContext=false
          sdebugLog=false
          sdescriptors=xworker.swt.actions.ControlActions/@Dispose
          sinheritDescription=false
          sth_createIndex=false
          sth_registMyChilds=false
          sth_registDisabled=false
          sth_mark=false
          sid=Dispose
