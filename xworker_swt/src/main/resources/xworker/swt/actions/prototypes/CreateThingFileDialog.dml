^1524907234673
@
sname
shell
stext
res:res.w_exp:newThing:新建事物
sNO_TRIM
false
sCLOSE
true
sTITLE
true
sMIN
true
sMAX
true
sBORDER
false
sRESIZE
true
sON_TOP
false
sTOOL
false
sNO_FOCUS
false
swidth
800
sheight
600
scenterScreen
true
spack
false
smaximized
false
sfullScreen
false
sdesign
true
sisIde
false
sdesignDefaultOpen
false
sH_SCROLL
false
sV_SCROLL
false
sNO_BACKGROUND
false
sNO_MERGE_PAINTS
false
sNO_REDRAW_RESIZE
false
sNO_RADIO_GROUP
false
sEMBEDDED
false
sDOUBLE_BUFFERED
false
slabel
CreateThingFileDialog
scapture
false
senabled
true
sredraw
true
svisible
true
sdescriptors
xworker.swt.widgets.Shell
sinheritDescription
false
sth_createIndex
false
sth_registMyChilds
false
sth_registDisabled
false
sth_mark
false
  @/@shellGridLayout
  sname
  shellGridLayout
  smakeColumnsEqualWidth
  false
  smarginWidth
  5
  smarginHeight
  5
  smarginLeft
  0
  smarginTop
  0
  smarginRight
  0
  smarginBottom
  0
  shorizontalSpacing
  5
  sverticalSpacing
  5
  sdescriptors
  xworker.swt.Layouts/@GridLayout
  sinheritDescription
  false
  sth_createIndex
  false
  sth_registMyChilds
  false
  sth_registDisabled
  false
  sth_mark
  false
  sid
  shellGridLayout
  @/@mainComposite
  sname
  mainComposite
  sBORDER
  false
  sH_SCROLL
  false
  sV_SCROLL
  false
  sNO_BACKGROUND
  false
  sNO_FOCUS
  false
  sNO_MERGE_PAINTS
  false
  sNO_REDRAW_RESIZE
  false
  sNO_RADIO_GROUP
  false
  sEMBEDDED
  false
  sDOUBLE_BUFFERED
  false
  scapture
  false
  senabled
  true
  sredraw
  true
  svisible
  true
  sdescriptors
  xworker.swt.Widgets/@Composite
  sinheritDescription
  false
  sth_createIndex
  false
  sth_registMyChilds
  false
  sth_registDisabled
  false
  sth_mark
  false
  sid
  mainComposite
    @/@mainComposite/@mainCompositeFillLayout
    sname
    mainCompositeFillLayout
    stype
    SWT.HORIZONTAL
    sdescriptors
    xworker.swt.Layouts/@FillLayout
    sinheritDescription
    false
    sth_createIndex
    false
    sth_registMyChilds
    false
    sth_registDisabled
    false
    sth_mark
    false
    sid
    mainCompositeFillLayout
    @/@mainComposite/@mainCompositeGridData
    sname
    mainCompositeGridData
    sstyle
    FILL_BOTH
    shorizontalIndent
    0
    swidth
    -1
    sheight
    -1
    shorizontalAlignment
    BEGINNING
    sverticalAlignment
    CENTER
    shorizontalSpan
    1
    sverticalSpan
    1
    sgrabExcessHorizontalSpace
    true
    sgrabExcessVerticalSpace
    true
    sdescriptors
    xworker.swt.layout.LayoutDatas/@GridData
    sinheritDescription
    false
    sth_createIndex
    false
    sth_registMyChilds
    false
    sth_registDisabled
    false
    sth_mark
    false
    sid
    mainCompositeGridData
    @/@mainComposite/@extendNewThingDialog
    sname
    extendNewThingDialog
    sextendWidgetPath
    xworker.ide.worldExplorer.swt.dialogs.NewThingDialog/@shell/@mainComposite
    snewActionContext
    false
    sdescriptors
    xworker.swt.Widgets/@ExtendWidget
    sinheritDescription
    false
    sth_createIndex
    false
    sth_registMyChilds
    false
    sth_registDisabled
    false
    sth_mark
    false
    sid
    extendNewThingDialog
  @/@RunAction
  sname
  RunAction
  sdescriptors
  xworker.swt.xworker.RunAction
  sinheritDescription
  false
  sth_createIndex
  false
  sth_registMyChilds
  false
  sth_registDisabled
  false
  sth_mark
  false
  sid
  RunAction
    @/@RunAction/@Dispose
    sname
    Dispose
    scontrolList
    buttonCell,pathLabel,pathText,pathSelectButton
    sinterpretationType
    Self
    sattributeTemplate
    false
    schildsAttributeTemplate
    false
    svarScope
    Local
    sisSynchronized
    false
    sthrowException
    true
    suseOtherAction
    false
    screateLocalVarScope
    false
    ssaveReturn
    false
    sdisableGlobalContext
    false
    sdebugLog
    false
    sdescriptors
    xworker.swt.actions.ControlActions/@Dispose
    sinheritDescription
    false
    sth_createIndex
    false
    sth_registMyChilds
    false
    sth_registDisabled
    false
    sth_mark
    false
    sid
    Dispose
  @/@buttonCell
  sname
  buttonCell
  sBORDER
  false
  sH_SCROLL
  false
  sV_SCROLL
  false
  sNO_BACKGROUND
  false
  sNO_FOCUS
  false
  sNO_MERGE_PAINTS
  false
  sNO_REDRAW_RESIZE
  false
  sNO_RADIO_GROUP
  false
  sEMBEDDED
  false
  sDOUBLE_BUFFERED
  false
  slabel
  buttonCell
  scapture
  false
  senabled
  true
  sredraw
  true
  svisible
  true
  sdescriptors
  xworker.swt.Widgets/@Composite
  sid
  buttonCell
    @/@buttonCell/@buttonCellGridData
    sname
    buttonCellGridData
    sstyle
    FILL_HORIZONTAL
    shorizontalIndent
    0
    swidth
    -1
    sheight
    -1
    shorizontalAlignment
    END
    sverticalAlignment
    CENTER
    shorizontalSpan
    3
    sverticalSpan
    1
    sgrabExcessHorizontalSpace
    false
    sgrabExcessVerticalSpace
    false
    slabel
    buttonCellGridData
    sdescriptors
    xworker.swt.Commons/@GridData
    sid
    buttonCellGridData
    @/@buttonCell/@buttonCellRowLayout
    sname
    buttonCellRowLayout
    sfill
    false
    sjustify
    false
    smarginWidth
    0
    smarginHeight
    0
    smarginLeft
    3
    smarginTop
    3
    smarginRight
    3
    smarginBottom
    3
    spack
    true
    sspacing
    3
    stype
    SWT.HORIZONTAL
    swrap
    true
    slabel
    buttonCellRowLayout
    sdescriptors
    xworker.swt.Layouts/@RowLayout
    sid
    buttonCellRowLayout
    @/@buttonCell/@okButton
    sname
    okButton
    stext
    res:res.w_exp:okButton:确定（&O）
    stype
    SWT.PUSH
    sflat
    false
    sborder
    false
    sselected
    false
    scapture
    false
    senabled
    true
    sredraw
    true
    svisible
    true
    slabel
    okButton
    sdescriptors
    xworker.swt.Widgets/@Button
    sid
    okButton
      @/@buttonCell/@okButton/@listeners
      sname
      listeners
      slabel
      listeners
      sdescriptors
      xworker.swt.events.Listeners/@listeners
      sid
      listeners
        @/@buttonCell/@okButton/@listeners/@okButtonSelection
        sname
        okButtonSelection
        stype
        Selection
        slabel
        okButtonSelection
        sdescriptors
        xworker.swt.events.Listeners/@listeners/@Listener
        sid
        okButtonSelection
          @/@buttonCell/@okButton/@listeners/@okButtonSelection/@GroovyAction
          sname
          GroovyAction
          slabel
          GroovyAction
          sisSynchronized
          false
          sthrowException
          false
          suseOtherAction
          false
          svarScope
          Global
          sdisableGlobalContext
          false
          Scode
#$@text#$@
import org.eclipse.swt.SWT;
import org.eclipse.swt.widgets.MessageBox;

import org.xmeta.Thing;

if(actionContext.get("rootDir") == null){
    showMessage(actionContext, "message", "rootDir不能为null");
    return;
}

def name = dataObjectNameText.getText().trim();
if("" == name){
    showMessage(actionContext, "message", "事物名不能为空！");
    return;
}
def codeType = codecTypeCombo.getText();
if(codeType == null || codeType == ""){
    codeType = "dml_xml";
}
def coder = world.getThingCoder(codeType);
def ext = coder.getType();
def fileName = name + "." + ext;

def file = new File(rootDir, fileName);
if(file.exists()){
    showMessage(actionContext, "message", "事物" + file.getPath() + "已存在!");
    return;
}

try{
    if(file.getParentFile().exists() == false){
         file.getParentFile().mkdirs();
    }
    
    def descriptor = descriptorText.getText();
    def newThing = new Thing(descriptor);
    newThing.put("name", name);
    newThing.getMetadata().setCoderType(codeType);
    
    FileOutputStream fout = new FileOutputStream(file);
    coder.encode(newThing, fout);
    fout.close();
    _g.put("result", file);

    thing.doAction("ok", parentContext, "file", file);
        
    shell.dispose();
}catch(Exception e){
    showMessage(actionContext, "message", "创建事物" + file.getPath() + "失败，" + e.getMessage());
    return;
}
#$@text#$@
          sinterpretationType
          Action
          screateLocalVarScope
          false
          ssaveReturn
          false
          sdebugLog
          false
          sdescriptors
          xworker.lang.actions.Actions/@GroovyAction
          sid
          GroovyAction
            @/@buttonCell/@okButton/@listeners/@okButtonSelection/@GroovyAction/@ActionDefined
            sname
            ActionDefined
            sdescriptors
            xworker.lang.actions.Inout/@ActionDefined
            sinheritDescription
            false
            sth_createIndex
            false
            sth_registMyChilds
            false
            sth_registDisabled
            false
            sth_mark
            false
            sid
            ActionDefined
              @/@buttonCell/@okButton/@listeners/@okButtonSelection/@GroovyAction/@ActionDefined/@showMessage
              sname
              showMessage
              sshell
              var:shell
              sicon
              ICON_ERROR
              sbuttons
              OK
              stitle
              lang:d=创建事物&en=Create Thing
              smessage
              var:message
              sinterpretationType
              Self
              sattributeTemplate
              false
              schildsAttributeTemplate
              false
              svarScope
              Local
              sisSynchronized
              false
              sthrowException
              true
              suseOtherAction
              false
              screateLocalVarScope
              false
              ssaveReturn
              false
              sdisableGlobalContext
              false
              sdebugLog
              false
              sdescriptors
              xworker.swt.actions.MessageBoxActions/@MessageBox
              sinheritDescription
              false
              sth_createIndex
              false
              sth_registMyChilds
              false
              sth_registDisabled
              false
              sth_mark
              false
              sid
              showMessage
      @/@buttonCell/@okButton/@RowData
      sname
      RowData
      sexclude
      false
      swidth
      120
      sheight
      -1
      slabel
      RowData
      sdescriptors
      xworker.swt.layout.LayoutDatas/@RowData
      sid
      RowData
    @/@buttonCell/@cancelButton
    sname
    cancelButton
    stext
    res:res.w_exp:cancelButton:取消（&C）
    stype
    SWT.PUSH
    sflat
    false
    sborder
    false
    sselected
    false
    scapture
    false
    senabled
    true
    sredraw
    true
    svisible
    true
    slabel
    cancelButton
    sdescriptors
    xworker.swt.Widgets/@Button
    sid
    cancelButton
      @/@buttonCell/@cancelButton/@listeners
      sname
      listeners
      slabel
      listeners
      sdescriptors
      xworker.swt.events.Listeners/@listeners
      sid
      listeners
        @/@buttonCell/@cancelButton/@listeners/@cancelButtonSelection
        sname
        cancelButtonSelection
        stype
        Selection
        slabel
        cancelButtonSelection
        sdescriptors
        xworker.swt.events.Listeners/@listeners/@Listener
        sid
        cancelButtonSelection
          @/@buttonCell/@cancelButton/@listeners/@cancelButtonSelection/@doCancel
          sname
          doCancel
          sthingPath
          var:thing
          sactionName
          cancel
          sinterpretationType
          Self
          sattributeTemplate
          false
          schildsAttributeTemplate
          false
          svarScope
          Local
          sisSynchronized
          false
          sthrowException
          true
          suseOtherAction
          false
          screateLocalVarScope
          false
          ssaveReturn
          false
          sdisableGlobalContext
          false
          sdebugLog
          false
          sdescriptors
          xworker.lang.actions.Actions/@ThingAction1
          sinheritDescription
          false
          sth_createIndex
          false
          sth_registMyChilds
          false
          sth_registDisabled
          false
          sth_mark
          false
          sid
          doCancel
          @/@buttonCell/@cancelButton/@listeners/@cancelButtonSelection/@Dispose
          sname
          Dispose
          scontrolList
          shell
          sinterpretationType
          Self
          sattributeTemplate
          false
          schildsAttributeTemplate
          false
          svarScope
          Local
          sisSynchronized
          false
          sthrowException
          true
          suseOtherAction
          false
          screateLocalVarScope
          false
          ssaveReturn
          false
          sdisableGlobalContext
          false
          sdebugLog
          false
          sdescriptors
          xworker.swt.actions.ControlActions/@Dispose
          sinheritDescription
          false
          sth_createIndex
          false
          sth_registMyChilds
          false
          sth_registDisabled
          false
          sth_mark
          false
          sid
          Dispose
      @/@buttonCell/@cancelButton/@RowData
      sname
      RowData
      sexclude
      false
      swidth
      120
      sheight
      -1
      slabel
      RowData
      sdescriptors
      xworker.swt.layout.LayoutDatas/@RowData
      sid
      RowData
  @/@init
  sname
  init
  sisSynchronized
  false
  sthrowException
  true
  suseOtherAction
  false
  svarScope
  Local
  sdisableGlobalContext
  false
  scode
  codecTypeCombo.setText("dml_xml");
  sinterpretationType
  Action
  screateLocalVarScope
  false
  ssaveReturn
  false
  sdebugLog
  false
  sdescriptors
  xworker.swt.widgets.Widget/@Code
  sinheritDescription
  false
  sth_createIndex
  false
  sth_registMyChilds
  false
  sth_registDisabled
  false
  sth_mark
  false
  sid
  init
